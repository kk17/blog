<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Code Play</title>
    <link>https://blog.kk17.net/</link>
    <description>Recent content on Code Play</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <lastBuildDate>Fri, 26 Jul 2019 10:02:55 +0800</lastBuildDate>
    
        <atom:link href="https://blog.kk17.net/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>Diving Into Airflow Scheduler</title>
      <link>https://blog.kk17.net/post/diving-into-airflow-scheduler/</link>
      <pubDate>Fri, 26 Jul 2019 10:02:55 +0800</pubDate>
      
      <guid>https://blog.kk17.net/post/diving-into-airflow-scheduler/</guid>
      
        <description>&lt;p&gt;&lt;a href=&#34;../understand-airflow&#34;&gt;Last article&lt;/a&gt; we told about the basic concepts and architecture of Airflow, and we knew that Airflow has three major components:  &lt;code&gt;webserver&lt;/code&gt;,  &lt;code&gt;scheduler&lt;/code&gt; and &lt;code&gt;executor.&lt;/code&gt;  This article will talk about the detail of the &lt;code&gt;scheduler&lt;/code&gt; by diving into some of the source code(version: 1.10.1).&lt;/p&gt;

&lt;h2 id=&#34;key-concept&#34;&gt;Key Concept&lt;/h2&gt;

&lt;p&gt;We already told about the key concepts of Airflow, let&amp;rsquo;s recap some concepts use in airflow scheduler here.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Dag Files: Python files that could contain DAGs. A DAG can be definite in a single python file or in multiple python files packaged into an egg file.&lt;/li&gt;
&lt;li&gt;Dag (Directed Acyclic Graph): a workflow which glues all the tasks with inter-dependencies.&lt;/li&gt;
&lt;li&gt;Task: a parameterized instance of an operator/sensor which represents a unit of actual work to be executed.&lt;/li&gt;
&lt;li&gt;DagRun:  an object representing an instantiation of the DAG in time.&lt;/li&gt;
&lt;li&gt;TaskInstance: an object representing an instantiation of the Task in time.&lt;/li&gt;
&lt;li&gt;DagBag: a collection of dags, parsed out of a folder tree and has high
level configuration settings, like what database to use as a backend and
what executor to use to fire off tasks.&lt;/li&gt;
&lt;li&gt;Job: Jobs are processing items with state
and duration that aren&amp;rsquo;t task instances. There are three types of job in Airflow: ScheduleJob, LocalTaskJob, and BackfillJob.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;process-loop&#34;&gt;Process Loop&lt;/h2&gt;

&lt;p&gt;The Airflow scheduler is designed to run as a persistent service in an Airflow production environment. To kick it off, all you need to do is execute &lt;code&gt;airflow scheduler&lt;/code&gt; command. Let&amp;rsquo;s look at how Airflow parses this command and start the process loop.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://blog.kk17.net/process_loop_outer/process_loop_outer.svg&#34; alt=&#34;process_loop_outer&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Firstly, airflow use &lt;code&gt;argparse&lt;/code&gt; to parse the command and invoke the &lt;code&gt;scheduler&lt;/code&gt; function in &lt;code&gt;airflow.bin.cli&lt;/code&gt;. And then &lt;code&gt;scheduler&lt;/code&gt; function creates a ScheduleJob and run its &lt;code&gt;run&lt;/code&gt; method. The ScheduleJob will save itself to the database, start the executor and create a &lt;code&gt;DagFileProcessorManager&lt;/code&gt;. Eventually, the ScheduleJob will run a loop to invoke the &lt;code&gt;processor_manager periodically .heartbeat&lt;/code&gt; method.&lt;/p&gt;

&lt;p&gt;All the daemon service of Airflow are started by running &lt;code&gt;airflow {serve_name}&lt;/code&gt; command. Basically, the &lt;code&gt;airflow&lt;/code&gt; command is a python command-line script. We can look at the source code to know how it starts the service.&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/apache/airflow/blob/1.10.1/airflow/bin/airflow#L20&#34;&gt;airflow/bin/airflow&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;from&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;airflow.bin.cli&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;import&lt;/span&gt; CLIFactory

&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #19177C&#34;&gt;__name__&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;:
    parser &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; CLIFactory&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;get_parser()
    args &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; parser&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;parse_args()
    args&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;func(args)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/apache/airflow/blob/1.10.1/airflow/bin/cli.py#L1247&#34;&gt;airflow/bin/cli.py#CLIFactory&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;CLIFactory&lt;/span&gt;(&lt;span style=&#34;color: #008000&#34;&gt;object&lt;/span&gt;):
    args &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; {
        &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;dag_id&amp;#39;&lt;/span&gt;: Arg((&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;dag_id&amp;quot;&lt;/span&gt;,), &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;The id of the dag&amp;quot;&lt;/span&gt;),
        &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;task_id&amp;#39;&lt;/span&gt;: Arg((&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;task_id&amp;quot;&lt;/span&gt;,), &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;The id of the task&amp;quot;&lt;/span&gt;),
        &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
    },
    subparsers &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; (
      &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
      {
          &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;func&amp;#39;&lt;/span&gt;: scheduler,
          &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;help&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;Start a scheduler instance&amp;quot;&lt;/span&gt;,
          &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;args&amp;#39;&lt;/span&gt;: (&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;dag_id_opt&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;subdir&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;run_duration&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;num_runs&amp;#39;&lt;/span&gt;,
                   &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;do_pickle&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;pid&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;daemon&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;stdout&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;stderr&amp;#39;&lt;/span&gt;,
                   &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;log_file&amp;#39;&lt;/span&gt;),
      },
      &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
    )
    subparsers_dict &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; {sp[&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;func&amp;#39;&lt;/span&gt;]&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #19177C&#34;&gt;__name__&lt;/span&gt;: sp &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;for&lt;/span&gt; sp &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;in&lt;/span&gt; subparsers}
    dag_subparsers &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; (
        &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;list_tasks&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;backfill&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;test&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;run&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;pause&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;unpause&amp;#39;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;There are two important mappings in the &lt;code&gt;CLIFactory&lt;/code&gt;, &lt;code&gt;args&lt;/code&gt; maps the command line arguments to some default value and help information. &lt;code&gt;subparsers_dict&lt;/code&gt; maps the subcommand to objective python function.&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/apache/airflow/blob/1.10.1/airflow/bin/cli.py#L903&#34;&gt;airflow/bin/cli.py#scheduler&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #AA22FF&#34;&gt;@cli_utils.action_logging&lt;/span&gt;
&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;scheduler&lt;/span&gt;(args):
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;print&lt;/span&gt;(settings&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;HEADER)
    job &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; jobs&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;SchedulerJob(
        dag_id&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;args&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;dag_id,
        subdir&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;process_subdir(args&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;subdir),
        run_duration&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;args&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;run_duration,
        num_runs&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;args&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;num_runs,
        do_pickle&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;args&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;do_pickle)

    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; args&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;daemon:
        pid, stdout, stderr, log_file &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; setup_locations(&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;scheduler&amp;quot;&lt;/span&gt;,
        &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
        ctx &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; daemon&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;DaemonContext(
        &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;with&lt;/span&gt; ctx:
            job&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;run()
        &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;else&lt;/span&gt;:
        &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
        job&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;run()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/apache/airflow/blob/1.10.1/airflow/jobs.py#L191&#34;&gt;airflow/jobs.py#ScheduleJob.run&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span&gt;&lt;/span&gt;  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;run&lt;/span&gt;(&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;):
    Stats&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;incr(&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #19177C&#34;&gt;__class__&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #19177C&#34;&gt;__name__&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;lower() &lt;span style=&#34;color: #666666&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;_start&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;1&lt;/span&gt;)
    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# Adding an entry in the DB&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;with&lt;/span&gt; create_session() &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;as&lt;/span&gt; session:
        &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;state &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; State&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;RUNNING
        session&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;add(&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;)
        session&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;commit()
        &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;try&lt;/span&gt;:
            &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;_execute()
            &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# In case of max runs or max duration&lt;/span&gt;
            &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;state &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; State&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;SUCCESS
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;except&lt;/span&gt; &lt;span style=&#34;color: #D2413A; font-weight: bold&#34;&gt;SystemExit&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;as&lt;/span&gt; e:
        &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;finally&lt;/span&gt;:
            &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;end_date &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; timezone&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;utcnow()
            session&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;merge(&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;)
            session&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;commit()
  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;_execute&lt;/span&gt;(&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;):
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;raise&lt;/span&gt; &lt;span style=&#34;color: #D2413A; font-weight: bold&#34;&gt;NotImplementedError&lt;/span&gt;(&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;This method needs to be overridden&amp;quot;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can know that the scheduler service is actually an &lt;code&gt;airflow.jobs.SchedulerJob&lt;/code&gt; instance that runs its &lt;code&gt;run&lt;/code&gt; method. It will add itself into the database &lt;code&gt;job&lt;/code&gt; table and then run the &lt;code&gt;_execute&lt;/code&gt; helper method handling some and normal exit situations. Now let us look at the &lt;code&gt;_execute&lt;/code&gt; method.&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/apache/airflow/blob/1.10.1/airflow/jobs.py#L1544&#34;&gt;airflow/jobs.py#ScheduleJob._execute&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;_execute&lt;/span&gt;(&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;):
    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# Use multiple processes to parse and generate tasks for the&lt;/span&gt;
    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# DAGs in parallel. By processing them in separate processes,&lt;/span&gt;
    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# we can get parallelism and isolation from potentially harmful&lt;/span&gt;
    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# user code.&lt;/span&gt;

    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# Build up a list of Python files that could contain DAGs&lt;/span&gt;
    known_file_paths &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; list_py_file_paths(&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;subdir)

    processor_manager &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; DagFileProcessorManager(&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;subdir,
                                                known_file_paths,
                                                &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;max_threads,
                                                &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;file_process_interval,
                                                &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;file_process_interval,
                                                processor_factory)

    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;try&lt;/span&gt;:
        &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;_execute_helper(processor_manager)
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;finally&lt;/span&gt;:
        &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;log&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;info(&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;Exited execute loop&amp;quot;&lt;/span&gt;)

        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# Kill all child processes on exit since we don&amp;#39;t want to leave&lt;/span&gt;
        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# them as orphaned.&lt;/span&gt;
        pids_to_kill &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; processor_manager&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;get_all_pids()
        &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can see that &lt;code&gt;_execute&lt;/code&gt; method create a &lt;code&gt;processor_manager&lt;/code&gt; and the &lt;code&gt;processor_manager&lt;/code&gt; use &lt;code&gt;processor_factory&lt;/code&gt; to create a processor for each dag file_path. We can also find out it uses configurations which configured in the &lt;code&gt;airflow.cfg&lt;/code&gt; file.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span&gt;&lt;/span&gt;file_process_interval&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;conf&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;getint(&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;scheduler&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;min_file_process_interval&amp;#39;&lt;/span&gt;),
&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;heartrate &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; conf&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;getint(&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;scheduler&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;SCHEDULER_HEARTBEAT_SEC&amp;#39;&lt;/span&gt;)
&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;max_threads &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; conf&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;getint(&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;scheduler&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;max_threads&amp;#39;&lt;/span&gt;)

&lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# How often to scan the DAGs directory for new files. Default to 5 minutes.&lt;/span&gt;
&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;dag_dir_list_interval &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; conf&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;getint(&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;scheduler&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;dag_dir_list_interval&amp;#39;&lt;/span&gt;)
&lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# How often to print out DAG file processing stats to the log. Default to&lt;/span&gt;
&lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# 30 seconds.&lt;/span&gt;
&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;print_stats_interval &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; conf&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;getint(&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;scheduler&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;print_stats_interval&amp;#39;&lt;/span&gt;)
&lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# Parse and schedule each file no faster than this interval. Default&lt;/span&gt;
&lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# to 3 minutes.&lt;/span&gt;
&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;file_process_interval &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; file_process_interval

&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;max_tis_per_query &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; conf&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;getint(&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;scheduler&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;max_tis_per_query&amp;#39;&lt;/span&gt;)
&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; run_duration &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;is&lt;/span&gt; &lt;span style=&#34;color: #008000&#34;&gt;None&lt;/span&gt;:
    &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;run_duration &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; conf&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;getint(&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;scheduler&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;run_duration&amp;#39;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then the &lt;code&gt;_execute&lt;/code&gt; method run the &lt;code&gt;_execute_helper&lt;/code&gt; method.&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/apache/airflow/blob/1.10.1/a.irflow/jobs.py#L1627&#34;&gt;airflow/jobs.py#ScheduleJob._execute_helper&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;_execute_helper&lt;/span&gt;(&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;, processor_manager):
    &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;executor&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;start()

    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;## self.log.info(&amp;quot;Resetting orphaned tasks for active dag runs&amp;quot;)&lt;/span&gt;
    &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;reset_state_for_orphaned_tasks()

    execute_start_time &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; timezone&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;utcnow()

    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# Use this value initially&lt;/span&gt;
    known_file_paths &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; processor_manager&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;file_paths


    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# For the execute duration, parse and schedule DAGs&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;while&lt;/span&gt; (timezone&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;utcnow() &lt;span style=&#34;color: #666666&#34;&gt;-&lt;/span&gt; execute_start_time)&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;total_seconds() &lt;span style=&#34;color: #666666&#34;&gt;&amp;lt;&lt;/span&gt;    &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;run_duration &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;or&lt;/span&gt; &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;run_duration &lt;span style=&#34;color: #666666&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;0&lt;/span&gt;:
        &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;log&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;debug(&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;Starting Loop...&amp;quot;&lt;/span&gt;)

        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; elapsed_time_since_refresh &lt;span style=&#34;color: #666666&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;dag_dir_list_interval:
                    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# Build up a list of Python files that could contain DAGs&lt;/span&gt;
                    known_file_paths &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; list_py_file_paths(&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;subdir)
                    last_dag_dir_refresh_time &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; timezone&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;utcnow()
                    processor_manager&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;set_file_paths(known_file_paths)
                    &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;clear_nonexistent_import_errors    (known_file_paths&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;known_file_paths)

        simple_dags &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; processor_manager&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;heartbeat()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code&gt;_execute_helper&lt;/code&gt; starts the &lt;code&gt;executor&lt;/code&gt; and run the &lt;code&gt;processor_manager.heartbeat()&lt;/code&gt; in a loop with the configured &lt;code&gt;dag_dir_list_interval&lt;/code&gt;.&lt;/p&gt;

&lt;h2 id=&#34;dagfileprocessormanager-heartbeat&#34;&gt;DagFileProcessorManager Heartbeat&lt;/h2&gt;

&lt;p&gt;As fast as we know, the &lt;code&gt;processor_manager.heartbeat&lt;/code&gt; is the most important method in the process loop, so let&amp;rsquo;s dive into it.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://blog.kk17.net/process_loop_inner/process_loop_inner.svg&#34; alt=&#34;process_loop_inner&#34; /&gt;&lt;/p&gt;

&lt;p&gt;The &lt;code&gt;processor_manager&lt;/code&gt; actually maintains a list of DagFileProcessor(&lt;em&gt;don&amp;rsquo;t know how to present this list in the UML sequence diagram&lt;/em&gt;) to process the dag files. The max size of the processor list is configured in the &lt;code&gt;airflow.cfg&lt;/code&gt; -&amp;gt; &lt;code&gt;scheduler&lt;/code&gt;-&amp;gt; &lt;code&gt;max_threads&lt;/code&gt;. In the &lt;code&gt;heartbeat&lt;/code&gt; method, the &lt;code&gt;processor_manager.heartbeat&lt;/code&gt; kick off new &lt;code&gt;DagFileProcessor&lt;/code&gt; and &lt;code&gt;DagFileProcessor&lt;/code&gt; kick off new &lt;code&gt;multiprocessing. Process&lt;/code&gt; to process DAG definition files and read the results from the finished processors. One process corresponds to one &lt;code&gt;SchedulerJob&lt;/code&gt; instance. When the process started, it use &lt;code&gt;scheduler_job.process_file&lt;/code&gt; method to process the DAG files and stores the result into a queue. The &lt;code&gt;processor_manager&lt;/code&gt; collects all the results that were produced by processors that have finished since the last time this was called. it also starts more processors if necessary.&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/apache/airflow/blob/1.10.1/airflow/utils/dag_processing.py#L473&#34;&gt;airflow/utils/dag_processing.py#DagFileProcessorManager.heartbeat&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;heartbeat&lt;/span&gt;(&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;):
    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# get finished_processors and running_processors&lt;/span&gt;
    finished_processors &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; {}
    running_processors &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; {}
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;for&lt;/span&gt; file_path, processor &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;_processors&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;items():
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; processor&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;done:
            &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
            finished_processors[file_path] &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; processor
            &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;else&lt;/span&gt;:
            running_processors[file_path] &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; processor
    &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;_processors &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; running_processors

    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# Collect all the DAGs that were found in the processed files&lt;/span&gt;
    simple_dags &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; []
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;for&lt;/span&gt; file_path, processor &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;in&lt;/span&gt; finished_processors&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;items():
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; processor&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;result &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;is&lt;/span&gt; &lt;span style=&#34;color: #008000&#34;&gt;None&lt;/span&gt;:
            &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;else&lt;/span&gt;:
            &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;for&lt;/span&gt; simple_dag &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;in&lt;/span&gt; processor&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;result:
                simple_dags&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;append(simple_dag)

    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# Generate more file paths to process if we processed all the files&lt;/span&gt;
    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# already.&lt;/span&gt;
    &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# Start more processors if we have enough slots and files to process&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;while&lt;/span&gt; (&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;_parallelism &lt;span style=&#34;color: #666666&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #008000&#34;&gt;len&lt;/span&gt;(&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;_processors) &lt;span style=&#34;color: #666666&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;and&lt;/span&gt; &lt;span style=&#34;color: #008000&#34;&gt;len&lt;/span&gt;    (&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;_file_path_queue) &lt;span style=&#34;color: #666666&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;0&lt;/span&gt;):
        file_path &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;_file_path_queue&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;pop(&lt;span style=&#34;color: #666666&#34;&gt;0&lt;/span&gt;)
        processor &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;_processor_factory(file_path)

        processor&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;start()
        &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;_processors[file_path] &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; processor
    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# Update scheduler heartbeat count.&lt;/span&gt;
    &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;return&lt;/span&gt; simple_dags
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/apache/airflow/blob/1.10.1/airflow/jobs.py#L301&#34;&gt;airflow/jobs.py#DagFileProcessor&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;DagFileProcessor&lt;/span&gt;(AbstractDagFileProcessor, LoggingMixin):
    &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;_launch_process&lt;/span&gt;(result_queue,&lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;):
        &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;helper&lt;/span&gt;()
            scheduler_job &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; SchedulerJob(dag_ids&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;dag_id_white_list, log&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;log)
            result &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; scheduler_job&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;process_file(file_path, pickle_dags)
            result_queue&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;put(result)
        &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
        p &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; multiprocessing&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;Process(target&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;helper,
                                    args&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;(),
                                    name&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;{}-Process&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;format(thread_name))
        p&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;start()
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;return&lt;/span&gt; p
    &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;start&lt;/span&gt;(&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;):
        &lt;span style=&#34;color: #BA2121; font-style: italic&#34;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span style=&#34;color: #BA2121; font-style: italic&#34;&gt;        Launch the process and start processing the DAG.&lt;/span&gt;
&lt;span style=&#34;color: #BA2121; font-style: italic&#34;&gt;        &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;_process &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; DagFileProcessor&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;_launch_process(
            &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;_result_queue,
            &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;file_path,
            &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;_pickle_dags,
            &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;_dag_id_white_list,
            &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;DagFileProcessor{}&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;format(&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;_instance_id))
        &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;_start_time &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; timezone&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;utcnow()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id=&#34;schedulejob-process-file&#34;&gt;ScheduleJob Process File&lt;/h2&gt;

&lt;p&gt;Let&amp;rsquo;s keep diving into the &lt;code&gt;scheduler_job.process_file&lt;/code&gt; method.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://blog.kk17.net/process_file/process_file.svg&#34; alt=&#34;process_file&#34; /&gt;&lt;/p&gt;

&lt;p&gt;The &lt;code&gt;scheduler_job.process_file&lt;/code&gt; method first creates a &lt;code&gt;DagBag&lt;/code&gt; instance for the dag file path. In the &lt;code&gt;DagBag&lt;/code&gt; instance initiation, it loads the python modules in the file path using different std lib base on whether the path is a zip path.
After modules are loaded, &lt;code&gt;DagBag&lt;/code&gt; collects all the DAGs in the modules.
ScheduleJob then gets all dags from &lt;code&gt;DagBag&lt;/code&gt;, sync their states db and collect those dags which are not paused.&lt;/p&gt;

&lt;p&gt;ScheduleJob iterates over all the un-paused dags and processes them. Processing includes:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Calculate &lt;code&gt;next_run_date&lt;/code&gt; for dag and create appropriate &lt;code&gt;DagRun(s)&lt;/code&gt; in the DB.&lt;/li&gt;
&lt;li&gt;Create appropriate &lt;code&gt;TaskInstance(s)&lt;/code&gt; in the DB for new &lt;code&gt;DagRuns&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Find all active &lt;code&gt;DagRuns&lt;/code&gt; for a dag and iterate over their unscheduled &lt;code&gt;TaskInstances&lt;/code&gt;. If the dependencies of a &lt;code&gt;TaskInstance&lt;/code&gt; is met, update the state of the &lt;code&gt;TaskInstance&lt;/code&gt; to SCHEDULED.&lt;/li&gt;
&lt;li&gt;Send emails for tasks that have missed SLAs.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/apache/airflow/blob/1.10.1/airflow/jobs.py#L1771&#34;&gt;airflow/jobs.py#ScheduleJob.process_file&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;process_file&lt;/span&gt;(&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;, file_path, pickle_dags&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #008000&#34;&gt;False&lt;/span&gt;, session&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #008000&#34;&gt;None&lt;/span&gt;):
    simple_dags &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; []

    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;try&lt;/span&gt;:
        dagbag &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; models&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;DagBag(file_path)
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;except&lt;/span&gt; &lt;span style=&#34;color: #D2413A; font-weight: bold&#34;&gt;Exception&lt;/span&gt;:
        &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;return&lt;/span&gt; []
    &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# Save individual DAGs in the ORM and update DagModel.last_scheduled_time&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;for&lt;/span&gt; dag &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;in&lt;/span&gt; dagbag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;dags&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;values():
        dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;sync_to_db()

    paused_dag_ids &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; [dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;dag_id &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;for&lt;/span&gt; dag &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;in&lt;/span&gt; dagbag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;dags&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;values() &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;is_paused]

    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# Pickle the DAGs (if necessary) and put them into a SimpleDag&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;for&lt;/span&gt; dag_id &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;in&lt;/span&gt; dagbag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;dags:
        dag &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; dagbag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;get_dag(dag_id)
        &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# Only return DAGs that are not paused&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; dag_id &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;not&lt;/span&gt; &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;in&lt;/span&gt; paused_dag_ids:
            simple_dags&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;append(SimpleDag(dag, pickle_id&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;pickle_id))

    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #008000&#34;&gt;len&lt;/span&gt;(&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;dag_ids) &lt;span style=&#34;color: #666666&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;0&lt;/span&gt;:
        dags &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; [dag &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;for&lt;/span&gt; dag &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;in&lt;/span&gt; dagbag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;dags&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;values()
                &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;dag_id &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;dag_ids &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;and&lt;/span&gt;
                dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;dag_id &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;not&lt;/span&gt; &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;in&lt;/span&gt; paused_dag_ids]
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;else&lt;/span&gt;:
        dags &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; [dag &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;for&lt;/span&gt; dag &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;in&lt;/span&gt; dagbag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;dags&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;values()
                &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;not&lt;/span&gt; dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;parent_dag &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;and&lt;/span&gt;
                dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;dag_id &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;not&lt;/span&gt; &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;in&lt;/span&gt; paused_dag_ids]

    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# Not using multiprocessing.Queue() since it&amp;#39;s no longer a separate&lt;/span&gt;
    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# process and due to some unusual behavior. (empty() incorrectly&lt;/span&gt;
    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# returns true?)&lt;/span&gt;
    ti_keys_to_schedule &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; []
    &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;_process_dags(dagbag, dags, ti_keys_to_schedule)

    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;for&lt;/span&gt; ti_key &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;in&lt;/span&gt; ti_keys_to_schedule:
        dag &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; dagbag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;dags[ti_key[&lt;span style=&#34;color: #666666&#34;&gt;0&lt;/span&gt;]]
        task &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;get_task(ti_key[&lt;span style=&#34;color: #666666&#34;&gt;1&lt;/span&gt;])
        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# NOTE: create TaskInstance&lt;/span&gt;
        ti &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; models&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;TaskInstance(task, ti_key[&lt;span style=&#34;color: #666666&#34;&gt;2&lt;/span&gt;])
        ti&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;refresh_from_db(session&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;session, lock_for_update&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #008000&#34;&gt;True&lt;/span&gt;)
        &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
        dep_context &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; DepContext(deps&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;QUEUE_DEPS, ignore_task_deps&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #008000&#34;&gt;True&lt;/span&gt;)
        &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; ti&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;are_dependencies_met(
                dep_context&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;dep_context,
                session&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;session,
                verbose&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #008000&#34;&gt;True&lt;/span&gt;):
            &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# Task starts out in the scheduled state. All tasks in the&lt;/span&gt;
            &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# scheduled state will be sent to the executor&lt;/span&gt;
            ti&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;state &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; State&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;SCHEDULED

        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# Also save this task instance to the DB.&lt;/span&gt;
        &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;log&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;info(&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;Creating / updating &lt;/span&gt;&lt;span style=&#34;color: #BB6688; font-weight: bold&#34;&gt;%s&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt; in ORM&amp;quot;&lt;/span&gt;, ti)
        session&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;merge(ti)
    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# commit batch&lt;/span&gt;
    session&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;commit()

    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# Record import errors into the ORM&lt;/span&gt;
    &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# kill_zombies&lt;/span&gt;
    &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;

    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;return&lt;/span&gt; simple_dags
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/apache/airflow/blob/1.10.1/airflow/models/__init__.py#L265&#34;&gt;airflow/models/__init__.py#DagBag.process_file&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span&gt;&lt;/span&gt;    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;process_file&lt;/span&gt;(&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;, filepath, only_if_updated&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #008000&#34;&gt;True&lt;/span&gt;, safe_mode&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #008000&#34;&gt;True&lt;/span&gt;):
        &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
        mods &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; []
        is_zipfile &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; zipfile&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;is_zipfile(filepath)
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;not&lt;/span&gt; is_zipfile:
            &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
            org_mod_name, _ &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; os&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;path&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;splitext(os&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;path&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;split(filepath)[&lt;span style=&#34;color: #666666&#34;&gt;-1&lt;/span&gt;])
            mod_name &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
            &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
            &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;with&lt;/span&gt; timeout(configuration&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;conf&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;getint(&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;core&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;DAGBAG_IMPORT_TIMEOUT&amp;quot;&lt;/span&gt;)):
                &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;try&lt;/span&gt;:
                    m &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; imp&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;load_source(mod_name, filepath)
                    mods&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;append(m)
                &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;except&lt;/span&gt; &lt;span style=&#34;color: #D2413A; font-weight: bold&#34;&gt;Exception&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;as&lt;/span&gt; e:
                    &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;else&lt;/span&gt;:
            zip_file &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; zipfile&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;ZipFile(filepath)
            &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;for&lt;/span&gt; mod &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;in&lt;/span&gt; zip_file&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;infolist():
                head, _ &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; os&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;path&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;split(mod&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;filename)
                mod_name, ext &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; os&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;path&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;splitext(mod&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;filename)
                &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;not&lt;/span&gt; head &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;and&lt;/span&gt; (ext &lt;span style=&#34;color: #666666&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;.py&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;or&lt;/span&gt; ext &lt;span style=&#34;color: #666666&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;.pyc&amp;#39;&lt;/span&gt;):
                    &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
                    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;try&lt;/span&gt;:
                        sys&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;path&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;insert(&lt;span style=&#34;color: #666666&#34;&gt;0&lt;/span&gt;, filepath)
                        m &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; importlib&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;import_module(mod_name)
                        mods&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;append(m)
                    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;except&lt;/span&gt; &lt;span style=&#34;color: #D2413A; font-weight: bold&#34;&gt;Exception&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;as&lt;/span&gt; e:
                        &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;for&lt;/span&gt; m &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;in&lt;/span&gt; mods:
            &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;for&lt;/span&gt; dag &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color: #008000&#34;&gt;list&lt;/span&gt;(m&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #19177C&#34;&gt;__dict__&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;values()):
                &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #008000&#34;&gt;isinstance&lt;/span&gt;(dag, DAG):
                    &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
                    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;try&lt;/span&gt;:
                        dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;is_subdag &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #008000&#34;&gt;False&lt;/span&gt;
                        &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;bag_dag(dag, parent_dag&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;dag, root_dag&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;dag)
                        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #008000&#34;&gt;isinstance&lt;/span&gt;(dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;_schedule_interval, six&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;string_types):
                            croniter(dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;_schedule_interval)
                        found_dags&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;append(dag)
                        found_dags &lt;span style=&#34;color: #666666&#34;&gt;+=&lt;/span&gt; dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;subdags
                    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;except&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
        &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;file_last_changed[filepath] &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; file_last_changed_on_disk
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;return&lt;/span&gt; found_dags
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/apache/airflow/blob/1.10.1/airflow/jobs.py#L1398&#34;&gt;airflow/jobs.py#ScheduleJob._process_dags&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;_process_dags&lt;/span&gt;(&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;, dagbag, dags, tis_out):
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;for&lt;/span&gt; dag &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;in&lt;/span&gt; dags:
        &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
        dag_run &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;create_dag_run(dag)
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; dag_run:
            &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;log&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;info(&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;Created &lt;/span&gt;&lt;span style=&#34;color: #BB6688; font-weight: bold&#34;&gt;%s&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;&lt;/span&gt;, dag_run)
        &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;_process_task_instances(dag, tis_out)
        &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;manage_slas(dag)

    models&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;DagStat&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;update([d&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;dag_id &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;for&lt;/span&gt; d &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;in&lt;/span&gt; dags])
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/apache/airflow/blob/1.10.1/airflow/jobs.py#L783&#34;&gt;airflow/jobs.py#ScheduleJob.create_dag_run&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;create_dag_run&lt;/span&gt;(&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;, dag, session&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #008000&#34;&gt;None&lt;/span&gt;):
    &lt;span style=&#34;color: #BA2121; font-style: italic&#34;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span style=&#34;color: #BA2121; font-style: italic&#34;&gt;    This method checks whether a new DagRun needs to be created&lt;/span&gt;
&lt;span style=&#34;color: #BA2121; font-style: italic&#34;&gt;    for a DAG based on scheduling interval&lt;/span&gt;
&lt;span style=&#34;color: #BA2121; font-style: italic&#34;&gt;    Returns DagRun if one is scheduled. Otherwise returns None.&lt;/span&gt;
&lt;span style=&#34;color: #BA2121; font-style: italic&#34;&gt;    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;schedule_interval:
        active_runs &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; DagRun&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;find(&lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;)
        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# return if already reached maximum active runs and no timeout setting&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #008000&#34;&gt;len&lt;/span&gt;(active_runs) &lt;span style=&#34;color: #666666&#34;&gt;&amp;gt;=&lt;/span&gt; dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;max_active_runs &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;and&lt;/span&gt; &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;not&lt;/span&gt; dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;dagrun_timeout:
            &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;return&lt;/span&gt;
        timedout_runs &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;0&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;for&lt;/span&gt; dr &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;in&lt;/span&gt; active_runs:
            &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; (dr&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;start_date &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;and&lt;/span&gt; dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;dagrun_timeout &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;and&lt;/span&gt; dr&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;start_date &lt;span style=&#34;color: #666666&#34;&gt;&amp;lt;&lt;/span&gt; timezone&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;utcnow() &lt;span style=&#34;color: #666666&#34;&gt;-&lt;/span&gt; dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;dagrun_timeout):
                dr&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;state &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; State&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;FAILED
                dr&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;end_date &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; timezone&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;utcnow()
                dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;handle_callback(dr, success&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #008000&#34;&gt;False&lt;/span&gt;, reason&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;dagrun_timeout&amp;#39;&lt;/span&gt;,  dsession&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;session)
                timedout_runs &lt;span style=&#34;color: #666666&#34;&gt;+=&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;1&lt;/span&gt;
        session&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;commit()
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #008000&#34;&gt;len&lt;/span&gt;(active_runs) &lt;span style=&#34;color: #666666&#34;&gt;-&lt;/span&gt; timedout_runs &lt;span style=&#34;color: #666666&#34;&gt;&amp;gt;=&lt;/span&gt; dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;max_active_runs:
            &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;return&lt;/span&gt;

        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# this query should be replaced by find dagrun&lt;/span&gt;
        last_scheduled_run &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; session&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;query(func&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;max(DagRun&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;execution_date))&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;filter_by(&lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;)&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;scalar()

        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# don&amp;#39;t schedule @once again&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;schedule_interval &lt;span style=&#34;color: #666666&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;@once&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;and&lt;/span&gt; last_scheduled_run:
            &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color: #008000&#34;&gt;None&lt;/span&gt;

        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# don&amp;#39;t do scheduler catchup for dag&amp;#39;s that don&amp;#39;t have dag.catchup = True&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;not&lt;/span&gt; (dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;catchup &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;or&lt;/span&gt; dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;schedule_interval &lt;span style=&#34;color: #666666&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;@once&amp;#39;&lt;/span&gt;):
            &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
            dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;start_date &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt; &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# next_schedule_time_before_now&lt;/span&gt;

        next_run_date &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #008000&#34;&gt;None&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;not&lt;/span&gt; last_scheduled_run:
            &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# First run&lt;/span&gt;
            next_run_date &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt; &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# minimal start_time of dag tasks&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;else&lt;/span&gt;:
            next_run_date &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;following_schedule(last_scheduled_run)

        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# make sure backfills are also considered&lt;/span&gt;
        &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;

        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# don&amp;#39;t ever schedule prior to the dag&amp;#39;s start_date&lt;/span&gt;
        &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;

        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# don&amp;#39;t ever schedule in the future&lt;/span&gt;
        &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;

        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# this structure is necessary to avoid a TypeError from concatenating&lt;/span&gt;
        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# NoneType&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;schedule_interval &lt;span style=&#34;color: #666666&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;@once&amp;#39;&lt;/span&gt;:
            period_end &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; next_run_date
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;elif&lt;/span&gt; next_run_date:
            period_end &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;following_schedule(next_run_date)

        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# Don&amp;#39;t schedule a dag beyond its end_date (as specified by the dag param)&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; next_run_date &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;and&lt;/span&gt; dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;end_date &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;and&lt;/span&gt; next_run_date &lt;span style=&#34;color: #666666&#34;&gt;&amp;gt;&lt;/span&gt; dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;end_date:
            &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;return&lt;/span&gt;

        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# Don&amp;#39;t schedule a dag beyond its end_date (as specified by the task params)&lt;/span&gt;
        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# Get the min task end date, which may come from the dag.default_args&lt;/span&gt;
        &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;

        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; next_run_date &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;and&lt;/span&gt; period_end &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;and&lt;/span&gt; period_end &lt;span style=&#34;color: #666666&#34;&gt;&amp;lt;=&lt;/span&gt; timezone&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;utcnow():
            &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# create a dagrun and save it to db&lt;/span&gt;
            next_run &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;create_dagrun(
                run_id&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;DagRun&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;ID_PREFIX &lt;span style=&#34;color: #666666&#34;&gt;+&lt;/span&gt; next_run_date&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;isoformat(),
                execution_date&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;next_run_date,
                start_date&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;timezone&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;utcnow(),
                state&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;State&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;RUNNING,
                external_trigger&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #008000&#34;&gt;False&lt;/span&gt;
            )
            &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;return&lt;/span&gt; next_run
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/apache/airflow/blob/1.10.1/airflow/jobs.py#L914&#34;&gt;airflow/jobs.py##ScheduleJob._process_task_instances&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #AA22FF&#34;&gt;@provide_session&lt;/span&gt;
&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;_process_task_instances&lt;/span&gt;(&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;, dag, queue, session&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #008000&#34;&gt;None&lt;/span&gt;):
    &lt;span style=&#34;color: #BA2121; font-style: italic&#34;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span style=&#34;color: #BA2121; font-style: italic&#34;&gt;    This method schedules the tasks for a single DAG by looking at the&lt;/span&gt;
&lt;span style=&#34;color: #BA2121; font-style: italic&#34;&gt;    active DAG runs and adding task instances that should run to the&lt;/span&gt;
&lt;span style=&#34;color: #BA2121; font-style: italic&#34;&gt;    queue.&lt;/span&gt;
&lt;span style=&#34;color: #BA2121; font-style: italic&#34;&gt;    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;

    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# update the state of the previously active dag runs&lt;/span&gt;
    dag_runs &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; DagRun&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;find(dag_id&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;dag_id, state&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;State&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;RUNNING, session&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;session)
    active_dag_runs &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; []
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;for&lt;/span&gt; run &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;in&lt;/span&gt; dag_runs:
        &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;log&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;info(&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;Examining DAG run &lt;/span&gt;&lt;span style=&#34;color: #BB6688; font-weight: bold&#34;&gt;%s&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;&lt;/span&gt;, run)
        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# don&amp;#39;t consider runs that are executed in the future&lt;/span&gt;
        &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;

        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #008000&#34;&gt;len&lt;/span&gt;(active_dag_runs) &lt;span style=&#34;color: #666666&#34;&gt;&amp;gt;=&lt;/span&gt; dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;max_active_runs:
            &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;log&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;info(&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;Active dag runs &amp;gt; max_active_run.&amp;quot;&lt;/span&gt;)
            &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;continue&lt;/span&gt;

        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# skip backfill dagruns for now as long as they are not really scheduled&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; run&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;is_backfill:
            &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;continue&lt;/span&gt;

        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# todo: run.dag is transient but needs to be set&lt;/span&gt;
        run&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;dag &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; dag
        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# todo: preferably the integrity check happens at dag collection time&lt;/span&gt;
        run&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;verify_integrity(session&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;session)
        run&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;update_state(session&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;session)
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; run&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;state &lt;span style=&#34;color: #666666&#34;&gt;==&lt;/span&gt; State&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;RUNNING:
            make_transient(run)
            active_dag_runs&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;append(run)

    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;for&lt;/span&gt; run &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;in&lt;/span&gt; active_dag_runs:
        &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;log&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;debug(&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;Examining active DAG run: &lt;/span&gt;&lt;span style=&#34;color: #BB6688; font-weight: bold&#34;&gt;%s&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;&lt;/span&gt;, run)
        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# this needs a fresh session sometimes tis get detached&lt;/span&gt;
        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# Get a set of task instance related to this task for a specific date range.&lt;/span&gt;
        tis &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; run&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;get_task_instances(state&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;(State&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;NONE, State&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;UP_FOR_RETRY))

        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# this loop is quite slow as it uses are_dependencies_met for&lt;/span&gt;
        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# every task (in ti.is_runnable). This is also called in&lt;/span&gt;
        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# update_state above which has already checked these tasks&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;for&lt;/span&gt; ti &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;in&lt;/span&gt; tis:
            task &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; dag&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;get_task(ti&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;task_id)

            &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# fixme: ti.task is transient but needs to be set&lt;/span&gt;
            ti&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;task &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; task

            &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# future: remove adhoc&lt;/span&gt;
            &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; task&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;adhoc:
                &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;continue&lt;/span&gt;

            &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; ti&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;are_dependencies_met(
                    dep_context&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;DepContext(flag_upstream_failed&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #008000&#34;&gt;True&lt;/span&gt;),
                    session&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;session):
                &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;log&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;debug(&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;Queuing task: &lt;/span&gt;&lt;span style=&#34;color: #BB6688; font-weight: bold&#34;&gt;%s&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;&lt;/span&gt;, ti)
                queue&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;append(ti&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;key)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id=&#34;overview&#34;&gt;Overview&lt;/h2&gt;

&lt;p&gt;The Airflow scheduler spins up a process loop, which monitors and stays in sync with a folder for all DAG objects it may contain, and periodically (every minute or so) collects DAG parsing results and inspects active tasks to see whether they can be scheduled.&lt;/p&gt;

&lt;h2 id=&#34;reference&#34;&gt;Reference&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://airflow.apache.org/scheduler.html&#34;&gt;Scheduling &amp;amp; Triggers  Airflow Documentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
      
    </item>
    
    <item>
      <title>Understand Airflow</title>
      <link>https://blog.kk17.net/post/understand-airflow/</link>
      <pubDate>Wed, 24 Jul 2019 14:24:49 +0800</pubDate>
      
      <guid>https://blog.kk17.net/post/understand-airflow/</guid>
      
        <description>&lt;h2 id=&#34;key-concepts&#34;&gt;Key concepts&lt;/h2&gt;

&lt;p&gt;For context around the terms used in this blog post, here are a few key concepts for Airflow:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;DAG&lt;/strong&gt; (Directed Acyclic Graph): a workflow which glues all the tasks with inter-dependencies.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Operator&lt;/strong&gt;: a template for a specific type of work to be executed. For example, BashOperator represents how to execute a bash script, while PythonOperator represents how to execute a python function, etc.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Sensor&lt;/strong&gt;: a type of special operator which will only execute if a certain condition is met.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Task&lt;/strong&gt;: a parameterized instance of an operator/sensor which represents a unit of actual work to be executed.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Plugin&lt;/strong&gt;: an extension to allow users to easily extend Airflow with various custom hooks, operators, sensors, macros, and web views.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Pools&lt;/strong&gt;: concurrency limit configuration for a set of Airflow tasks.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;em&gt;Connections&lt;/em&gt;&lt;/strong&gt;to define any external DB, FTP etc. connections authentication.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;em&gt;Variables&lt;/em&gt;&lt;/strong&gt;to store and retrieve arbitrary content or settings as a simple key value.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;em&gt;XCom&lt;/em&gt;&lt;/strong&gt;to share keys/values between independent tasks.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Pools&lt;/strong&gt; to limit the execution parallelism on arbitrary sets of tasks.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Hooks&lt;/strong&gt; to reach external platforms and databases.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&#34;https://miro.medium.com/max/1400/1*N2CWqwBZiulBUwiPprKg4g.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Figure 3.2 Screenshots from the Airflow UI, Representing the example workflow DAG. Top Subpanel&lt;/strong&gt;: The Graph View of the &lt;code&gt;DagRun&lt;/code&gt; for Jan. 25th. Dark green nodes indicate &lt;code&gt;TaskInstance&lt;/code&gt;s with success states. The light green node depicts a &lt;code&gt;TaskInstance&lt;/code&gt; in the running state. &lt;strong&gt;Bottom Subpanel&lt;/strong&gt;: The Tree View of the &lt;code&gt;example_workflow&lt;/code&gt; DAG. The main components of Airflow are highlighted in screenshot, including Sensors, Operators, Tasks, &lt;code&gt;DagRuns&lt;/code&gt;, and &lt;code&gt;TaskInstances&lt;/code&gt;. &lt;code&gt;DagRuns&lt;/code&gt; are represented as columns in the graph view  the &lt;code&gt;DagRun&lt;/code&gt; for Jan. 25th is outlined in cyan. Each square in the graph view represents a &lt;code&gt;TaskInstance&lt;/code&gt;  the &lt;code&gt;TaskInstance&lt;/code&gt; for the (running) &lt;code&gt;perform_currency_conversion&lt;/code&gt; task on Jan. 25th is outlined in blue.&lt;/p&gt;

&lt;h2 id=&#34;airflow-architecture&#34;&gt;Airflow architecture&lt;/h2&gt;

&lt;p&gt;The following diagram shows the typical components of Airflow architecture.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://d2908q01vomqb2.cloudfront.net/f1f836cb4ea6efb2a0b1b99f41ad8b103eff4b59/2019/04/17/sagemaker-airflow-2.gif&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;em&gt;Scheduler:&lt;/em&gt;&lt;/strong&gt; The scheduler is a persistent service that monitors DAGs and tasks, and triggers the task instances whose dependencies have been met. The scheduler is responsible for invoking the executor defined in the Airflow configuration.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;em&gt;Executor:&lt;/em&gt;&lt;/strong&gt; Executors are the mechanism by which task instances get to run. Airflow by default provides different types of executors, and you can define custom executors, such as a Kubernetes executor.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;em&gt;Broker:&lt;/em&gt;&lt;/strong&gt; The broker queues the messages (task requests to be executed) and acts as a communicator between the executor and the workers.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;em&gt;Workers:&lt;/em&gt;&lt;/strong&gt; The actual nodes where tasks are executed and that return the result of the task.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;em&gt;Web server:&lt;/em&gt;&lt;/strong&gt; A webserver to render the Airflow UI.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;em&gt;Configuration file:&lt;/em&gt;&lt;/strong&gt; Configure settings such as executor to use, Airflow metadata database connections, DAG, and repository location. You can also define concurrency and parallelism limits, etc.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;em&gt;Metadata database:&lt;/em&gt;&lt;/strong&gt; Database to store all the metadata related to the DAGS, DAG runs, tasks, variables, and connections.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;reference-and-further-reading&#34;&gt;Reference and Further Reading&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://aws.amazon.com/cn/blogs/machine-learning/build-end-to-end-machine-learning-workflows-with-amazon-sagemaker-and-apache-airflow/&#34;&gt;Build end-to-end machine learning workflows with Amazon SageMaker and Apache Airflow | AWS Machine Learning Blog&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://eng.lyft.com/running-apache-airflow-at-lyft-6e53bb8fccff&#34;&gt;Running Apache Airflow At Lyft - Lyft Engineering&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://medium.com/@dustinstansbury/understanding-apache-airflows-key-concepts-a96efed52b1a&#34;&gt;Understanding Apache Airflows key concepts - Dustin Stansbury - Medium&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
      
    </item>
    
    <item>
      <title>Spark Run Mode and Application Deployment Mode</title>
      <link>https://blog.kk17.net/post/spark-run-mode-and-application-deployment-mode/</link>
      <pubDate>Tue, 16 Jul 2019 19:31:49 +0800</pubDate>
      
      <guid>https://blog.kk17.net/post/spark-run-mode-and-application-deployment-mode/</guid>
      
        <description>

&lt;p&gt;Spark running mode is often be confused with application deploy mode.&lt;/p&gt;

&lt;h2 id=&#34;spark-running-mode&#34;&gt;Spark Running Mode&lt;/h2&gt;

&lt;p&gt;Spark can run on a single local machine or on a cluster manager like Mesos or YARN to leverage the resources(memory, CPU, and so on) across the cluster.&lt;/p&gt;

&lt;h3 id=&#34;run-locally&#34;&gt;Run Locally&lt;/h3&gt;

&lt;p&gt;In local mode, spark jobs run on a single machine and are executed in parallel using multi-threading: this restricts parallelism to (at most) the number of cores in your machine.
The local mode can be enabled by setting the [master url][master-url] to &lt;code&gt;local&lt;/code&gt; or &lt;code&gt;local[x]&lt;/code&gt;. The biggest advantage of the local mode is that you don&amp;rsquo;t need to deploy a Spark cluster before you run a Spark application, so it&amp;rsquo;s usually used for developing and testing a Spark application.&lt;/p&gt;

&lt;h3 id=&#34;run-on-cluster&#34;&gt;Run on Cluster&lt;/h3&gt;

&lt;p&gt;Spark support serval type of &lt;a href=&#34;https://spark.apache.org/docs/latest/cluster-overview.html#cluster-manager-types&#34;&gt;cluster managers&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The system currently supports several cluster managers:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://spark.apache.org/docs/latest/spark-standalone.html&#34;&gt;Standalone&lt;/a&gt;  a simple cluster manager included with Spark that makes it easy to set up a cluster.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://spark.apache.org/docs/latest/running-on-mesos.html&#34;&gt;Apache Mesos&lt;/a&gt;  a general cluster manager that can also run Hadoop MapReduce and service applications.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://spark.apache.org/docs/latest/running-on-yarn.html&#34;&gt;Hadoop YARN&lt;/a&gt;  the resource manager in Hadoop 2.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://spark.apache.org/docs/latest/running-on-kubernetes.html&#34;&gt;Kubernetes&lt;/a&gt;  an open-source system for automating deployment, scaling, and management of containerized applications.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;A third-party project (not supported by the Spark project) exists to add support for &lt;a href=&#34;https://github.com/hashicorp/nomad-spark&#34;&gt;Nomad&lt;/a&gt; as a cluster manager.&lt;/p&gt;

&lt;p&gt;Examples of submitting an application on different types of cluster can be found on &lt;a href=&#34;https://spark.apache.org/docs/latest/submitting-applications.html#launching-applications-with-spark-submit&#34;&gt;Spark Offical Documents&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Below is an example that uses &lt;code&gt;docker-compose&lt;/code&gt; and &lt;a href=&#34;https://hub.docker.com/r/jupyter/pyspark-notebook/&#34;&gt;jupyter/pyspark-notebook&lt;/a&gt; docker image to set up a Spark Standalone Cluster and use the cluster for Jupyter.&lt;/p&gt;

&lt;h2 id=&#34;spark-application-deployment-mode&#34;&gt;Spark Application Deployment Mode&lt;/h2&gt;

&lt;p&gt;Before we going to the detail of deployment mode, we should know about the components of a Spark application.&lt;/p&gt;

&lt;p&gt;A Spark application is composed of the driver and executors that can run locally (on a single JVM) or using cluster resources (like CPU, RAM and disk that are managed by a cluster manager).&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://spark.apache.org/docs/latest/img/cluster-overview.png&#34; alt=&#34;A Spark application run on a cluster&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Deploy modes are all about where the Spark driver runs. Spark provides two types of deploy mode: client and cluster. In client deploy mode, the Spark driver (and SparkContext) runs on a client node outside a cluster whereas in cluster mode it runs inside a cluster, i.e. inside a YARN container alongside ApplicationMaster (that acts as the Spark application in YARN).&lt;/p&gt;

&lt;p&gt;Deploy mode can be specified using the &lt;code&gt;--deploy-mode&lt;/code&gt; parameter or &lt;code&gt;spark.submit.deployMode&lt;/code&gt; when submitting a Spark application.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;cluster deploy mode is only available for non-local cluster deployments.&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&#34;client-deployment-mode&#34;&gt;Client Deployment Mode&lt;/h3&gt;

&lt;p&gt;&lt;img src=&#34;https://www.cloudera.com/documentation/enterprise/5-4-x/images/spark-yarn-client.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Client deployment mode is the default mode when submitting a Spark application. In client mode, the driver daemon runs in the machine through which you submit the spark job to your cluster. This mode is great when you want to use Spark interactively like give some user input or use any shell command. Also, in this mode, you can use actions like &lt;code&gt;take()&lt;/code&gt; or &lt;code&gt;collect()&lt;/code&gt; which fetch all transformation results to the driver program and can be seen.&lt;/p&gt;

&lt;h3 id=&#34;cluster-deployment-mode&#34;&gt;Cluster Deployment Mode&lt;/h3&gt;

&lt;p&gt;&lt;img src=&#34;https://www.cloudera.com/documentation/enterprise/5-4-x/images/spark-yarn-cluster.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;In cluster mode, you don&amp;rsquo;t get to use the spark job interactively as the client through which you submit the job is gone as soon as it successfully submits the job to cluster. In this mode, most of the time, it&amp;rsquo;s a waste of memory to use &lt;code&gt;take()&lt;/code&gt;, as it will fetch all the results to your driver (in the cluster and not in the client that submit the job). So you may want to store the results of your transformation to a distributed environment like HDFS.
Some resources have to be reserved for the driver daemon process as it will be running in your cluster.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Cluster deploy mode is not applicable to Spark shell tools, including &lt;code&gt;spark-shell&lt;/code&gt;, &lt;code&gt;pyspark&lt;/code&gt; and &lt;code&gt;spark-sql&lt;/code&gt;.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&#34;reference-and-further-reading&#34;&gt;Reference and Further Reading&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.cloudera.com/documentation/enterprise/5-4-x/topics/cdh_ig_running_spark_on_yarn.html#concept_asc_2hr_gs&#34;&gt;Running Spark Applications on YARN | 5.4.x | Cloudera Documentation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jaceklaskowski.gitbooks.io/mastering-apache-spark/yarn/&#34;&gt;Spark on YARN  The Internals of Apache Spark&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://gist.github.com/kk17/356aa351dfe9db42303899ab9d8cb1b1&#34;&gt;Deploying Spark on Kubernetes Spark Standalone Cluster using Jupyter Docker Image&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.waitingforcode.com/apache-spark/docker-composing-apache-spark-yarn-image/read&#34;&gt;Docker-composing Apache Spark on YARN image on waitingforcode.com - articles about Apache Spark&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://testdriven.io/blog/deploying-spark-on-kubernetes/&#34;&gt;Deploying Spark on Kubernetes | TestDriven.io&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
      
    </item>
    
    <item>
      <title>YARN Basics</title>
      <link>https://blog.kk17.net/post/yarn-basics/</link>
      <pubDate>Mon, 15 Jul 2019 19:31:49 +0800</pubDate>
      
      <guid>https://blog.kk17.net/post/yarn-basics/</guid>
      
        <description>&lt;p&gt;&lt;a href=&#34;https://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-site/YARN.html&#34;&gt;Apache Hadoop YARN&lt;/a&gt; is the cluster manager for Hadoop MapReduce, but it can also be used for other compute framework such as Spark. YARN(Yet Another Resource Negotiator) was introduced since Hadoop 2.0 to split up the functionalities of resource management and job scheduling/monitoring into separate daemons. The idea is to have a global ResourceManager (RM) and per-application ApplicationMaster (AM). An application is either a single job or a DAG of jobs.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-site/yarn_architecture.gif&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;ResourceManager&lt;/strong&gt; is the ultimate authority that arbitrates resources among all the applications in the system. There is only one global ResourceManager in a YARN cluster and it has two main components:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Scheduler&lt;/strong&gt; is responsible for allocating resources to the various running applications subject to familiar constraints of capacities, queues etc.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ApplicationsManager&lt;/strong&gt; is responsible for accepting job-submissions, negotiating the first container for executing the application specific ApplicationMaster and provides the service for restarting the ApplicationMaster container on failure.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;NodeManager&lt;/strong&gt; is the per-machine framework agent who is responsible for containers, monitoring their resource usage (cpu, memory, disk, network) and reporting the same to the ResourceManager/Scheduler.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;ApplicationMaster&lt;/strong&gt; is responsible for negotiating appropriate resource containers from the Scheduler, tracking their status and monitoring for progress. The ApplicationMaster is run per-application.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;spark-on-yarn&#34;&gt;Spark On YARN&lt;/h2&gt;

&lt;p&gt;How Spark executors are started in YARN cluster mode:&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://trello-attachments.s3.amazonaws.com/5cc443a11c07cb4a8711dceb/5d1dadb1bce6c77b381e18ef/29b5697eaeeb984f0ca873b8ae1bff74/image.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;reference&#34;&gt;Reference&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-site/YARN.html&#34;&gt;Apache Hadoop 2.9.2  Apache Hadoop YARN&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.cloudera.com/blog/2015/09/untangling-apache-hadoop-yarn-part-1/&#34;&gt;Untangling Apache Hadoop YARN, Part 1: Cluster and YARN Basics - Cloudera Engineering Blog&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.cloudera.com/documentation/enterprise/5-3-x/topics/cdh_ig_yarn_tuning.html&#34;&gt;Tuning YARN | 5.3.x | Cloudera Documentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
      
    </item>
    
    <item>
      <title>How to Extend Spark</title>
      <link>https://blog.kk17.net/post/how-to-extend-spark/</link>
      <pubDate>Sat, 25 May 2019 17:43:29 +0800</pubDate>
      
      <guid>https://blog.kk17.net/post/how-to-extend-spark/</guid>
      
        <description>&lt;p&gt;In this post, we go through extending a Spark application and also Spark APIs by some examples. These two kinds of extensions are sometimes related, and we go with extending a Spark application first.&lt;/p&gt;

&lt;h2 id=&#34;extend-a-spark-application&#34;&gt;Extend a Spark Application&lt;/h2&gt;

&lt;p&gt;When we write a Spark application, it quite common that our code depends on other projects. There are several
ways to submit your application to Spark with dependencies. The first way is to create an assembly jar (or uber jar) containing your code and its dependencies. Both &lt;a href=&#34;https://github.com/sbt/sbt-assembly&#34;&gt;sbt&lt;/a&gt; and &lt;a href=&#34;http://maven.apache.org/plugins/maven-shade-plugin/&#34;&gt;Maven&lt;/a&gt; have assembly plugins.
Another more easy and common way is to use &lt;code&gt;--jars&lt;/code&gt; option of &lt;code&gt;spark-submit&lt;/code&gt; command to specify your dependent jars and these jars are automatically transferred to the cluster. For Python, the equivalent &lt;code&gt;--py-files&lt;/code&gt; option can be used to distribute .egg, .zip and .py libraries to executors.&lt;/p&gt;

&lt;p&gt;If you use Maven to manage your dependencies, you can simply supply a comma-delimited list of Maven coordinates with &lt;code&gt;--packages&lt;/code&gt;. All transitive dependencies are handled when using this command. Additional repositories (or resolvers in SBT) can be added in a comma-delimited fashion with the flag &lt;code&gt;--repositories&lt;/code&gt;. If you want to know more about these methods you can find &lt;a href=&#34;https://spark.apache.org/docs/latest/submitting-applications.html&#34;&gt;more information&lt;/a&gt; on Spark Document.&lt;/p&gt;

&lt;p&gt;Spark also allow specify a default &lt;code&gt;spark.jars&lt;/code&gt; and &lt;code&gt;spark.packages&lt;/code&gt; in &lt;code&gt;spark-defaults.conf&lt;/code&gt; configuration file. These two properties can specify programmatically in your application. What I found out is that if the &lt;code&gt;--jars&lt;/code&gt; and &lt;code&gt;--packages&lt;/code&gt; options will override  corresponding properties in the configuration file and specifying these two properties programmatically sometimes do not work.&lt;/p&gt;

&lt;p&gt;Putting the dependencies jars directly into &lt;code&gt;${SPARK_HOME}/jars&lt;/code&gt; directory is another method. This effect all the applications, and if you submit an application with &lt;code&gt;deploy-mode=cluster&lt;/code&gt; option, you need to make sure the dependencies jars exits in the Spark lib directory of driver machine.&lt;/p&gt;

&lt;p&gt;Examples code for testing these methods can be found here: &lt;a href=&#34;https://github.com/kk17/extend_spark_application_example&#34;&gt;extend_spark_application_example&lt;/a&gt;. If you want to know more about all these options, you can read the discussion &lt;a href=&#34;https://stackoverflow.com/questions/37132559/add-jars-to-a-spark-job-spark-submit&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&#34;extend-spark-apis&#34;&gt;Extend Spark APIs&lt;/h2&gt;

&lt;p&gt;Sometimes we may find that Spark APIs cannot satisfy our requirements. Therefore we want to
add some custom feature into Spark APIs.&lt;/p&gt;

&lt;p&gt;If we add new APIs, we can simply package our extension code and put the jar file into &lt;code&gt;${SPARK_HOME}/jars&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&#34;use-extension-points&#34;&gt;Use extension points&lt;/h3&gt;

&lt;p&gt;If we want to modify Spark APIs, things became a bit more complicated. Spark provides some extension points which added in &lt;a href=&#34;https://issues.apache.org/jira/browse/SPARK-18127&#34;&gt;SPARK-18127&lt;/a&gt; that can be used to inject our custom code. For example, The &lt;a href=&#34;https://spark.apache.org/docs/2.3.0/api/java/org/apache/spark/sql/SparkSessionExtensions.html&#34;&gt;SparkSessionExtensions&lt;/a&gt; provides the following extension points:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Analyzer Rules.&lt;/li&gt;
&lt;li&gt;Check Analysis Rules&lt;/li&gt;
&lt;li&gt;Optimizer Rules.&lt;/li&gt;
&lt;li&gt;Planning Strategies.&lt;/li&gt;
&lt;li&gt;Customized Parser.&lt;/li&gt;
&lt;li&gt;(External) Catalog listeners.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/kk17/spark-authorizer&#34;&gt;spark-authorizer&lt;/a&gt;, one of the projects I involved, is using SparkSessionExtensions to inject an optimizer rule that used to implement user authorization. I demonstrate the steps below.&lt;/p&gt;

&lt;h4 id=&#34;step-1-create-an-optimizer-rule-class&#34;&gt;Step 1: Create an Optimizer rule class&lt;/h4&gt;

&lt;p&gt;To implement the authorization, use the &lt;code&gt;AuthorizerExtension&lt;/code&gt;  class as shown in the following example:&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-scala&#34; data-lang=&#34;scala&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;org.apache.spark.sql.catalyst.optimizer&lt;/span&gt;

&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;AuthorizerExtension&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;spark&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;SparkSession&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;extends&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;Rule&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #B00040&#34;&gt;LogicalPlan&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;with&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;Authorizable&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-scala&#34; data-lang=&#34;scala&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;trait&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;Authorizable&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;extends&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;Rule&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #B00040&#34;&gt;LogicalPlan&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;with&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;Logging&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;

  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; spark&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;SparkSession&lt;/span&gt;

  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;override&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; apply&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;plan&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;LogicalPlan&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;LogicalPlan&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; operationType&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;HiveOperationType&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; getOperationType&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;plan&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;in&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt; out&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;PrivilegesBuilder&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;build&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;plan&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;
    spark&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;sharedState&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;externalCatalog &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;match&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;
      &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;_:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;HiveExternalCatalog&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;=&amp;gt;&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;try&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;
          &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;AuthorizationProvider&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;checkPrivileges&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;
            spark&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt;
            &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;AuthorizationRequest&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;operationType&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt; in&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt; out&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;
          &lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;
        &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;catch&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;
          &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;case&lt;/span&gt; hae&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;HiveAccessControlException&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;=&amp;gt;&lt;/span&gt;
            error&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;
              &lt;span style=&#34;color: #BA2121&#34;&gt;s&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span style=&#34;color: #BA2121&#34;&gt;                 |+===============================+&lt;/span&gt;
&lt;span style=&#34;color: #BA2121&#34;&gt;                 ||Spark SQL Authorization Failure|&lt;/span&gt;
&lt;span style=&#34;color: #BA2121&#34;&gt;                 ||-------------------------------|&lt;/span&gt;
&lt;span style=&#34;color: #BA2121&#34;&gt;                 ||&lt;/span&gt;&lt;span style=&#34;color: #BB6688; font-weight: bold&#34;&gt;${&lt;/span&gt;hae&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;getMessage&lt;span style=&#34;color: #BB6688; font-weight: bold&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color: #BA2121&#34;&gt;                 ||-------------------------------|&lt;/span&gt;
&lt;span style=&#34;color: #BA2121&#34;&gt;                 ||Spark SQL Authorization Failure|&lt;/span&gt;
&lt;span style=&#34;color: #BA2121&#34;&gt;                 |+===============================+&lt;/span&gt;
&lt;span style=&#34;color: #BA2121&#34;&gt;               &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;stripMargin&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;
            &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;throw&lt;/span&gt; hae
          &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;case&lt;/span&gt; e&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;Exception&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;throw&lt;/span&gt; e
        &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;
      &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;_&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&amp;gt;&lt;/span&gt;
    &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;
    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;// iff no exception.&lt;/span&gt;
    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;// We just return the original plan here, so this rule will be executed only once.&lt;/span&gt;
    plan
  &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;step-2-create-a-first-class-function-with-the-extension-points-api-to-add-a-new-rule&#34;&gt;Step 2: Create a first-class function with the Extension Points API to add a new rule&lt;/h4&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-scala&#34; data-lang=&#34;scala&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;org.apache.spark.sql.authorization&lt;/span&gt;

&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;AuthorizationExtension&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;extends&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;SparkSessionExtensions&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;Unit&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;
  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;override&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; apply&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;ext&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;SparkSessionExtensions&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;Unit&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;
    ext&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;injectOptimizerRule&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;AuthorizerExtension&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;
  &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;step-3-enable-the-customized-rule&#34;&gt;Step 3: Enable the customized rule&lt;/h4&gt;

&lt;p&gt;There are two ways to enable customized rule. One is using the &lt;code&gt;withExtensions&lt;/code&gt; option when creating SparkSession.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-scala&#34; data-lang=&#34;scala&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; spark &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;SparkSession&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;builder&lt;span style=&#34;color: #666666&#34;&gt;().&lt;/span&gt;withExtensions&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;AuthorizerExtension&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;).&lt;/span&gt;getOrCreate&lt;span style=&#34;color: #666666&#34;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;However, we want the authorization rule to be enabled by default, so we choose to configure the &lt;code&gt;spark-defaults.conf&lt;/code&gt; by adding the following line.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;spark.sql.extensions org.apache.spark.sql.authorization.AuthorizationExtension
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;SparkSessionExtensions do not work on &lt;code&gt;pyspark&lt;/code&gt; 2.2.x and 2.3.x. You can find the issue discussed &lt;a href=&#34;https://issues.apache.org/jira/browse/SPARK-25003&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&#34;modify-spark-source-code-directly&#34;&gt;Modify Spark source code directly&lt;/h3&gt;

&lt;p&gt;Sometimes the extension point many can match our need for some reasons. One of this situation is that there is a bug in Spark that affects our application, and this bug will not be fixed by Spark maintainers. One of these bugs I run into is &lt;a href=&#34;https://issues.apache.org/jira/browse/SPARK-24570&#34;&gt;SPARK-24570&lt;/a&gt;: Spark Thrift Server having a problem showing schemas SQL client tools. I solved this problem by &lt;a href=&#34;https://github.com/kk17/spark/commit/0b06526019cb9a0ba1857b41c3a47dd7bce87529&#34;&gt;modify&lt;/a&gt; Spark source code directly and built a new thrift-server jar.&lt;/p&gt;

&lt;h3 id=&#34;use-aspect-oriented-programming-aop-extension&#34;&gt;Use aspect-oriented programming (AOP) extension&lt;/h3&gt;

&lt;p&gt;Because Scala, the native program language used by Spark, is a JVM language. So we can &lt;a href=&#34;https://www.eclipse.org/aspectj/&#34;&gt;AspectJ&lt;/a&gt; to intercept Spark code. In this way, we can modify the Spark APIs without modifying Spark source code directly.&lt;/p&gt;

&lt;p&gt;For those not familiar with AspectJ, here is a brief introduction. AspectJ is an aspect-oriented programming (AOP) extension created at PARC for the Java programming language. AspectJ has become a widely used de facto standard for AOP by emphasizing simplicity and usability for end users.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://blog.kk17.net/img/aop.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;I used AspectJ in the &lt;a href=&#34;https://github.com/kk17/spark-authorizer&#34;&gt;spark-authorizer&lt;/a&gt; project. I use it to enhance Spark SessionCatalog, making it only return the databases and tables user have privileges to access.&lt;/p&gt;

&lt;h4 id=&#34;step-1-create-a-aspect-class&#34;&gt;Step 1: Create a aspect class&lt;/h4&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-scala&#34; data-lang=&#34;scala&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;org.apache.spark.sql.catalyst.catalog&lt;/span&gt;

&lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;SessionCatalogAspect&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;extends&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;Logging&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;

  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;lazy&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; spark&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;SparkSession&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;SparkSession&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;getActiveSession
    &lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;getOrElse&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;SparkSession&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;getDefaultSession&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;get&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;

  &lt;span style=&#34;color: #AA22FF&#34;&gt;@Around&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;execution(public * org.apache.spark.sql.catalyst.catalog.SessionCatalog.listDatabases(..))&amp;quot;&lt;/span&gt;
  &lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;
  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; filterListDatabasesResult&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;pjp&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;ProceedingJoinPoint&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;Seq&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #B00040&#34;&gt;String&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;
    logDebug&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;filterListDatabasesResult&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; dbs &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; pjp&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;proceed&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;asInstanceOf&lt;span style=&#34;color: #666666&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #B00040&#34;&gt;Seq&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #B00040&#34;&gt;String&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;]]&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; operationType&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;HiveOperationType&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;HiveOperationType&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;SWITCHDATABASE&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; requests &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; dbs&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;map &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt; db &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&amp;gt;&lt;/span&gt;
      &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; inputObjs &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;JAList&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #B00040&#34;&gt;HPO&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;]&lt;/span&gt;
      &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; outputObjs &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;JAList&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #B00040&#34;&gt;HPO&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;]&lt;/span&gt;
      inputObjs&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;add&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;
        &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;HivePrivilegeObject&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;HivePrivilegeObjectType&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;DATABASE&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt; db&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt; db&lt;span style=&#34;color: #666666&#34;&gt;))&lt;/span&gt;
      &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;AuthorizationRequest&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;operationType&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt; inputObjs&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt; outputObjs&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;
    &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; result &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;AuthorizationProvider&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;checkPrivileges&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;spark&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt; requests&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;
    &lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;dbs zip result&lt;span style=&#34;color: #666666&#34;&gt;).&lt;/span&gt;filter&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;_&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;_2&lt;span style=&#34;color: #666666&#34;&gt;).&lt;/span&gt;map&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;_&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;_1&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;
  &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;

&lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;step-2-create-a-aspectj-configuration-file&#34;&gt;Step 2: create a AspectJ configuration file&lt;/h4&gt;

&lt;p&gt;create a &lt;code&gt;aop.xml&lt;/code&gt; file in &lt;code&gt;META-INFO&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #BC7A00&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot; ?&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;aspectj&amp;gt;&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;aspects&amp;gt;&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;aspect&lt;/span&gt; &lt;span style=&#34;color: #7D9029&#34;&gt;name=&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;org.apache.spark.sql.catalyst.catalog.SessionCatalogAspect&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;/&amp;gt;&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/aspects&amp;gt;&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;weaver&lt;/span&gt; &lt;span style=&#34;color: #7D9029&#34;&gt;options=&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;-Xset:weaveJavaxPackages=true&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;/&amp;gt;&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;weaver&lt;/span&gt; &lt;span style=&#34;color: #7D9029&#34;&gt;options=&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;-XaddSerialVersionUID&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;/&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/aspectj&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;step-3-enable-aspectj-aspects-in-spark&#34;&gt;Step 3: enable AspectJ aspects in Spark&lt;/h4&gt;

&lt;p&gt;To enable AspectJ aspects in Spark, you need to put the jar file contains the aspects into &lt;code&gt;${SPARK_HOME}/jars&lt;/code&gt; and add the following line to &lt;code&gt;spark-defaults.conf&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;spark.driver.extraJavaOptions -javaagent:/path/to/aspectjweaver-{version}.jar
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;handle-code-conflict-with-spark-code&#34;&gt;Handle code conflict with Spark Code&lt;/h2&gt;

&lt;p&gt;Spark itself has large source code and depends on many third party projects. When you add code to extend Spark, there is a risk that your code or the dependencies of your code conflict with Spark code. The maintainers of Spark do try to decrease the possibility of conflict. That&amp;rsquo;s the reason they &lt;a href=&#34;https://issues.apache.org/jira/browse/SPARK-5293&#34;&gt;replace Akka&lt;/a&gt; with alternative RPC implementations and a common event loop in Spark. As a user, we also have some methods to avoid these conflicts.&lt;/p&gt;

&lt;h3 id=&#34;shade-your-code&#34;&gt;Shade your code&lt;/h3&gt;

&lt;p&gt;Shading a dependency consists of taking its content (resources files and Java class files) and renaming some of its packages before putting them in the same JAR file. Both SBT and &lt;a href=&#34;http://maven.apache.org/plugins/maven-shade-plugin/&#34;&gt;Maven&lt;/a&gt; have shade plugins.&lt;/p&gt;

&lt;p&gt;An example for shading use SBT can be found &lt;a href=&#34;https://github.com/wsargent/shade-with-sbt-assembly&#34;&gt;wsargent/shade-with-sbt-assembly: SBT project showing shading a library with SBT assembly&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;An example for shading use Maven can be found on &lt;a href=&#34;https://github.com/kk17/spark/tree/v2.3.2/sql/shaded-hive-thriftserver/pom.xml&#34;&gt;the Spark Thrift Service source code I modified&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;project&lt;/span&gt; &lt;span style=&#34;color: #7D9029&#34;&gt;xmlns=&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;http://maven.apache.org/POM/4.0.0&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #7D9029&#34;&gt;xmlns:xsi=&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;&lt;/span&gt;
         &lt;span style=&#34;color: #7D9029&#34;&gt;xsi:schemaLocation=&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;
  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;modelVersion&amp;gt;&lt;/span&gt;4.0.0&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/modelVersion&amp;gt;&lt;/span&gt;
  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;parent&amp;gt;&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.apache.spark&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spark-parent_2.11&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;2.3.2&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;relativePath&amp;gt;&lt;/span&gt;../../pom.xml&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/relativePath&amp;gt;&lt;/span&gt;
  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/parent&amp;gt;&lt;/span&gt;

  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;shaded-spark-hive-thriftserver_2.11&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;packaging&amp;gt;&lt;/span&gt;jar&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/packaging&amp;gt;&lt;/span&gt;
  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Shaded Spark Project Hive Thrift Server&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;url&amp;gt;&lt;/span&gt;http://spark.apache.org/&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/url&amp;gt;&lt;/span&gt;
  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;properties&amp;gt;&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;sbt.project.name&amp;gt;&lt;/span&gt;shaded-hive-thriftserver&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/sbt.project.name&amp;gt;&lt;/span&gt;
  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/properties&amp;gt;&lt;/span&gt;

  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;dependencies&amp;gt;&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
      &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.apache.spark&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
      &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spark-hive-thriftserver_${scala.binary.version}&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
      &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;${project.version}&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/dependencies&amp;gt;&lt;/span&gt;
  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;build&amp;gt;&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;outputDirectory&amp;gt;&lt;/span&gt;target/scala-${scala.binary.version}/classes&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/outputDirectory&amp;gt;&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;testOutputDirectory&amp;gt;&lt;/span&gt;target/scala-${scala.binary.version}/test-classes&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/testOutputDirectory&amp;gt;&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;plugins&amp;gt;&lt;/span&gt;
      &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;plugin&amp;gt;&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.apache.maven.plugins&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;maven-shade-plugin&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;executions&amp;gt;&lt;/span&gt;
          &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;execution&amp;gt;&lt;/span&gt;
            &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;phase&amp;gt;&lt;/span&gt;package&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/phase&amp;gt;&lt;/span&gt;
            &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;goals&amp;gt;&lt;/span&gt;
              &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;goal&amp;gt;&lt;/span&gt;shade&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/goal&amp;gt;&lt;/span&gt;
            &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/goals&amp;gt;&lt;/span&gt;
            &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;configuration&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;
              &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;artifactSet&amp;gt;&lt;/span&gt;
                &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;includes&amp;gt;&lt;/span&gt;
                  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;include&amp;gt;&lt;/span&gt;org.apache.spark:spark-hive-thriftserver_${scala.binary.version}&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/include&amp;gt;&lt;/span&gt;
                &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/includes&amp;gt;&lt;/span&gt;
              &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/artifactSet&amp;gt;&lt;/span&gt;
              &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;relocations&amp;gt;&lt;/span&gt;
                &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;relocation&amp;gt;&lt;/span&gt;
                  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;pattern&amp;gt;&lt;/span&gt;org.apache.spark.sql.hive.thriftserver&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/pattern&amp;gt;&lt;/span&gt;
                  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;shadedPattern&amp;gt;&lt;/span&gt;shaded.org.apache.spark.sql.hive.thriftserver&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/shadedPattern&amp;gt;&lt;/span&gt;
                  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;includes&amp;gt;&lt;/span&gt;
                    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;include&amp;gt;&lt;/span&gt;org.apache.spark.sql.hive.thriftserver.**&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/include&amp;gt;&lt;/span&gt;
                  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/includes&amp;gt;&lt;/span&gt;
                &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/relocation&amp;gt;&lt;/span&gt;
              &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/relocations&amp;gt;&lt;/span&gt;
            &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/configuration&amp;gt;&lt;/span&gt;
          &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/execution&amp;gt;&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/executions&amp;gt;&lt;/span&gt;
      &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/plugin&amp;gt;&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/plugins&amp;gt;&lt;/span&gt;
  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/build&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/project&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;I created a new module called &lt;code&gt;shaded-spark-hive-thriftserver&lt;/code&gt; to shade the code from the original &lt;code&gt;spark-hive-thriftserver&lt;/code&gt; module. After this shading, I use the shaded class &lt;code&gt;shaded.org.apache.spark.sql.hive.thriftserver.HiveThriftServer2&lt;/code&gt; as the Main class of my application, so I don&amp;rsquo;t need to replace the original &lt;code&gt;spark-hive-thriftserver&lt;/code&gt; jar in the Spark lib directory.&lt;/p&gt;

&lt;h3 id=&#34;shim&#34;&gt;Shim&lt;/h3&gt;

&lt;p&gt;By renaming resources, shading avoids possible resource conflicts. It&amp;rsquo;s powerful but also limited. User needs to use the renamed resources on his own. Think about injecting an authorization rule into Spark mentioned above. The authorization rule has third-party dependencies. To keep the functionality of the authorization rule and avoid possible code conflicts at the same time, we need to make the extension class visible for Spark while other classes are isolated from Spark. The way of doing this is by using a shim.&lt;/p&gt;

&lt;p&gt;In computer science, shims can have two meanings. In general, a shim is a small library that transparently intercepts an API, changing the parameters passed, handling the operation itself, or redirecting the operation elsewhere. This kind of shims is used in Spark, like the &lt;a href=&#34;https://github.com/apache/spark/blob/master/sql/hive/src/main/scala/org/apache/spark/sql/hive/client/HiveShim.scala&#34;&gt;HiveShim&lt;/a&gt;, but what I am going to talk about is the other kind of shims. These shims are used to isolate your application code from other parts of the system. Shims divert calls to specific methods to the actual implementation code that you write.&lt;/p&gt;

&lt;p&gt;When I developing the spark-authorizer project, I got this shim idea from &lt;a href=&#34;https://github.com/apache/ranger/tree/master/ranger-hive-plugin-shim&#34;&gt;ranger-hive-plugin-shim&lt;/a&gt;, then I developed a similar shim for the spark-authorizer.&lt;/p&gt;

&lt;p&gt;When a class is loaded into two runtime classes by different ClassLoaders, these two classes are treated as different classes in JVM runtime. The principle behinds this kind of shims is that we create a proxy class for our application entrance class, and then this proxy uses an independent ClassLoader to load you actual implement class from a specific place. The proxy redirects the calls to the actual class. Therefore the real code is isolated. Below is the shim code I wrote for &lt;code&gt;AuthorizationExtension&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-scala&#34; data-lang=&#34;scala&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;org.apache.spark.sql.authorization&lt;/span&gt;

&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;AuthorizationExtension&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;extends&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;SparkSessionExtensions&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;Unit&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;with&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;Logging&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;

  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;SPARK_PLUGIN_TYPE&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;authorizer&amp;quot;&lt;/span&gt;
  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;AUTHORIZER_IMPL_CLASSNAME&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;org.apache.spark.sql.catalyst.optimizer.AuthorizerExtension&amp;quot;&lt;/span&gt;

  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;lazy&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; pluginClassLoader &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;SparkPluginClassLoader&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;getInstance&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;SPARK_PLUGIN_TYPE&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;this&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;getClass&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;

  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;lazy&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; authorizerImpl&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;SparkSession&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;Rule&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #B00040&#34;&gt;LogicalPlan&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;
    logDebug&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;==&amp;gt; AuthorizationExtension.init()&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;try&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;
      &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; cls &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;Class&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;forName&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;AUTHORIZER_IMPL_CLASSNAME&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;$&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;true&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt; pluginClassLoader&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;
      activatePluginClassLoader&lt;span style=&#34;color: #666666&#34;&gt;()&lt;/span&gt;
      &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; instance &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; cls&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;getField&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;MODULE$&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;).&lt;/span&gt;get&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;cls&lt;span style=&#34;color: #666666&#34;&gt;).&lt;/span&gt;asInstanceOf&lt;span style=&#34;color: #666666&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #B00040&#34;&gt;SparkSession&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;Rule&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #B00040&#34;&gt;LogicalPlan&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;]]&lt;/span&gt;
      logDebug&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;&amp;lt;== AuthorizationExtension.init()&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;
      instance
    &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;catch&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;
      &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;case&lt;/span&gt; e&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;Exception&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;// check what need to be done&lt;/span&gt;
        logError&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;Error Enabling AuthorizationExtension&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt; e&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;throw&lt;/span&gt; e
      &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;
    &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;finally&lt;/span&gt; deactivatePluginClassLoader&lt;span style=&#34;color: #666666&#34;&gt;()&lt;/span&gt;
  &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;


  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; activatePluginClassLoader&lt;span style=&#34;color: #666666&#34;&gt;()&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;Unit&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;pluginClassLoader &lt;span style=&#34;color: #666666&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;null&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt; pluginClassLoader&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;activate
  &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;

  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; deactivatePluginClassLoader&lt;span style=&#34;color: #666666&#34;&gt;()&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;Unit&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;pluginClassLoader &lt;span style=&#34;color: #666666&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;null&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt; pluginClassLoader&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;deactivate
  &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;

  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;override&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; apply&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;ext&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;SparkSessionExtensions&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;Unit&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;
    ext&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;injectOptimizerRule&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;authorizerImpl&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;
  &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;

&lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id=&#34;references&#34;&gt;References&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://developer.ibm.com/code/2017/11/30/learn-extension-points-apache-spark-extend-spark-catalyst-optimizer/&#34;&gt;Learn the extension points in Apache Spark and extend the Spark Catalyst Optimizer - IBM Code&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
      
    </item>
    
    <item>
      <title>Pitfalls in Using Spark Catalog API</title>
      <link>https://blog.kk17.net/post/pitfalls-in-using-spark-catalog-api/</link>
      <pubDate>Sat, 27 Apr 2019 16:42:59 +0800</pubDate>
      
      <guid>https://blog.kk17.net/post/pitfalls-in-using-spark-catalog-api/</guid>
      
        <description>&lt;p&gt;Spark SQL supports querying data via SQL and in order to use this feature, we must enable Spark with Hive support, because Spark uses Hive Metastore to store metadata. By default, Spark uses an in-memory embedded database called Derby to store the metadata, but it can also configure to use an external Hive Metastore. Spark Hive Configuration can be found here:  &lt;a href=&#34;https://spark.apache.org/docs/latest/sql-data-sources-hive-tables.html&#34;&gt;Hive Tables - Spark 2.4.1 Documentation&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Except using DDL SQL to manipulate metadata stored in Hive Metastore, Spark SQL also provides a minimalist API know as Catalog API to manipulate metadata in spark applications. Spark Catalog API can be found here: &lt;a href=&#34;https://spark.apache.org/docs/2.2.1/api/java/org/apache/spark/sql/catalog/Catalog.html&#34;&gt;Catalog (Spark 2.2.1 JavaDoc)&lt;/a&gt; and &lt;a href=&#34;https://spark.apache.org/docs/2.3.0/api/python/_modules/pyspark/sql/catalog.html&#34;&gt;pyspark.sql.catalog  PySpark master documentation&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;After using Spark Catalog API for a period of time, I found some pitfalls.&lt;/p&gt;

&lt;h2 id=&#34;1-problem-in-creating-external-table-with-specified-schema&#34;&gt;1. Problem in creating external table with specified schema&lt;/h2&gt;

&lt;p&gt;When a user create an external table with specified schema, the schema will actually not be used and the table will fail to be recognized as a partitioned table. I dived into the Spark source code and found the reason. The source code is from Spark 2.3.2.&lt;/p&gt;

&lt;p&gt;Source Code is listed below and I omitted some code and added some notes start with &lt;code&gt;//NOTE:&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;The API where implemented by &lt;a href=&#34;https://github.com/apache/spark/blob/branch-2.3/sql/core/src/main/scala/org/apache/spark/sql/internal/CatalogImpl.scala#L338&#34;&gt;CatalogImpl.scala&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-scala&#34; data-lang=&#34;scala&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;override&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; createTable&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;  
      tableName&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;String&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt;  
      source&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;String&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt;  
      schema&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;StructType&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt;  
      options&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;Map&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #B00040&#34;&gt;String&lt;/span&gt;, &lt;span style=&#34;color: #B00040&#34;&gt;String&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;])&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;DataFrame&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;  
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; tableIdent &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; sparkSession&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;sessionState&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;sqlParser&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;parseTableIdentifier&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;tableName&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;  
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; storage &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;DataSource&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;buildStorageFormatFromOptions&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;options&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;  
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; tableType &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;storage&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;locationUri&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;isDefined&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;  
      &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;CatalogTableType&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;EXTERNAL&lt;/span&gt;  
    &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;  
      &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;CatalogTableType&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;MANAGED&lt;/span&gt;  
    &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;  
    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;//NOTE: user specified schema is set to tableDesc and use no partitionColumnNames can specify here  &lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; tableDesc &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;CatalogTable&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;  
      identifier &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; tableIdent&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt;  
      tableType &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; tableType&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt;  
      storage &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; storage&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt;  
      schema &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; schema&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt;   
      provider &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;Some&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;source&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;  
    &lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;  
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; plan &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;CreateTable&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;tableDesc&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;SaveMode&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;ErrorIfExists&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;None&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;  
    sparkSession&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;sessionState&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;executePlan&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;plan&lt;span style=&#34;color: #666666&#34;&gt;).&lt;/span&gt;toRdd  
    sparkSession&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;table&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;tableIdent&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;  
  &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The Catalog createTable API will eventually run &lt;code&gt;CreateDataSourceTableCommand&lt;/code&gt; in &lt;a href=&#34;https://github.com/apache/spark/blob/branch-2.3/sql/core/src/main/scala/org/apache/spark/sql/execution/command/createDataSourceTables.scala#L80&#34;&gt;createDataSourceTables.scala&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-scala&#34; data-lang=&#34;scala&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;CreateDataSourceTableCommand&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;table&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;CatalogTable&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt; ignoreIfExists&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;Boolean&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;  
  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;extends&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;RunnableCommand&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;

  &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;override&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; run&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;sparkSession&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;SparkSession&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;Seq&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #B00040&#34;&gt;Row&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;  
    &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;  
    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;//NOTE: the resolved dataSource include an inferred schema and partitionSchema  &lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; dataSource&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;BaseRelation&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;  
      &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;DataSource&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;  
        sparkSession &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; sparkSession&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt;  
        userSpecifiedSchema &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;table&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;schema&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;isEmpty&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;None&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;Some&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;table&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;schema&lt;span style=&#34;color: #666666&#34;&gt;),&lt;/span&gt;  
        partitionColumns &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; table&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;partitionColumnNames&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt;  
        className &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; table&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;provider&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;get&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt;  
        bucketSpec &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; table&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;bucketSpec&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt;  
        options &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; table&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;storage&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;properties &lt;span style=&#34;color: #666666&#34;&gt;++&lt;/span&gt; pathOption&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt;  
        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;// As discussed in SPARK-19583, we don&amp;#39;t check if the location is existed  &lt;/span&gt;
        catalogTable &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;Some&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;tableWithDefaultOptions&lt;span style=&#34;color: #666666&#34;&gt;)).&lt;/span&gt;resolveRelation&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;checkFilesExist &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;false&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;

    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; partitionColumnNames &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;table&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;schema&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;nonEmpty&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;  
      &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;//NOTE: if user specified schama, use the partitionColumnNames from CatalogTable passed to the class  &lt;/span&gt;
      table&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;partitionColumnNames  
    &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;  
      &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;  
    &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;

    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; newTable &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; dataSource &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;match&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;  
      &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;case&lt;/span&gt; r&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;HadoopFsRelation&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;r.overlappedPartCols.nonEmpty&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;=&amp;gt;&lt;/span&gt;  
        &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;

      &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;_&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&amp;gt;&lt;/span&gt; 

        table&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;copy&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;  
          schema &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; dataSource&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;schema&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;//NOTE: no matter whether user specify a schema, just use the infered schmea here  &lt;/span&gt;
          partitionColumnNames &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; partitionColumnNames&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt;  
          &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;  
          &lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;  
    &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;  
    &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;  
    sessionState&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;catalog&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;createTable&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;newTable&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt; ignoreIfExists &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;false&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;

    &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;Seq&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;empty&lt;span style=&#34;color: #666666&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #B00040&#34;&gt;Row&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;]&lt;/span&gt;  
  &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;  
&lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&#34;solution&#34;&gt;Solution&lt;/h4&gt;

&lt;p&gt;Don&amp;rsquo;t know the reason why the source code is written in that way and whether this should be considered as a bug. One solution we come up with for this problem is to implement a custom crateTable API.&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://gist.github.com/kk17/60f956379398b0792059498543566e2a#file-catalogutil-scala&#34;&gt;CatalogUtil.scala&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-scala&#34; data-lang=&#34;scala&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;object&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;CatalogUtil&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;

    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;lazy&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; sparkSession &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;SparkSession&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;getActiveSession&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;get  
    &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;  
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; createTable&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;  
                       tableName&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;String&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt;  
                       source&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;String&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt;  
                       path&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;String&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt;  
                       schema&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;StructType&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt;  
                       options&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;Map&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #B00040&#34;&gt;String&lt;/span&gt;, &lt;span style=&#34;color: #B00040&#34;&gt;String&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;],&lt;/span&gt;  
                       partitionColumnsInSchema&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;Boolean&lt;/span&gt;  
                   &lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;Unit&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;  
        &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;

        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; table &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;CatalogTable&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;  
            identifier &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; tableIdent&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt;  
            tableType &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; tableType&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt;  
            storage &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; storage&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt;  
            schema &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; schema&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt;  
            provider &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;Some&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;newSource&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;  
        &lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;  
        &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;  
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; dataSource&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;BaseRelation&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;  
            &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;DataSource&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;  
                sparkSession &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; sparkSession&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt;  
                userSpecifiedSchema &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;table&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;schema&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;isEmpty&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;None&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;Some&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;table&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;schema&lt;span style=&#34;color: #666666&#34;&gt;),&lt;/span&gt;  
                partitionColumns &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; table&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;partitionColumnNames&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt;  
                className &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; table&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;provider&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;get&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt;  
                &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;  
                &lt;span style=&#34;color: #666666&#34;&gt;)).&lt;/span&gt;resolveRelation&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;checkFilesExist &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;false&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;

        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;//NOTE: alway use infered partitionColumnNames here, cause we don&amp;#39;t allow use specify partitionColumnNames  &lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; partitionColumns&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;Array&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #B00040&#34;&gt;StructField&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;  
            assert&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;table&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;partitionColumnNames&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;isEmpty&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;  
            dataSource &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;match&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;  
                &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;case&lt;/span&gt; r&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;HadoopFsRelation&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;=&amp;gt;&lt;/span&gt; r&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;partitionSchema&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;fields  
                &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;_&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;Array&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;empty  
            &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;  
        &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;

        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; partitionColumnNames &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; partitionColumns&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;map&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;_&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;name&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;

        &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;//NOTE: merge partitionColumns into table schema if necessary  &lt;/span&gt;
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; newSchema&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #B00040&#34;&gt;StructType&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;table&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;schema&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;nonEmpty&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;  
            &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;partitionColumnsInSchema&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;  
                table&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;schema  
            &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;  
                table&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;schema&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;fields&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;map&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;_&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;name&lt;span style=&#34;color: #666666&#34;&gt;).&lt;/span&gt;intersect&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;partitionColumnNames&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;match&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;  
                    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;Array&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;StructType&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;table&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;schema&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;fields &lt;span style=&#34;color: #666666&#34;&gt;++&lt;/span&gt; partitionColumns&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;  
                    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;case&lt;/span&gt; arr &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;  
                        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; message &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;Partition column names: &amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;+&lt;/span&gt;  
                            &lt;span style=&#34;color: #BA2121&#34;&gt;s&amp;quot;[&lt;/span&gt;&lt;span style=&#34;color: #BB6688; font-weight: bold&#34;&gt;${&lt;/span&gt;arr&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;mkString&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;,&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color: #BB6688; font-weight: bold&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;] cannot exist in user specified schema.\n&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;+&lt;/span&gt;  
                            &lt;span style=&#34;color: #BA2121&#34;&gt;s&amp;quot; Inferred partition columns: [&lt;/span&gt;&lt;span style=&#34;color: #BB6688; font-weight: bold&#34;&gt;${&lt;/span&gt;partitionColumnNames&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;mkString&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;,&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color: #BB6688; font-weight: bold&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;].\n&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;+&lt;/span&gt;  
                            &lt;span style=&#34;color: #BA2121&#34;&gt;s&amp;quot; User specified schema:\n&lt;/span&gt;&lt;span style=&#34;color: #BB6688; font-weight: bold&#34;&gt;${&lt;/span&gt;table&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;schema&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;treeString&lt;span style=&#34;color: #BB6688; font-weight: bold&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;&lt;/span&gt;

                        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;ConflictedSchemaException&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;message&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;  
                    &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;  
                &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;  
            &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;  
        &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;  
            dataSource&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;schema  
        &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;

        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;val&lt;/span&gt; newTable &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt;  
            table&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;copy&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;  
                schema &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; newSchema&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;//NOTE: use specifed schema  &lt;/span&gt;
                partitionColumnNames &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; partitionColumnNames&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt;  
                &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;

  
        sessionState&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;catalog&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;createTable&lt;span style=&#34;color: #666666&#34;&gt;(&lt;/span&gt;newTable&lt;span style=&#34;color: #666666&#34;&gt;,&lt;/span&gt; ignoreIfExists &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;false&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;  
    &lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;

&lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;As you see our custom API is written in Scala, if we want to use in a python application, we must use Python Java Gateway. You can find more detail here:&lt;a href=&#34;https://diogoalexandrefranco.github.io/scala-code-in-pyspark/&#34;&gt;Using Scala code in PySpark applications&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;2-partitioned-table-data-only-avaliable-after-invoked-recoverpartitions&#34;&gt;2. Partitioned table data only avaliable after invoked &lt;code&gt;recoverPartitions&lt;/code&gt;&lt;/h2&gt;

&lt;p&gt;If you created an external partitioned table and immediately read data from the table, you will find the data is empty. Data only available after invoked &lt;code&gt;recoverPartitions&lt;/code&gt; method. This is different from a non-partitioned table and Spark Catalog doesn&amp;rsquo;t have a convenient method for testing whether the table is partitioned.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color: #0000FF; font-weight: bold&#34;&gt;SparkCatalog&lt;/span&gt;(Catalog):  
    &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;  
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;is_partitioned_table&lt;/span&gt;(&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;, table_name):  
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;PARTITIONED BY&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;get_create_table_statement(table_name)

    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;get_create_table_statement&lt;/span&gt;(&lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;, table_name):  
        &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;_sparkSession&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;sql(f&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;show create table `{table_name}`&amp;quot;&lt;/span&gt;)&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;collect()[&lt;span style=&#34;color: #666666&#34;&gt;0&lt;/span&gt;][&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;createtab_stmt&amp;quot;&lt;/span&gt;]

    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;create_or_refresh_table&lt;/span&gt;(&lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;):  
    &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;  
                &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;is_partitioned_table(table):  
                    &lt;span style=&#34;color: #008000&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;recoverPartitions(table)  
    &lt;span style=&#34;color: #666666&#34;&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id=&#34;3-refreshtable-api-only-refresh-the-cache-in-sparkcontext&#34;&gt;3. &lt;code&gt;refreshTable&lt;/code&gt; API only refresh the cache in SparkContext&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;catalog.refreshTable&lt;/code&gt; only refresh the cached data and metadata of the given table in sparkContext, if we want to update the table&amp;rsquo;s meta(schema, transient_lastDdlTime and etc) in the hive metastore, we need to drop and recreate the table.&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>Use Spark Sql With Hive Metastore</title>
      <link>https://blog.kk17.net/post/use-spark-sql-with-hive-metastore/</link>
      <pubDate>Wed, 27 Feb 2019 15:52:48 +0800</pubDate>
      
      <guid>https://blog.kk17.net/post/use-spark-sql-with-hive-metastore/</guid>
      
        <description>

&lt;h1 id=&#34;spark-sql&#34;&gt;Spark SQL&lt;/h1&gt;

&lt;p&gt;Spark SQL is a module for working with structured data&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span&gt;&lt;/span&gt;spark &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; SparkSession&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;builder&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;config(conf&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;conf)&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;enableHiveSupport()&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;getOrCreate()
spark&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;sql(&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;use database_name&amp;quot;&lt;/span&gt;)
spark&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;sql(&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;select * from table_name where id in (3085,3086,3087) and dt &amp;gt; &amp;#39;2019-03-10&amp;#39;&amp;quot;&lt;/span&gt;)&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;toPandas()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id=&#34;hive&#34;&gt;Hive&lt;/h2&gt;

&lt;p&gt;Data warehouse software for reading, writing, and managing large datasets residing in distributed storage and queried using SQL syntax.&lt;/p&gt;

&lt;p&gt;Hive transforms SQL queries as Hive MapReduce job.&lt;/p&gt;

&lt;p&gt;Besides MapReduce, Hive can use Spark and Tez as execute engine.&lt;/p&gt;

&lt;h2 id=&#34;spark-and-hive&#34;&gt;Spark and Hive&lt;/h2&gt;

&lt;p&gt;In Spark 1.0, Spark use many Hive codes in Spark SQL. It ran Hadoop style Map/Reduce jobs on top of the Spark engine&lt;/p&gt;

&lt;p&gt;There is almost no Hive left in Spark 2.0. While the Sql Thrift Server is still built on the HiveServer2 code, almost all of the internals are now completely Spark-native, for example Spark it build a brand new Spark-native optimization engine knows as Catalyst.&lt;/p&gt;

&lt;h2 id=&#34;hiveserver2&#34;&gt;HiveServer2&lt;/h2&gt;

&lt;p&gt;A server interface that enables remote clients to execute queries against Hive and retrieve the results.&lt;/p&gt;

&lt;p&gt;With HiveServer2, we can use JDBC and ODBC connecters to connect to Hive.&lt;/p&gt;

&lt;h2 id=&#34;spark-thrift-server&#34;&gt;Spark Thrift Server&lt;/h2&gt;

&lt;p&gt;Spark Thrift Server is variant of HiveServer2.&lt;/p&gt;

&lt;p&gt;Thrift is the RPC framework use for client and Server communication.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://user-images.githubusercontent.com/22542670/27733176-54b684c2-5db2-11e7-946b-5b5ef5595e43.png&#34; alt=&#34;https://user-images.githubusercontent.com/22542670/27733176-54b684c2-5db2-11e7-946b-5b5ef5595e43.png&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Spark Thrift Server have a bug in showing db schemes and tables. We cherry-picked the patch codes into Spark 2.3.2 the version we now used and used a shaded jar in deploying Spark Thrift Server.&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://issues.apache.org/jira/browse/SPARK-24196&#34;&gt;[SPARK-24196] Spark Thrift Server - SQL Client connections does&amp;rsquo;t show db artefacts - ASF JIRA&lt;/a&gt;&lt;/p&gt;

&lt;h4 id=&#34;inception-or-multiple-sessions&#34;&gt;Inception or Multiple Sessions&lt;/h4&gt;

&lt;p&gt;From Spark 1.6, by default, the Thrift server runs in multi-session mode&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;spark.sql.hive.thriftServer.singleSession=false
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;mysterious-ooms-and-how-to-avoid-them-or-incremental-collect&#34;&gt;Mysterious OOMs and How to Avoid Them or Incremental Collect&lt;/h4&gt;

&lt;pre&gt;&lt;code&gt;spark.sql.thriftServer.incrementalCollect=false
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The setting IncrementalCollect changes the gather method from collect to toLocalIterator.&lt;/p&gt;

&lt;h2 id=&#34;metastore&#34;&gt;Metastore&lt;/h2&gt;

&lt;p&gt;Central repository of Hive metadata.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://docs.hortonworks.com/HDPDocuments/HDP2/HDP-2.6.5/bk_spark-component-guide/content/figures/4/figures/sts-architecture.png&#34; alt=&#34;https://docs.hortonworks.com/HDPDocuments/HDP2/HDP-2.6.5/bk_spark-component-guide/content/figures/4/figures/sts-architecture.png&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Metastore need a warehouse location for storage for internal tables data. Although we only use external tables, the warehouse location is still needed because every database in Metastore needs a corresponding folder in the warehouse. Spark references &lt;code&gt;spark.sql.warehouse.dir&lt;/code&gt; as the default Spark SQL Hive Warehouse location. In EMR cluster this property is config to cluster HDFS location by default. If the cluster goes down the HDFS will become unavailable and this may cause some problem in using Spark SQL to query table data. Therefore we the location to the local file system. In other words, config &lt;code&gt;spark.sql.warehouse.dir&lt;/code&gt; to &lt;code&gt;file:///usr/lib/spark/warehouse&lt;/code&gt; in &lt;code&gt;spark-defaults.conf&lt;/code&gt;.&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;references&#34;&gt;References&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://www.russellspitzer.com/2017/05/19/Spark-Sql-Thriftserver/&#34;&gt;Russell Spitzer&amp;rsquo;s Blog: Spark Thrift Server Basics and a History&lt;/a&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>linux</title>
      <link>https://blog.kk17.net/post/linux-commands/</link>
      <pubDate>Wed, 19 Aug 2015 09:00:00 +0800</pubDate>
      
      <guid>https://blog.kk17.net/post/linux-commands/</guid>
      
        <description>

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;p&gt;&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;CTRL + A  &lt;/li&gt;
&lt;li&gt;CTRL + E  &lt;/li&gt;
&lt;li&gt;CTRL + U  &lt;/li&gt;
&lt;li&gt;CTRL + K  &lt;/li&gt;
&lt;li&gt;ALT+  - &lt;/li&gt;
&lt;li&gt;ALT +  - &lt;/li&gt;
&lt;li&gt;CTRL +  - mac&lt;/li&gt;
&lt;li&gt;CTRL +  - (mac)&lt;/li&gt;
&lt;li&gt;CTRL + R - &lt;/li&gt;
&lt;li&gt;sudo !! root&lt;/li&gt;
&lt;li&gt;!command &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;p&gt;
&lt;code&gt;lsof -i:8087&lt;/code&gt;
&lt;code&gt;netstat apn | grep 8080&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;ip:
&lt;code&gt;ifconfig&lt;/code&gt;
&lt;code&gt;ip a&lt;/code&gt;&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h2 id=&#34;cpu&#34;&gt;CPU&lt;/h2&gt;

&lt;p&gt;CPU
 &lt;code&gt;cat /proc/cpuinfo |grep -c processor&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;top&lt;/code&gt;Shift+P(mac &lt;code&gt;top -u&lt;/code&gt; &lt;code&gt;top -o cpu&lt;/code&gt;)&lt;/p&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;p&gt;free
&lt;code&gt;free -m&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;top&lt;/code&gt; Shift+M, (mac &lt;code&gt;top -o mem&lt;/code&gt;)&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;ps -e  -o &amp;quot;%C  : %p : %z : %a&amp;quot;|sort -k5 -nr&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;p&gt;
&lt;code&gt;df -h&lt;/code&gt;
iostat/dev/sdc3i/o
&lt;code&gt;iostat -d -x /dev/sdc3 2&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;du -h&lt;/code&gt;
&lt;code&gt;du -h -d 1 .&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;p&gt;
1) &lt;code&gt;find /dir -name filename.ext&lt;/code&gt;
2) &lt;code&gt;du -a | grep filename.ext&lt;/code&gt;
3) &lt;code&gt;locate filename.ext&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;p&gt;debian&amp;amp;ubuntu
apt-getdpkg&lt;code&gt;dpkg -l&lt;/code&gt; 
&lt;code&gt;dpkg -l | grep &#39;^ii&#39;&lt;/code&gt;
Server &lt;code&gt;aptitude&lt;/code&gt;deb
&lt;code&gt;sudo apt-get install aptitude&lt;/code&gt;
 sudo aptitude  &lt;/p&gt;

&lt;h2 id=&#34;linux&#34;&gt;linux&lt;/h2&gt;

&lt;p&gt;copy 1.sh192.168.9.10/data/
&lt;code&gt;scp /etc/1.sh king@192.168.9.10:/data/&lt;/code&gt;
copy192.168.9.10/data/2.sh/data/
&lt;code&gt;scp king@192.168.9.10:/data/2.sh /data/&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;date -d @1267619929&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&#34;&#34;&gt;&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://linuxtools-rst.readthedocs.org/zh_CN/latest/index.html&#34;&gt;Linux  Linux Tools Quick Tutorial&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.jobbole.com/83610/&#34;&gt;10Linux ps&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.jobbole.com/83844/&#34;&gt;Awk 20 &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.jobbole.com/86948/&#34;&gt;11 Linux  -  - &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.jobbole.com/86809/&#34;&gt; Vim  Shell  9  -  - &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.jobbole.com/41129/&#34;&gt; Linux  -  - &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://coolshell.cn/articles/8619.html&#34;&gt;Shell |   - CoolShell.cn&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.xprogrammer.com/1799.html&#34;&gt;Linuxshell  &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://billie66.github.io/TLCL/index.html&#34;&gt;TLCL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.jobbole.com/89609/&#34;&gt; -  - &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
      
    </item>
    
    <item>
      <title>Shell</title>
      <link>https://blog.kk17.net/post/learning-shell/</link>
      <pubDate>Tue, 18 Aug 2015 09:00:00 +0800</pubDate>
      
      <guid>https://blog.kk17.net/post/learning-shell/</guid>
      
        <description>

&lt;h2 id=&#34;shebang&#34;&gt;shebang&lt;/h2&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;#!/usr/bin/env bash&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;shell,bash shellshell&lt;/p&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #19177C&#34;&gt;X&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;hello&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ol&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #19177C&#34;&gt;$X&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ol&gt;
&lt;li&gt; VS 
&lt;strong&gt;&lt;/strong&gt; An example &lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;#!/usr/bin/env bash&lt;/span&gt;
&lt;span style=&#34;color: #008000&#34;&gt;echo&lt;/span&gt; -n &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;#39;$USER=&amp;#39;&lt;/span&gt; 
&lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# -necho&lt;/span&gt;
&lt;span style=&#34;color: #008000&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #19177C&#34;&gt;$USER&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;&lt;/span&gt;
&lt;span style=&#34;color: #008000&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;\$USER=&lt;/span&gt;&lt;span style=&#34;color: #19177C&#34;&gt;$USER&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;&lt;/span&gt;  
&lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;!-- more --&gt;

&lt;h3 id=&#34;&#34;&gt;&lt;/h3&gt;

&lt;ol&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# !/bin/bash&lt;/span&gt;
&lt;span style=&#34;color: #19177C&#34;&gt;X&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;[&lt;/span&gt; -n &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #19177C&#34;&gt;$X&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;]&lt;/span&gt;; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;then&lt;/span&gt;    
&lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# -n &lt;/span&gt;
         &lt;span style=&#34;color: #008000&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;the variable X is not the empty string&amp;quot;&lt;/span&gt;
&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;fi&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ol&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# !/bin/bash&lt;/span&gt;
&lt;span style=&#34;color: #19177C&#34;&gt;X&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;ABC
&lt;span style=&#34;color: #008000&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #BB6688; font-weight: bold&#34;&gt;${&lt;/span&gt;&lt;span style=&#34;color: #19177C&#34;&gt;X&lt;/span&gt;&lt;span style=&#34;color: #BB6688; font-weight: bold&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;abc&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id=&#34;-if-then-elif-then-fi&#34;&gt; if/then/elif/then/fi&lt;/h2&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;[[&lt;/span&gt; condition1 &lt;span style=&#34;color: #666666&#34;&gt;]]&lt;/span&gt;; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;then&lt;/span&gt;
    statement1
    statement2
    ..........
&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;elif&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;[[&lt;/span&gt; condition2 &lt;span style=&#34;color: #666666&#34;&gt;]]&lt;/span&gt;; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;then&lt;/span&gt;
    statement3
    statement4
    ........    
&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;else&lt;/span&gt;
    statement5
    statement6
    ........    
&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;fi&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id=&#34;test&#34;&gt;Test&lt;/h2&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;[[&lt;/span&gt; operand1 operator operand2 &lt;span style=&#34;color: #666666&#34;&gt;]]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Test&amp;lt;  &amp;gt;&amp;lt;  &amp;gt;&amp;lt;  &amp;gt;shell-&lt;/p&gt;

&lt;h3 id=&#34;&#34;&gt;&lt;/h3&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;-n&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;-z&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;-d&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;-f&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;=&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;!=&lt;/td&gt;
&lt;td&gt;=&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;-eq&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;-neq&lt;/td&gt;
&lt;td&gt;-eq&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;-lt&lt;/td&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;-le&lt;/td&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;-gt&lt;/td&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;-ge&lt;/td&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;h2 id=&#34;for-&#34;&gt;For &lt;/h2&gt;

&lt;p&gt;For&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# !/bin/bash&lt;/span&gt;
&lt;span style=&#34;color: #19177C&#34;&gt;colour1&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;red&amp;quot;&lt;/span&gt;
&lt;span style=&#34;color: #19177C&#34;&gt;colour2&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;light blue&amp;quot;&lt;/span&gt;
&lt;span style=&#34;color: #19177C&#34;&gt;colour3&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;dark green&amp;quot;&lt;/span&gt;
&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;for&lt;/span&gt; X in &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #19177C&#34;&gt;$colour1&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #19177C&#34;&gt;$colour2&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot; &lt;/span&gt;&lt;span style=&#34;color: #19177C&#34;&gt;$colour3&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;&lt;/span&gt;
&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;do&lt;/span&gt;
    &lt;span style=&#34;color: #008000&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color: #19177C&#34;&gt;$X&lt;/span&gt;
&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;done&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;for&lt;/strong&gt;shell*&lt;/p&gt;

&lt;h2 id=&#34;while-&#34;&gt;While &lt;/h2&gt;

&lt;p&gt;while&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# !/bin/bash&lt;/span&gt;
&lt;span style=&#34;color: #19177C&#34;&gt;X&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;=0&lt;/span&gt;
&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;while&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;[[&lt;/span&gt; &lt;span style=&#34;color: #19177C&#34;&gt;$X&lt;/span&gt; -le &lt;span style=&#34;color: #666666&#34;&gt;20&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;]&lt;/span&gt;; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;do&lt;/span&gt;
    &lt;span style=&#34;color: #008000&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color: #19177C&#34;&gt;$X&lt;/span&gt;
    &lt;span style=&#34;color: #19177C&#34;&gt;X&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;$((&lt;/span&gt;X+1&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;))&lt;/span&gt;
&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;done&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id=&#34;case&#34;&gt;case&lt;/h2&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color: #19177C&#34;&gt;$key&lt;/span&gt; in
    a|b&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;
    statement1
    ;;
    c&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;
    statement2
    *&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;
    &lt;span style=&#34;color: #008000&#34;&gt;break&lt;/span&gt;
    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# unknown option&lt;/span&gt;
    ;;
&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;esac&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;p&gt; $(commands) commandscommands
commandscommands&lt;/p&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;$n&lt;/code&gt; n0n&lt;code&gt;$0&lt;/code&gt;
&lt;code&gt;$#&lt;/code&gt; 
&lt;code&gt;shift&lt;/code&gt;&lt;code&gt;shift 3&lt;/code&gt;&lt;code&gt;$4&lt;/code&gt;&lt;code&gt;$1&lt;/code&gt;&lt;code&gt;$5&lt;/code&gt;&lt;code&gt;$2&lt;/code&gt;&lt;code&gt;$1&lt;/code&gt;. &lt;code&gt;$2&lt;/code&gt;. &lt;code&gt;$3&lt;/code&gt;&lt;code&gt;$0&lt;/code&gt;&lt;code&gt;shift&lt;/code&gt;&lt;code&gt;shift 1&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;while&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;[[&lt;/span&gt; &lt;span style=&#34;color: #19177C&#34;&gt;$#&lt;/span&gt; &amp;gt; &lt;span style=&#34;color: #666666&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;]]&lt;/span&gt;
&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;do&lt;/span&gt;
&lt;span style=&#34;color: #19177C&#34;&gt;key&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #19177C&#34;&gt;$1&lt;/span&gt;&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;&lt;/span&gt;

&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color: #19177C&#34;&gt;$key&lt;/span&gt; in
    -a&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;
    statement1
    &lt;span style=&#34;color: #008000&#34;&gt;shift&lt;/span&gt;
    ;;
    -b&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;
    statement2
    &lt;span style=&#34;color: #008000&#34;&gt;shift&lt;/span&gt;
    ;;
    *&lt;span style=&#34;color: #666666&#34;&gt;)&lt;/span&gt;
    &lt;span style=&#34;color: #008000&#34;&gt;break&lt;/span&gt;
    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;# unknown option&lt;/span&gt;
    ;;
&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;esac&lt;/span&gt;
&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;done&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;p&gt;shell shell&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;[&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;function&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;]&lt;/span&gt; funname &lt;span style=&#34;color: #666666&#34;&gt;[()]&lt;/span&gt;
&lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;
    action;
    &lt;span style=&#34;color: #666666&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;return&lt;/span&gt; int;&lt;span style=&#34;color: #666666&#34;&gt;]&lt;/span&gt;
&lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;

sum&lt;span style=&#34;color: #666666&#34;&gt;()&lt;/span&gt;
&lt;span style=&#34;color: #666666&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #008000&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color: #19177C&#34;&gt;$1&lt;/span&gt;,&lt;span style=&#34;color: #19177C&#34;&gt;$2&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;$((&lt;/span&gt;&lt;span style=&#34;color: #19177C&#34;&gt;$1&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #19177C&#34;&gt;$2&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;))&lt;/span&gt;
&lt;span style=&#34;color: #666666&#34;&gt;}&lt;/span&gt;
sum &lt;span style=&#34;color: #666666&#34;&gt;5&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;7&lt;/span&gt;
&lt;span style=&#34;color: #008000&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color: #19177C&#34;&gt;$?&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ol&gt;
&lt;li&gt;shellshell&lt;/li&gt;
&lt;li&gt;$?&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;local =  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.jobbole.com/85183/&#34;&gt;Bash -  - &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.cnblogs.com/chengmo/archive/2010/10/17/1853356.html&#34;&gt;linux shell (. . -  -  - &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://my.oschina.net/itblog/blog/204410&#34;&gt;Shell - Integer - &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.oschina.net/translate/python-scripts-replacement-bash-utility-scripts&#34;&gt; Python  Bash  -  - &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
      
    </item>
    
    <item>
      <title>Tmux</title>
      <link>https://blog.kk17.net/post/tmux-shortcut/</link>
      <pubDate>Mon, 17 Aug 2015 09:00:00 +0800</pubDate>
      
      <guid>https://blog.kk17.net/post/tmux-shortcut/</guid>
      
        <description>

&lt;h3 id=&#34;tmux&#34;&gt;tmux&lt;/h3&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;C-b c&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;C-b &amp;amp;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;C-b ,&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;C-b $&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;C-b p&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;C-b n&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;C-b w&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;detach&lt;/td&gt;
&lt;td&gt;C-b d&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;C-b ?&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;C-b %&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;C-b &amp;ldquo;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;C-b o&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;C-b s&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;C-b &lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;C-b x&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;C-b space&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;C-b Esc 1-5&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;C-b Num&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;C-b :&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;C-b : setw synchronize-panes&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;!-- more --&gt;

&lt;h3 id=&#34;tmux&#34;&gt;tmux&lt;/h3&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;tmux new-session -s work -n tomcat&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;(attach)&lt;/td&gt;
&lt;td&gt;tmux new-session -s work -n tomcat -d&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;()&lt;/td&gt;
&lt;td&gt;tmux new-session -t work -n tomcat -d ssh user@host&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;attach&lt;/td&gt;
&lt;td&gt;tmux a -t work&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;tmux ls&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;tmux kill-session -t work&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;tmux send-keys -t work:editor &amp;ldquo;emacs&amp;rdquo; C-m&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&#34;&#34;&gt;&lt;/h3&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;action&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;bind-key        C-o&lt;/td&gt;
&lt;td&gt;rotate-window&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key        C-z&lt;/td&gt;
&lt;td&gt;suspend-client&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key      Space&lt;/td&gt;
&lt;td&gt;next-layout&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          !&lt;/td&gt;
&lt;td&gt;break-pane&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          &amp;ldquo;&lt;/td&gt;
&lt;td&gt;split-window&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          #&lt;/td&gt;
&lt;td&gt;list-buffers&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          $&lt;/td&gt;
&lt;td&gt;rename-session&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          %&lt;/td&gt;
&lt;td&gt;split-window&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          &amp;amp;&lt;/td&gt;
&lt;td&gt;kill-window&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          &amp;lsquo;&lt;/td&gt;
&lt;td&gt;select-window&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          (&lt;/td&gt;
&lt;td&gt;switch-client -p&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          )&lt;/td&gt;
&lt;td&gt;switch-client -n&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          ,&lt;/td&gt;
&lt;td&gt;rename-window&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          -&lt;/td&gt;
&lt;td&gt;delete-buffer&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          .&lt;/td&gt;
&lt;td&gt;cmove-window&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          0&lt;/td&gt;
&lt;td&gt;select-window -t :0&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          1&lt;/td&gt;
&lt;td&gt;select-window -t :1&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          2&lt;/td&gt;
&lt;td&gt;select-window -t :2&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          3&lt;/td&gt;
&lt;td&gt;select-window -t :3&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          4&lt;/td&gt;
&lt;td&gt;select-window -t :4&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          5&lt;/td&gt;
&lt;td&gt;select-window -t :5&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          6&lt;/td&gt;
&lt;td&gt;select-window -t :6&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          7&lt;/td&gt;
&lt;td&gt;select-window -t :7&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          8&lt;/td&gt;
&lt;td&gt;select-window -t :8&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          9&lt;/td&gt;
&lt;td&gt;select-window -t :9&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          :&lt;/td&gt;
&lt;td&gt;command-prompt&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          ;&lt;/td&gt;
&lt;td&gt;last-pane&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          =&lt;/td&gt;
&lt;td&gt;choose-buffer&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          ?&lt;/td&gt;
&lt;td&gt;list-keys&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          D&lt;/td&gt;
&lt;td&gt;choose-client&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          L&lt;/td&gt;
&lt;td&gt;switch-client -l&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          [&lt;/td&gt;
&lt;td&gt;copy-mode&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          ]&lt;/td&gt;
&lt;td&gt;paste-buffer&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          c&lt;/td&gt;
&lt;td&gt;new-window&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          d&lt;/td&gt;
&lt;td&gt;detach-client&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          f&lt;/td&gt;
&lt;td&gt;find-window&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          i&lt;/td&gt;
&lt;td&gt;display-message&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          l&lt;/td&gt;
&lt;td&gt;last-window&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          n&lt;/td&gt;
&lt;td&gt;next-window&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          o&lt;/td&gt;
&lt;td&gt;select-pane -t :.+&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          p&lt;/td&gt;
&lt;td&gt;previous-window&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          q&lt;/td&gt;
&lt;td&gt;display-panes&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          r&lt;/td&gt;
&lt;td&gt;refresh-client&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          s&lt;/td&gt;
&lt;td&gt;choose-session&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          t&lt;/td&gt;
&lt;td&gt;clock-mode&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          w&lt;/td&gt;
&lt;td&gt;choose-window&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          x&lt;/td&gt;
&lt;td&gt;kill-pane&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          {&lt;/td&gt;
&lt;td&gt;swap-pane -U&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          }&lt;/td&gt;
&lt;td&gt;swap-pane -D&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key          ~&lt;/td&gt;
&lt;td&gt;show-messages&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key      PPage&lt;/td&gt;
&lt;td&gt;copy-mode -u&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key -r      Up&lt;/td&gt;
&lt;td&gt;select-pane -U&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key -r    Down&lt;/td&gt;
&lt;td&gt;select-pane -D&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key -r    Left&lt;/td&gt;
&lt;td&gt;select-pane -L&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key -r   Right&lt;/td&gt;
&lt;td&gt;select-pane -R&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;bind-key        M-1&lt;/td&gt;
&lt;td&gt;select-layout even-horizontal&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&#34;&#34;&gt;&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://abyssly.com/2013/11/04/tmux_intro/&#34;&gt;tmux | Abyssly&amp;rsquo;s Blog&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://wiki.freebsdchina.org/software/t/tmux&#34;&gt;tmux [FreeBSDChina Wiki]&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://superuser.com/questions/755634/how-to-quickly-switch-to-n-10-windows-in-tmux&#34;&gt;keyboard shortcuts - How to quickly switch to n.10+ windows in tmux - Super User&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
      
    </item>
    
    <item>
      <title>Prolog</title>
      <link>https://blog.kk17.net/post/seven-days-seven-languages-prelog/</link>
      <pubDate>Fri, 08 May 2015 10:00:00 +0800</pubDate>
      
      <guid>https://blog.kk17.net/post/seven-days-seven-languages-prelog/</guid>
      
        <description>

&lt;h2 id=&#34;prolog&#34;&gt;Prolog&lt;/h2&gt;

&lt;p&gt;Prolog1972Alain ColmerauerPhillipe Roussel
Prolog
&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Babe&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;Babe&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;knowledge baseProlog
&lt;br /&gt;
PrologatomRubysymbol&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;likes(wallace,cheese). //
likes(grommit,cheese).
likes(wendolene,sheep).

friend(X,Y) :- \+(X = Y), likes(X, Z), likes(Y, Z). //\+\+(X=Y)XY

| - friend(grommit wallace). //
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Prolog
&lt;!-- more --&gt;&lt;/p&gt;

&lt;h3 id=&#34;&#34;&gt;&lt;/h3&gt;

&lt;p&gt;&lt;/p&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;%--
book(&#39;Zen and the Art of Motorcycle Maintenance&#39;).
book(&#39;Seven Languages in Seven Weeks&#39;).
book(&#39;Introduction to Algorithms&#39;).
book(&#39;Design Patterns&#39;).
book(&#39;Effective Java&#39;).

%--
author(&#39;Bruce A.Tate&#39;).
author(&#39;Erich Gamma&#39;).
author(&#39;Richard Helm&#39;).
author(&#39;Ralph Johnson&#39;).
author(&#39;John Vlissides&#39;).
author(&#39;Thomas H.Cormen&#39;).
author(&#39;Charles E.Leiserson&#39;).
author(&#39;Ronald L.Rivest&#39;).
author(&#39; Clifford Stein&#39;).
author(&#39;Joshua Bloch&#39;).
author(&#39;Robert M. Pirsig&#39;).

book_author(&#39;Zen and the Art of Motorcycle Maintenance&#39;,&#39;Robert M. Pirsig&#39;).
book_author(&#39;Seven Languages in Seven Weeks&#39;,&#39;Bruce A.Tate&#39;).
book_author(&#39;Introduction to Algorithms&#39;,&#39;Thomas H.Cormen&#39;).
book_author(&#39;Introduction to Algorithms&#39;,&#39;Charles E.Leiserson&#39;).
book_author(&#39;Introduction to Algorithms&#39;,&#39;Ronald L.Rivest&#39;).
book_author(&#39;Introduction to Algorithms&#39;,&#39; Clifford Stein&#39;).
book_author(&#39;Effective Java&#39;,&#39;Joshua Bloch&#39;).
book_author(&#39;Design Patterns&#39;,&#39;Erich Gamma&#39;).
book_author(&#39;Design Patterns&#39;,&#39;Richard Helm&#39;).
book_author(&#39;Design Patterns&#39;,&#39;Ralph Johnson&#39;).
book_author(&#39;Design Patterns&#39;,&#39;John Vlissides&#39;).

%--
coauthor( FirstAuthor, SecondAuthor ) :-
(FirstAuthor \= SecondAuthor),
author( FirstAuthor ),
author( SecondAuthor ),
book_author( SomeBook ,FirstAuthor),
book_author( SomeBook, SecondAuthor).

%--
notCoauthor( FirstAuthor, SecondAuthor ) :-
(FirstAuthor \= SecondAuthor),
\+coauthor( FirstAuthor, SecondAuthor ).
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;GNU Prolog 1.4.4 (64 bits)
Compiled Apr 23 2013, 16:05:07 with cl
By Daniel Diaz
Copyright (C) 1999-2013 Daniel Diaz
| ?- consult(&#39;D:/PrologCodes/books.pl&#39;).
compiling D:/PrologCodes/books.pl for byte code...
D:/PrologCodes/books.pl compiled, 45 lines read - 4452 bytes written, 8 ms

yes
| ?- book(Whatbook).

Whatbook = &#39;Zen and the Art of Motorcycle Maintenance&#39; ? ;

Whatbook = &#39;Seven Languages in Seven Weeks&#39; ? ;

Whatbook = &#39;Introduction to Algorithms&#39; ? ;

Whatbook = &#39;Design Patterns&#39; ? ;

Whatbook = &#39;Effective Java&#39;

(16 ms) yes
| ?- author(Author).

Author = &#39;Bruce A.Tate&#39; ? ;

Author = &#39;Erich Gamma&#39; ? ;

Author = &#39;Richard Helm&#39; ? ;

Author = &#39;Ralph Johnson&#39; ? ;

Author = &#39;John Vlissides&#39; ? ;

Author = &#39;Thomas H.Cormen&#39; ? ;

Author = &#39;Charles E.Leiserson&#39; ? ;

Author = &#39;Ronald L.Rivest&#39; ? ;

Author = &#39; Clifford Stein&#39; ? ;

Author = &#39;Joshua Bloch&#39; ? ;

Author = &#39;Robert M. Pirsig&#39;

| ?- book_author(&#39;Design Patterns&#39;,Author).

Author = &#39;Erich Gamma&#39; ? ;

Author = &#39;Richard Helm&#39; ? ;

Author = &#39;Ralph Johnson&#39; ? ;

Author = &#39;John Vlissides&#39;

yes

| ?- coauthor(&#39;Erich Gamma&#39;,&#39;Richard Helm&#39;).

true ? ;

no

| ?- notCoauthor(&#39;Erich Gamma&#39;,&#39;Richard Helm&#39;).

no
| ?- coauthor(&#39;Bruce A.Tate&#39;,&#39;Erich Gamma&#39;).

no
| ?- coauthor(&#39;Bruce A.Ta1te&#39;,&#39;Erich Gamma&#39;).

no
| ?- notCoauthor(&#39;Erich Gamma&#39;,&#39;Richard Helm&#39;).

no
| ?- book_author(SomeBook,&#39;Erich Gamma&#39;).

SomeBook = &#39;Design Patterns&#39; ? ;

no
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;fib(1,1).
fib(2,1).
fib(N,Ret) :- N &amp;gt; 2, N1 is N -1, N2 is N -2, fib(N1,Prv1), fib(N2,Prv2), Ret is Prv2 + Prv1.

factorial(0,1).
factorial(1,1).
factorial(N,Ret) :-  N &amp;gt; 1, N1 is N - 1, factorial(N1, Ret1), Ret is N * Ret1.
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;%--
hanoi(N) :- move(N,left,middle,right).

move(1,A,_,C) :- inform(A,C), !. %-- !
move(N,A,B,C) :- N1 is N - 1,
    move(N1,A,C,B),
    inform(A,C),
    move(N1,B,A,C).

inform(Loc1,Loc2) :- nl,write(&#39;Move a disk from &#39;-Loc1-&#39; to &#39;-Loc2).
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;reverse_list([],[]).
reverse_list(List,ReverseList) :- List = [Head|Tail],
         reverse_list(Tail, ReverseTail),
         append(ReverseTail,[Head],ReverseList).
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;find_min([E],E).
find_min(List,Min) :- List = [Head|Tail], find_min(Tail,Min2), Min is min(Head,Min2).
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sort_list([],[]).
sort_list(List,SortedList) :- List = [Head|Tail],
    sort_list(Tail,SortedTail),
    merge_list(Head,SortedTail,SortedList).

merge_list(E,[],[E]).
merge_list(E1,SortedTail,MergedList) :- SortedTail = [E2|Tail],
    (E1 &amp;lt; E2 -&amp;gt;
        append([E1],SortedTail,MergedList);
        merge_list(E1,Tail,MergedTail),
        append([E2],MergedTail,MergedList)
    ).
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;9x9&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;valid([]).
valid([Head|Tail]) :-
    fd_all_different(Head),
    valid(Tail).

sudoku(Puzzle, Solution) :- Solution = Puzzle ,
    Puzzle = [S11,S12,S13,S14,S15,S16,S17,S18,S19,
    S21,S22,S23,S24,S25,S26,S27,S28,S29,
    S31,S32,S33,S34,S35,S36,S37,S38,S39,
    S41,S42,S43,S44,S45,S46,S47,S48,S49,
    S51,S52,S53,S54,S55,S56,S57,S58,S59,
    S61,S62,S63,S64,S65,S66,S67,S68,S69,
    S71,S72,S73,S74,S75,S76,S77,S78,S79,
    S81,S82,S83,S84,S85,S86,S87,S88,S89,
    S91,S92,S93,S94,S95,S96,S97,S98,S99],
    fd_domain(Puzzle,1,9),

    Row1=[S11,S12,S13,S14,S15,S16,S17,S18,S19],
    Row2=[S21,S22,S23,S24,S25,S26,S27,S28,S29],
    Row3=[S31,S32,S33,S34,S35,S36,S37,S38,S39],
    Row4=[S41,S42,S43,S44,S45,S46,S47,S48,S49],
    Row5=[S51,S52,S53,S54,S55,S56,S57,S58,S59],
    Row6=[S61,S62,S63,S64,S65,S66,S67,S68,S69],
    Row7=[S71,S72,S73,S74,S75,S76,S77,S78,S79],
    Row8=[S81,S82,S83,S84,S85,S86,S87,S88,S89],
    Row9=[S91,S92,S93,S94,S95,S96,S97,S98,S99],
    Col1=[S11, S21, S31, S41, S51, S61, S71, S81, S91],
    Col2=[S12, S22, S32, S42, S52, S62, S72, S82, S92],
    Col3=[S13, S23, S33, S43, S53, S63, S73, S83, S93],
    Col4=[S14, S24, S34, S44, S54, S64, S74, S84, S94],
    Col5=[S15, S25, S35, S45, S55, S65, S75, S85, S95],
    Col6=[S16, S26, S36, S46, S56, S66, S76, S86, S96],
    Col7=[S17, S27, S37, S47, S57, S67, S77, S87, S97],
    Col8=[S18, S28, S38, S48, S58, S68, S78, S88, S98],
    Col9=[S19, S29, S39, S49, S59, S69, S79, S89, S99],

    Square1=[S11,S12,S13, S21,S22,S23, S31,S32,S33],
    Square2=[S14,S15,S16, S24,S25,S26, S34,S35,S36],
    Square3=[S17,S18,S19, S27,S28,S29, S37,S38,S39],
    Square4=[S41,S42,S43, S51,S52,S53, S61,S62,S63],
    Square5=[S44,S45,S46, S54,S55,S56, S64,S65,S66],
    Square6=[S47,S48,S49, S57,S58,S59, S67,S68,S69],
    Square7=[S71,S72,S73, S81,S82,S83, S91,S92,S93],
    Square8=[S74,S75,S76, S84,S85,S86, S94,S95,S96],
    Square9=[S77,S78,S79, S87,S88,S89, S97,S98,S99],

    valid([Row1, Row2, Row3, Row4, Row5, Row6, Row7, Row8, 
        Row9, Col1, Col2, Col3, Col4, Col5, Col6, Col7, Col8, Col9,
        Square1, Square2, Square3, Square4, Square5, Square6,
        Square7, Square8, Square9]),

    write( &#39;\n&#39; ), write( Row1 ),
    write( &#39;\n&#39; ), write( Row2 ),
    write( &#39;\n&#39; ), write( Row3 ),
    write( &#39;\n&#39; ), write( Row4 ),
    write( &#39;\n&#39; ), write( Row5 ),
    write( &#39;\n&#39; ), write( Row6 ),
    write( &#39;\n&#39; ), write( Row7 ),
    write( &#39;\n&#39; ), write( Row8 ),
    write( &#39;\n&#39; ), write( Row9 ).
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
      
    </item>
    
    <item>
      <title>IO</title>
      <link>https://blog.kk17.net/post/seven-days-seven-languages-io/</link>
      <pubDate>Fri, 08 May 2015 09:00:00 +0800</pubDate>
      
      <guid>https://blog.kk17.net/post/seven-days-seven-languages-io/</guid>
      
        <description>

&lt;h2 id=&#34;io&#34;&gt;Io&lt;/h2&gt;

&lt;p&gt;IoIo&lt;br /&gt;
Io&lt;br /&gt;
IoIo&lt;/p&gt;

&lt;h2 id=&#34;-&#34;&gt;&lt;/h2&gt;

&lt;p&gt;Ioslot&lt;br /&gt;
&lt;br /&gt;
 1.  &lt;code&gt;:=&lt;/code&gt;Io&lt;br /&gt;
 2.  &lt;code&gt;=&lt;/code&gt;&lt;br /&gt;
 3.  &lt;code&gt;::=&lt;/code&gt;
 4.  type type&lt;br /&gt;
 5.  slotNames&lt;br /&gt;
 6.  getSlot(name)&lt;/p&gt;

&lt;p&gt;IoIotypetype&lt;br /&gt;
&lt;!-- more --&gt;&lt;/p&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;p&gt;&lt;br /&gt;
&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Io&amp;gt;method() type  
==&amp;gt;Block  
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Lobbyjavascriptwindow&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Io&amp;gt; Lobby
  Protos           = Object_0x1dac868
  _                = Object_0x1dac8c8
  exit             = method(...)
  forward          = method(...)
  set_             = method(...)
&lt;/code&gt;&lt;/pre&gt;

&lt;ol&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;br /&gt;&lt;/li&gt;
&lt;li&gt;&lt;br /&gt;&lt;/li&gt;
&lt;li&gt;&lt;br /&gt;&lt;/li&gt;
&lt;li&gt;&lt;br /&gt;&lt;/li&gt;
&lt;li&gt;&lt;br /&gt;&lt;/li&gt;
&lt;li&gt;&lt;br /&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;&#34;&gt;&lt;/h3&gt;

&lt;p&gt;truefalsenilsingletonclone&lt;/p&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;1+11+&amp;ldquo;one&amp;rdquo;Io&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Io&amp;gt; 1+1
==&amp;gt; 2
Io&amp;gt; 1+&amp;quot;one&amp;quot;

Exception: argument 0 to method &#39;+&#39; must be a Number, not a &#39;Sequence&#39;
---------
message &#39;+&#39; in &#39;Command Line&#39; on line 1

Io&amp;gt; &amp;quot;1&amp;quot;+&amp;quot;one&amp;quot;

Exception: Io Assertion &#39;operation not valid on non-number encodings&#39;
---------
message &#39;+&#39; in &#39;Command Line&#39; on line 1

Io&amp;gt; &amp;quot;1&amp;quot; .. &amp;quot;one&amp;quot;
==&amp;gt; 1one
Io&amp;gt; 1 .. &amp;quot;one&amp;quot;
==&amp;gt; 1one
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;0truefalsetruefalseniltruefalse&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Io&amp;gt; if( 0 , true println,false println)
true
==&amp;gt; true
Io&amp;gt; if( &amp;quot;&amp;quot; , true println,false println)
true
==&amp;gt; true
Io&amp;gt; if( nil , true println,false println)
false
==&amp;gt; false
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Io&amp;gt; Sequence slotNames foreach(println)
log
linePrint
beforeSeq
pathComponent
urlDecoded
removeSeq
bitwiseAnd
removeOddIndexes
uppercase
findSeq
replaceSeq
cPrint
logicalOr
...
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;code&gt;=:=::=&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Io&amp;gt; OperatorTable
==&amp;gt; OperatorTable_0x951180:
Operators
  0   ? @ @@
  ...

Assign Operators
  ::= newSlot
  :=  setSlot
  =   updateSlot
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;::=:=&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Io&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;D:\IoCodes&amp;gt;cat sum.io
sum := 0
for(i,1,100,
        sum = sum + i
)
sum println

D:\IoCodes&amp;gt;io sum.io
5050
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;pre&gt;&lt;code&gt;Io&amp;gt; OperatorTable addOperator(&amp;quot;xor&amp;quot;,11)
==&amp;gt; OperatorTable_0x1d61180:
Operators
  ...
  10  &amp;amp;&amp;amp; and
  11  or xor ||
  12  ..
  13  %= &amp;amp;= *= += -= /= &amp;lt;&amp;lt;= &amp;gt;&amp;gt;= ^= |=
  14  return

Assign Operators
  ::= newSlot
  :=  setSlot
  =   updateSlot

To add a new operator: OperatorTable addOperator(&amp;quot;+&amp;quot;, 4) and implement the + message.
To add a new assign operator: OperatorTable addAssignOperator(&amp;quot;=&amp;quot;, &amp;quot;updateSlot&amp;quot;) and implement the updateSlot   message.

Io&amp;gt; true xor := method(bool,if(bool,false,true))
==&amp;gt; method(bool,
    if(bool, false, true)
)
Io&amp;gt; false xor := method(bool,if(bool,true,false))
==&amp;gt; method(bool,
    if(bool, true, false)
)
Io&amp;gt; true xor false
==&amp;gt; true
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;p&gt;Iosender)targetargumentscall&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;//msg.io
MsgReceiver := Object clone
MsgReceiver receive := method(
    &amp;quot;message name is : &amp;quot; print
    call message name println

    &amp;quot;sender is :&amp;quot; println
    call sender  println

    &amp;quot;target is :&amp;quot; println
    call target  println

    &amp;quot;arguments is :&amp;quot; println
    call message arguments  println

    &amp;quot;arguments[0] is : &amp;quot; print
    call message argAt(0)  println
    &amp;quot;arguments[0] is : &amp;quot; print
    call argAt(0)  type println
    &amp;quot;arguments[0] is : &amp;quot; print
    call evalArgAt(0)  type println
)

MsgSender := Object clone
MsgSender send := method(
    &amp;quot;message name is : &amp;quot; print
    call message name println

    &amp;quot;sender is :&amp;quot; println
    call sender  println

    &amp;quot;target is :&amp;quot; println
    call target  println
    receiver := MsgReceiver clone
    receiver receive(&amp;quot;hollo world!&amp;quot;)
)

sender := MsgSender clone
sender send

//result:
message name is : send
sender is :
 Object_0x44c890:
  Lobby            = Object_0x44c890
  MsgReceiver      = MsgReceiver_0x2171178
  MsgSender        = MsgSender_0x2171238
  Protos           = Object_0x44c830
  _                = nil
  exit             = method(...)
  forward          = method(...)
  sender           = MsgSender_0x21712c8
  set_             = method(...)

target is :
 MsgSender_0x21712c8:

message name is : receive
sender is :
 MsgSender_0x21712c8:

target is :
 MsgReceiver_0x217c368:

arguments is :
list(&amp;quot;hollo world!&amp;quot;)
arguments[0] is : &amp;quot;hollo world!&amp;quot;
arguments[0] is : Message
arguments[0] is : Sequence
[Finished in 0.2s]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;sendLobby
evalArgAtargAt&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;evalArgAt(argNumber)&lt;br /&gt;
 Evaluates the specified argument of the Calls message in the context of its sender.&lt;/p&gt;

&lt;p&gt;argAt(argNumber)&lt;br /&gt;
  Returns the messages argNumber arg. Shorthand for same as call message argAt(argNumber).&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;IoIo&lt;/p&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;p&gt;Io&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Object ancestors := method(
    prototype := self proto
    if(prototype !=Object,
    writeln(&amp;quot;Slots of &amp;quot;,prototype type,&amp;quot;\n---------------------&amp;quot;)
    prototype slotNames foreach(slotName, writeln(slotName))
    writeln
    prototype ancestors))

Animal := Object clone
Animal speak := method(
    &amp;quot;ambigulous animal noise&amp;quot; println
)

Duck := Animal clone
Duck speak := method(
    &amp;quot;quack&amp;quot; println
)

Duck walk := method(
    &amp;quot;waddle&amp;quot; println
)

disco := Duck clone
disco ancestors

disco walk

disco speak

***************output:*******************
Slots of Duck
---------------------
walk
speak
type

Slots of Animal
---------------------
speak
type

waddle
quack
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;fib := method(n,
    if(n ==1 or n == 2) then(
        return 1
    ) else (
        return (fib(n-1) + fib(n-2))
    )
)

fib2 := method(n,
    if(n == 1) then (
        return 1
    ) else (
        prv1 := 1
        prv2 := 0
        cur := 0
        for(i,2,n,
            cur = prv1 + prv2
            prv2 = prv1
            prv1 = cur
        )
        return cur
    )
)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;0/0&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Number setSlot(&amp;quot;coreDivision&amp;quot;, Number getSlot(&amp;quot;/&amp;quot;))

Number / = method(n,
    if(n==0) then(
        return 0
    )else(
        return (self coreDivision(n))
    )
)

(4/0) println

(8/4) println

(16/8) println

(16 / -8) println
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;br /&gt;
IoArrayList&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sum := method(arr,
    if(arr type != &amp;quot;List&amp;quot;) then(
        return 0
    )
    sum := 0
    arr foreach(e,
        if(e type != &amp;quot;List&amp;quot;) then(
            continue
        )
        if(e size &amp;lt; 2) then(
            continue
        )
        sum = sum + e at(0)
        sum = sum + e at(1)
    )
    return sum
)

sum(list(list(3,4),list(5))) println
sum(list(7,8)) println

************output*************
7
0
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;myAverage&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;List myAverage := method(
    if(self isEmpty) then( return 0 )
    sum := 0
    self foreach(e,
        if(e type != &amp;quot;Number&amp;quot;) then(
            Exception raise(&amp;quot;List member is not a number&amp;quot;) 
        )
        sum = sum + e
    )
    avg := sum / self size
)

list() myAverage println
list(3,4,5,1.2) myAverage println
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;dimyxset(x,y) get(x,y)&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;TwoDArray := Object clone
TwoDArray dim := method(x,y,
    self data := list()
    for(i,0,x-1,
        innerList := list()
        for(j,0,y-1,
            innerList append(nil)
        )
        data append(innerList)
    )
)

TwoDArray set := method(x,y,e,
    outterList := self data
    if(x &amp;gt; outterList size, return)
    innerList := outterList at(x)
    if(y &amp;gt; innerList size, return)
    innerList atPut(y,e)
)

TwoDArray get := method(x,y,
    outterList := self data
    if(x &amp;gt; outterList size, return nil)
    innerList := outterList at(x)
    if(y &amp;gt; innerList size, return nil)
    innerList at(y)
)


arr2 := TwoDArray clone
arr2 dim(3,4)
arr2 set(1,2,3)
arr2 set(1,10,3)
arr2 get(1,2) println
arr2 get(1,10) println
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;dim(x,y)xy  &lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;matrix get(x,y)(new_matrix get(y,x))&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;TwoDArray transpose := method(
    outterList := self data
    y := outterList size
    innerList := outterList at(0)
    x := innerList size
    ret := TwoDArray clone
    ret dim(x, y)
    for(i,0,x-1,
        for(j,0,y-1,
            ret set(i, j, self get(j, i))
        )
    )
    return ret
)


arr2 := TwoDArray clone
arr2 dim(3,4)
arr2 set(1,2,3)
arr2 set(1,10,3)
arr2 get(1,2) println
arr2 get(1,10) println
&amp;quot;-----------&amp;quot; println
arr3 := arr2 transpose
arr3 get(2,1) println
arr3 get(10,1) println
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;TwoDArray writeMatrix := method(filePath,
    f := File with(filePath)
    f remove
    f openForUpdating
    outterList := self data
    x := outterList size
    y := outterList at(0) size
    f write((x .. &amp;quot;,&amp;quot; .. y .. &amp;quot;\n&amp;quot;))
    outterList foreach(e,
        line := &amp;quot;&amp;quot;
        e foreach(e2,
            line = line .. e2 .. &amp;quot;,&amp;quot;
        )
        f write(line exSlice(0,-1),&amp;quot;\n&amp;quot;)
    )
    f close
)


TwoDArray readMatrix := method(filePath,
    f := File with(filePath)
    f openForReading
    line := f readLine
    d := line split(&amp;quot;,&amp;quot;)
    x := d at(0) asNumber
    y := d at(1) asNumber
    ret := TwoDArray clone
    ret dim(x,y)
    writeln(&amp;quot;x=&amp;quot;,x,&amp;quot;, y=&amp;quot;,y)
    i := 0
    j := 0
    f readLines foreach(line,
        list := line split(&amp;quot;,&amp;quot;)
        j = 0
        list foreach(e,
            writeln(i,&amp;quot;x&amp;quot;,j,&amp;quot;=&amp;quot;,e)
            if(e != &amp;quot;nil&amp;quot;,ret set(i,j,e))
            j = j + 1
        )
        i = i +1
    )
    f close
    return ret
)


TwoDArray writeMatrix2 := method(filePath,
    f := File with(filePath)
    f remove
    f openForUpdating
    f write(self serialized())
    f close
)

TwoDArray readMatrix2 := method(filePath,
    ret := doFile(filePath)
    return ret
)


arr2 := TwoDArray clone
arr2 dim(3,4)
arr2 set(1,2,3)
arr2 set(1,10,3)
arr2 get(1,2) println
arr2 get(1,10) println
&amp;quot;-----------&amp;quot; println
arr3 := arr2 transpose
arr3 get(2,1) println
arr3 get(10,1) println

arr3 writeMatrix(&amp;quot;./test.dt&amp;quot;)

arr4 := TwoDArray readMatrix(&amp;quot;./test.dt&amp;quot;)

arr4 println
arr4 get(2,1) println
arr4 get(10,1) println

arr3 writeMatrix2(&amp;quot;./test2.dt&amp;quot;)

arr5 := TwoDArray readMatrix2(&amp;quot;./test2.dt&amp;quot;)

arr5 println
arr5 get(2,1) println
arr5 get(10,1) println
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;101~100&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;GuessNumGame := Object clone
GuessNumGame init := method(
    self secretNum := Random value(1,101) floor
    self guessTimes := 0
    self lowBoundry := 0
    self highBoundry := 100
    secretNum println
)

GuessNumGame guess := method(x,
    guessTimes println
    if(guessTimes &amp;gt; 10) then(
        &amp;quot;You had guess over 10 times! Game over!&amp;quot; println
        return
    )
    if(x &amp;lt; secretNum) then(
        if(x &amp;gt; lowBoundry,lowBoundry = x)
        writeln(&amp;quot;You guess lowwer. You can guess between &amp;quot;,lowBoundry,&amp;quot; to &amp;quot;,highBoundry)
    ) elseif(x == self secretNum) then(
        writeln(&amp;quot;Congratulations! You got the right number!&amp;quot;)
    ) else(
        if(x &amp;lt; highBoundry, highBoundry = x)
        writeln(&amp;quot;You guess higher. You can guess between &amp;quot;,lowBoundry,&amp;quot; to &amp;quot;,highBoundry)
    )
    guessTimes = guessTimes + 1
)

game := GuessNumGame clone
game guess(10)
game guess(50)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;p&gt;IoDSLAPI&lt;br /&gt;
&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
    &amp;quot;Bob smith&amp;quot;:&amp;quot;5195551212&amp;quot;,
    &amp;quot;Mary Walsh&amp;quot;:&amp;quot;4162223434&amp;quot;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;OperatorTable addAssignOperator(&amp;quot;:&amp;quot;,&amp;quot;atPutNumber&amp;quot;)
curlyBrackets := method(
    r := Map clone
    call message arguments foreach(arg,
        r doMessage(arg)
    )
    r
)

Map atPutNumber := method(
    self atPut(
        call evalArgAt(0) asMutable removePrefix(&amp;quot;\&amp;quot;&amp;quot;) removeSuffix(&amp;quot;\&amp;quot;&amp;quot;),
        call evalArgAt(1)
    )
)

s := File with(&amp;quot;phonebook.txt&amp;quot;) openForReading contents
phoneNumbers := doString(s)  //doStringIo
phoneNumbers keys println
phoneNumbers values println
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;iomethod-messing&#34;&gt;Iomethod_messing&lt;/h2&gt;

&lt;p&gt;Rubymethod_missingIoforwardIoforwardObject&lt;br /&gt;
XMLIoXML
&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;body&amp;gt;
&amp;lt;p&amp;gt;
This is a simple paragraph.
&amp;lt;/p&amp;gt;
&amp;lt;/body&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;body(
    p(&amp;quot;This is a simple paragraph.&amp;quot;)
)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;LispMLIoforwardmissing_method&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Builder := Object clone
Builder forward := method(
    writeln(&amp;quot;&amp;lt;&amp;quot;,call message name,&amp;quot;&amp;gt;&amp;quot;)
        call message arguments foreach(arg,
            content := self doMessage(arg)
            if(content type == &amp;quot;Sequence&amp;quot;, writeln(content))
        )
    writeln(&amp;quot;&amp;lt;/&amp;quot;,call message name,&amp;quot;&amp;gt;&amp;quot;)
)

Builder ul(
    li(&amp;quot;IO&amp;quot;),
    li(&amp;quot;Lua&amp;quot;),
    li(&amp;quot;Javascript&amp;quot;)
)
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;p&gt;Ioactorfuture&lt;/p&gt;

&lt;h3 id=&#34;1-&#34;&gt;1.&lt;/h3&gt;

&lt;p&gt;yield
@@@futurenil&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vizzini := Object clone
vizzini talk := method(
    &amp;quot;Fezzik, are there rooks ahead?&amp;quot; println
    yield
    &amp;quot;No more rhymes now, I mean it.&amp;quot; println
    yield
)

fezzik := Object clone
fezzik rhyme := method(
    yield
    &amp;quot;If there are, we&#39;ll all be dead.&amp;quot; println
    yield
    &amp;quot;Anybody want a peanut?&amp;quot; println
)

vizzini @@talk
fezzik @@rhyme

Coroutine currentCoroutine pause
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;actoractoractoractorIoactor&lt;/p&gt;

&lt;h3 id=&#34;2-actor&#34;&gt;2.Actor&lt;/h3&gt;

&lt;p&gt;actoractoractor&lt;br /&gt;
Ioactor&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;slower := Object clone
faster := Object clone

slower start := method(
    wait(2)
    writeln(&amp;quot;slowly&amp;quot;)
)

faster start := method(
    wait(1)
    writeln(&amp;quot;quickly&amp;quot;)
)

slower start
faster start
&amp;quot;======================&amp;quot; println
slower @@start
faster @@start
Coroutine currentCoroutine pause
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;3-future&#34;&gt;3.future&lt;/h3&gt;

&lt;p&gt;Iofuturefuturefuturefuturefuture&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;futureResult := URL with(&amp;quot;http://google.com/&amp;quot;) @fetch
writeln(&amp;quot;doing other thing ...&amp;quot;)
wait(2)
writeln(&amp;quot;fetched,&amp;quot; futureResult size,&amp;quot; bytes&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;windowsException: Object does not respond to &amp;lsquo;URL&amp;rsquo;google&lt;/p&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;XML&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Builder := Object clone
Builder indentSize := 4
Builder i := 0
Builder forward := method(
    (i * indentSize) repeat(write(&amp;quot; &amp;quot;))
    writeln(&amp;quot;&amp;lt;&amp;quot;,call message name,&amp;quot;&amp;gt;&amp;quot;)

    i = i + 1
    call message arguments foreach(arg,
        content := self doMessage(arg)
        if(content type == &amp;quot;Sequence&amp;quot;, 
            (i * indentSize) repeat(write(&amp;quot; &amp;quot;))
            writeln(content)
        )
    )
    i = i -1

    (i * indentSize) repeat(write(&amp;quot; &amp;quot;))
    writeln(&amp;quot;&amp;lt;/&amp;quot;,call message name,&amp;quot;&amp;gt;&amp;quot;)
)

Builder ul(
    li(p(&amp;quot;IO&amp;quot;)),
    li(&amp;quot;Lua&amp;quot;),
    li(&amp;quot;Javascript&amp;quot;)
)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;squareBrackets := method(       
  if(call message arguments asString containsSeq(&amp;quot;squareBrackets&amp;quot;) not,return call message arguments)       //,list
  list := List clone
  call message arguments foreach(arg,
   aArg := if(arg asString beginsWithSeq(&amp;quot;squareBrackets&amp;quot;),doMessage(arg),arg)
   list append(aArg)// 
  )
  list
)

[] println
[1,&amp;quot;kk&amp;quot;] println
[1,[&amp;quot;kk&amp;quot;,10.5]] println
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;xmlxml&lt;br /&gt;
&lt;code&gt;book({&amp;quot;author&amp;quot;:&amp;quot;Tate&amp;quot;}...)&lt;/code&gt; &lt;code&gt;&amp;lt;book author=&amp;quot;Tate&amp;quot;&amp;gt;&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;OperatorTable addAssignOperator(&amp;quot;:&amp;quot;,&amp;quot;addAttribute&amp;quot;)

Builder := Object clone

Builder addAttribute := method(
    call message arguments println
    write(call evalArgAt(0))
    write(&amp;quot;=\&amp;quot;&amp;quot;,call evalArgAt(1),&amp;quot;\&amp;quot;&amp;quot;)
)

Builder curlyBrackets := method(
    call message arguments foreach(arg,
        self doMessage(arg)
    )
)



Builder indentSize := 4
Builder i := 0
Builder forward := method(
    (i * indentSize) repeat(write(&amp;quot; &amp;quot;))
    write(&amp;quot;&amp;lt;&amp;quot;,call message name)

    i = i + 1

    args :=call message arguments 
    arg1 := args at(0)
    if( arg1 asString beginsWithSeq(&amp;quot;curlyBrackets&amp;quot;),
        //arg1 println
        self doMessage(arg1)
        args remove(arg1)
    )
    writeln(&amp;quot;&amp;gt;&amp;quot;)
    args foreach(arg,
        content := self doMessage(arg)
        if(content type == &amp;quot;Sequence&amp;quot;, 
            (i * indentSize) repeat(write(&amp;quot; &amp;quot;))
            writeln(content)
        )
    )
    i = i -1

    (i * indentSize) repeat(write(&amp;quot; &amp;quot;))
    writeln(&amp;quot;&amp;lt;/&amp;quot;,call message name,&amp;quot;&amp;gt;&amp;quot;)
)


Builder ul(
    {&amp;quot;class&amp;quot; : &amp;quot;foo&amp;quot;,&amp;quot;id&amp;quot; : &amp;quot;language&amp;quot;},
    li(&amp;quot;Io&amp;quot;)
)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    &amp;lt;ul
      Exception: Sequence does not respond to &#39;:&#39;
      ---------
      Sequence :                           builder.io 50
      Builder curlyBrackets                builder.io 50
      Builder ul                           builder.io 49
      CLI doFile                           Z_CLI.io 140
      CLI run     
&lt;/code&gt;&lt;/pre&gt;
</description>
      
    </item>
    
    <item>
      <title>Effective Java2</title>
      <link>https://blog.kk17.net/post/effective-java-reading-note/</link>
      <pubDate>Thu, 07 May 2015 09:00:00 +0800</pubDate>
      
      <guid>https://blog.kk17.net/post/effective-java-reading-note/</guid>
      
        <description>

&lt;h2 id=&#34;2-&#34;&gt;2 &lt;/h2&gt;

&lt;h3 id=&#34;1-&#34;&gt;1&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;br /&gt;
1. &lt;br /&gt;
2. &lt;br /&gt;
3. JDBCSLF4J&lt;br /&gt;
4. &lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;br /&gt;
1. Collections Framework&lt;br /&gt;
2. API&lt;/p&gt;

&lt;h3 id=&#34;2-&#34;&gt;2&lt;/h3&gt;

&lt;blockquote&gt;
&lt;p&gt;BuilderBuilderJavaBean&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;3-singleton&#34;&gt;3Singleton&lt;/h3&gt;

&lt;blockquote&gt;
&lt;p&gt;Singleton
&lt;!-- more --&gt;&lt;/p&gt;

&lt;h3 id=&#34;4-&#34;&gt;4&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;pre&gt;&lt;code&gt;//Noinstantiable
private class UtilityClass {
    //suppress default constructor noninstantiability
    private UtilityClass(){
        throw AssertionError();
    }
    ... // Remainder omitted
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;/p&gt;

&lt;h3 id=&#34;5-&#34;&gt;5&lt;/h3&gt;

&lt;ol&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;br /&gt;&lt;/li&gt;
&lt;li&gt;Adapter/View&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;6-&#34;&gt;6&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;br /&gt;
1. &lt;br /&gt;
2.  &lt;strong&gt;WeakHashMap&lt;/strong&gt; &lt;br /&gt;
3.  &lt;strong&gt;WeakHashMap&lt;/strong&gt; )&lt;/p&gt;

&lt;h3 id=&#34;7-&#34;&gt;7&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;br /&gt;
1.  Java&lt;br /&gt;
2.  &lt;br /&gt;
3.  &lt;/p&gt;

&lt;p&gt;cry-finallyInputStream,OutputStreamclose&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;//Finalier Guardian idiom
Public clss Foo {
    //Sole purpose of this object is to finalize outer Foo object
    private final Object finalizerGuardian = new Object(){
        @Override
        protected void finalize() throw Throwable{
            ...//Finalize outer Foo object
        }
    }
    ...// Remaider omitted
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;3-&#34;&gt;3&lt;/h2&gt;

&lt;h3 id=&#34;8-equals&#34;&gt;8equals&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;equals&lt;/strong&gt;&lt;br /&gt;
1. &lt;br /&gt;
2. &lt;br /&gt;
3. &lt;br /&gt;
4. &lt;br /&gt;
5. Non-Nullity&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;equals&lt;/strong&gt;&lt;br /&gt;
&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;equals:&lt;/strong&gt;
1. ==&lt;br /&gt;
2. instanceof&lt;br /&gt;
3. &lt;br /&gt;
4. &lt;br /&gt;
5. equals&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;br /&gt;
1. equalshashCode&lt;br /&gt;
2. equals&lt;br /&gt;
3. Object&lt;/p&gt;

&lt;h3 id=&#34;9-equalshashcode&#34;&gt;9equalshashCode&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;hashCode&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;br /&gt;
1. 17,resultint&lt;br /&gt;
2. fequals&lt;br /&gt;
 - a.intc&lt;br /&gt;
  + .booleanf?1:0)&lt;br /&gt;
  + .bytecharshortintintf&lt;br /&gt;
  + .longintf^(f&amp;gt;&amp;gt;&amp;gt;32)
  + .folatFloat.floatToIntBits(f)&lt;br /&gt;
  + .doubleDouble.doubelToLongBits(f),2.a.,
       long
  + .equalsequals
       hashCode
       hashCodenull0&lt;br /&gt;
  + .
       2.b1.5Arrays.hashCode&lt;br /&gt;
  - b.2.acresult&lt;br /&gt;
     &lt;code&gt;result=32*result+c&lt;/code&gt;&lt;br /&gt;
3. result&lt;br /&gt;
4. hashCode&lt;/p&gt;

&lt;h3 id=&#34;10-tostring&#34;&gt;10toString&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;toString&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&#34;11-clone&#34;&gt;11clone&lt;/h3&gt;

&lt;blockquote&gt;
&lt;p&gt;Cloneablemixinclone,ObjectcloneCloneablecloneclone&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;br /&gt;
1. clonefinal17&lt;br /&gt;
2. Cloneablecloneclonesuper.clone&lt;br /&gt;
3. &lt;/p&gt;

&lt;h3 id=&#34;12-comparable&#34;&gt;12Comparable&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;
1. compareToequals
2. Comparable
3. compareToequals
4. Float.compareDouble.compare&lt;/p&gt;

&lt;h2 id=&#34;4-&#34;&gt;4&lt;/h2&gt;

&lt;h3 id=&#34;13-&#34;&gt;13&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;
1. Serializable&lt;br /&gt;
2. &lt;br /&gt;
3. final&lt;/p&gt;

&lt;h3 id=&#34;14-&#34;&gt;14&lt;/h3&gt;

&lt;h3 id=&#34;15-&#34;&gt;15&lt;/h3&gt;

&lt;p&gt;5
1. &lt;br /&gt;
2. &lt;br /&gt;
3. final&lt;br /&gt;
4. &lt;br /&gt;
5. readObject**&lt;/p&gt;

&lt;p&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;br /&gt;
1. 
2. 
3. &lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;br /&gt;
&lt;/p&gt;

&lt;h3 id=&#34;16-&#34;&gt;16&lt;/h3&gt;

&lt;p&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;
 -&amp;gt; (wrapper)  -&amp;gt; (forwarding)&lt;br /&gt;
&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;/p&gt;

&lt;h3 id=&#34;17---&#34;&gt;17&lt;/h3&gt;

&lt;p&gt;&lt;br /&gt;
1. &lt;br /&gt;
2. &lt;br /&gt;
3. &lt;br /&gt;
4. CloneSerializable&lt;/p&gt;

&lt;h3 id=&#34;18-&#34;&gt;18&lt;/h3&gt;

&lt;p&gt;&lt;br /&gt;
1. &lt;br /&gt;
2. mixin&lt;br /&gt;
3. &lt;/p&gt;

&lt;p&gt;skeletal implementation&lt;/p&gt;

&lt;h3 id=&#34;19-&#34;&gt;19&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;br /&gt;
&lt;br /&gt;
1. &lt;br /&gt;
2. &lt;/p&gt;

&lt;h3 id=&#34;20-&#34;&gt;20&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;br /&gt;
&lt;/p&gt;

&lt;h3 id=&#34;21-&#34;&gt;21&lt;/h3&gt;

&lt;h3 id=&#34;22-&#34;&gt;22&lt;/h3&gt;

&lt;p&gt;&lt;br /&gt;
1. &lt;br /&gt;
2. AdapterMapKeySet&lt;br /&gt;
3. &lt;br /&gt;
4. &lt;/p&gt;

&lt;p&gt;&lt;/p&gt;

&lt;h2 id=&#34;5-&#34;&gt;5&lt;/h2&gt;

&lt;h3 id=&#34;23-&#34;&gt;23&lt;/h3&gt;

&lt;p&gt;&lt;br /&gt;
nullCollections&lt;code&gt;&amp;lt;?&amp;gt;&lt;/code&gt;&lt;br /&gt;
class literalJackson TypeReference&lt;/p&gt;

&lt;h3 id=&#34;24-&#34;&gt;24&lt;/h3&gt;

&lt;p&gt;ClassCastException@SuppressWarnings(&amp;ldquo;unchecked&amp;rdquo;)&lt;/p&gt;

&lt;h3 id=&#34;25-&#34;&gt;25&lt;/h3&gt;

&lt;p&gt;&lt;br /&gt;
1. SubSuperSub[]Super[]List&lt;code&gt;&amp;lt;sub&amp;gt;&lt;/code&gt;List&lt;code&gt;&amp;lt;Super&amp;gt;&lt;/code&gt;
2. &lt;/p&gt;

&lt;p&gt;&lt;/p&gt;

&lt;h3 id=&#34;26-&#34;&gt;26&lt;/h3&gt;

&lt;h3 id=&#34;27-&#34;&gt;27&lt;/h3&gt;

&lt;p&gt;&lt;/p&gt;

&lt;h3 id=&#34;28-api&#34;&gt;28API&lt;/h3&gt;

&lt;blockquote&gt;
&lt;p&gt;APIAPIproducer-extendsconsumer-superPECSComparablecomparator&lt;/p&gt;
&lt;/blockquote&gt;

&lt;pre&gt;&lt;code&gt;public static &amp;lt;T extends Comparable&amp;lt;? super T&amp;gt;&amp;gt; T max (List&amp;lt;? extends T&amp;gt; list);

public static void swap(List&amp;lt;?&amp;gt; list,int i,int j){
    swapHelper(list,i,j);
}

private static void &amp;lt;T&amp;gt; swapHelper(List&amp;lt;T&amp;gt;,int i,int j){
    list.set(i.list.set(j,list.get(i)));
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;29-&#34;&gt;29&lt;/h3&gt;

&lt;p&gt;APIClassClass&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;public class Favorites{
    public &amp;lt;T&amp;gt; void putFavorite(Class&amp;lt;T&amp;gt; type,T instance);
    public &amp;lt;T&amp;gt; T getFavorite(Class &amp;lt;T&amp;gt; type);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;6-&#34;&gt;6&lt;/h2&gt;

&lt;h3 id=&#34;30-enumint&#34;&gt;30enumint&lt;/h3&gt;

&lt;p&gt;int
    public enum Operation{
        PLUS { double apple(double x,double y) {
            return x+y;
        }}&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    abstract double apply(double x,double y) ;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;31-&#34;&gt;31&lt;/h3&gt;

&lt;p&gt;&lt;/p&gt;

&lt;h3 id=&#34;32-enumset&#34;&gt;32EnumSet&lt;/h3&gt;

&lt;p&gt;EnumSet&lt;/p&gt;

&lt;h3 id=&#34;33-enummap&#34;&gt;33EnumMap&lt;/h3&gt;

&lt;p&gt;ordnalEnumMapEnumMap&lt;code&gt;&amp;lt;...,EnumMap&amp;lt;...&amp;gt;&amp;gt;&lt;/code&gt;Enum.ordinal&lt;/p&gt;

&lt;h3 id=&#34;34-&#34;&gt;34&lt;/h3&gt;

&lt;p&gt;API&lt;/p&gt;

&lt;h3 id=&#34;35-&#34;&gt;35&lt;/h3&gt;

&lt;p&gt;&lt;br /&gt;
1. &lt;br /&gt;
2. &lt;br /&gt;
3. &lt;/p&gt;

&lt;h3 id=&#34;36-override&#34;&gt;36Override&lt;/h3&gt;

&lt;p&gt;Override&lt;/p&gt;

&lt;h2 id=&#34;7-&#34;&gt;7&lt;/h2&gt;

&lt;h3 id=&#34;38-&#34;&gt;38&lt;/h3&gt;

&lt;p&gt;Java@throw&lt;/p&gt;

&lt;h3 id=&#34;39-&#34;&gt;39&lt;/h3&gt;

&lt;p&gt;&lt;/p&gt;

&lt;h3 id=&#34;40-&#34;&gt;40&lt;/h3&gt;

&lt;ol&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;li&gt;Builder&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;41-&#34;&gt;41&lt;/h3&gt;

&lt;p&gt;&lt;/p&gt;

&lt;h3 id=&#34;42-&#34;&gt;42&lt;/h3&gt;

&lt;h3 id=&#34;43-null&#34;&gt;43null&lt;/h3&gt;

&lt;h3 id=&#34;44-api&#34;&gt;44API&lt;/h3&gt;

&lt;h2 id=&#34;8-&#34;&gt;8&lt;/h2&gt;

&lt;h3 id=&#34;45-&#34;&gt;45&lt;/h3&gt;

&lt;p&gt;forwhile&lt;/p&gt;

&lt;h3 id=&#34;46-for-eachfor&#34;&gt;46for-eachfor&lt;/h3&gt;

&lt;p&gt;for-eachbugfor&lt;/p&gt;

&lt;h3 id=&#34;47-&#34;&gt;47&lt;/h3&gt;

&lt;h3 id=&#34;48--floatdouble&#34;&gt;48floatdouble&lt;/h3&gt;

&lt;p&gt;floatdoubleBigDecimal&lt;/p&gt;

&lt;h3 id=&#34;49-&#34;&gt;49&lt;/h3&gt;

&lt;p&gt;&lt;/p&gt;

&lt;h3 id=&#34;50--&#34;&gt;50&lt;/h3&gt;

&lt;p&gt;&lt;/p&gt;

&lt;h3 id=&#34;51-&#34;&gt;51&lt;/h3&gt;

&lt;p&gt;StringBuilderappend&lt;/p&gt;

&lt;h3 id=&#34;52-&#34;&gt;52&lt;/h3&gt;

&lt;h3 id=&#34;53-&#34;&gt;53&lt;/h3&gt;

&lt;p&gt;&lt;br /&gt;
1. 
2. 
3. &lt;/p&gt;

&lt;p&gt;&lt;/p&gt;

&lt;h3 id=&#34;54-&#34;&gt;54&lt;/h3&gt;

&lt;p&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;API&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;56-&#34;&gt;56&lt;/h3&gt;

&lt;h2 id=&#34;9-&#34;&gt;9&lt;/h2&gt;

&lt;h3 id=&#34;57-&#34;&gt;57&lt;/h3&gt;

&lt;h3 id=&#34;58--&#34;&gt;58&lt;/h3&gt;

&lt;h3 id=&#34;59-&#34;&gt;59&lt;/h3&gt;

&lt;h3 id=&#34;60-&#34;&gt;60&lt;/h3&gt;

&lt;p&gt;IllegalArgumentException&lt;br /&gt;
IllegalStateException&lt;br /&gt;
NullPointorException&lt;br /&gt;
IndexOutOfBoundsException&lt;br /&gt;
ConcurrentModifficationException&lt;br /&gt;
UnspportedOperationException&lt;/p&gt;

&lt;h3 id=&#34;61-&#34;&gt;61&lt;/h3&gt;

&lt;p&gt;&lt;/p&gt;

&lt;h3 id=&#34;62-&#34;&gt;62&lt;/h3&gt;

&lt;p&gt;throwsthrows&lt;/p&gt;

&lt;h3 id=&#34;63-&#34;&gt;63&lt;/h3&gt;

&lt;p&gt;&lt;/p&gt;

&lt;h3 id=&#34;64-&#34;&gt;64&lt;/h3&gt;

&lt;p&gt;API&lt;/p&gt;

&lt;h3 id=&#34;65-&#34;&gt;65&lt;/h3&gt;

&lt;h2 id=&#34;10-&#34;&gt;10&lt;/h2&gt;

&lt;h3 id=&#34;66-&#34;&gt;66&lt;/h3&gt;

&lt;p&gt;Javaatomiclongdoublelongdouble&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;Java&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;
++&lt;/p&gt;

&lt;p&gt;VMvolatile&lt;/p&gt;

&lt;h3 id=&#34;67-&#34;&gt;67&lt;/h3&gt;

&lt;p&gt;&lt;/p&gt;

&lt;h3 id=&#34;68-executortask&#34;&gt;68executortask&lt;/h3&gt;

&lt;h3 id=&#34;69-waitnotify&#34;&gt;69waitnotify&lt;/h3&gt;

&lt;p&gt;Waitnotifyjava.util.concurrentwaitnotifynotifywaitwhilewaitnotifyAllnotifynotify&lt;/p&gt;

&lt;h3 id=&#34;70-&#34;&gt;70&lt;/h3&gt;

&lt;p&gt;&lt;br /&gt;
1. 
2. RandomConcurrentHashMap
3. Collections.synchronized
4. 
5. &lt;/p&gt;

&lt;h3 id=&#34;71-&#34;&gt;71&lt;/h3&gt;

&lt;p&gt;lazy initialization class idiom&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;private static class FieldHolder{
    static final FieldType field = computeFieldValue();
}

static FieldType getField(){return FieldHolder.field;}


private volatile FieldType field;
FieldType getField(){
    FieldType result=field;
    if(result==null){
        synchronized(this){
            result=field;
            if(result==null){
                field=result=computeFieldValue();
            }
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;72-&#34;&gt;72&lt;/h3&gt;

&lt;p&gt;&lt;/p&gt;

&lt;h3 id=&#34;73-&#34;&gt;73&lt;/h3&gt;

&lt;h2 id=&#34;11-&#34;&gt;11&lt;/h2&gt;

&lt;h3 id=&#34;74-serializable&#34;&gt;74Serializable&lt;/h3&gt;

&lt;p&gt;Serializable&lt;br /&gt;
Serializablebug&lt;br /&gt;
Serializable&lt;/p&gt;

&lt;p&gt;SerializableSerializableSerializableSerializableSerializable&lt;/p&gt;

&lt;h3 id=&#34;75-&#34;&gt;75&lt;/h3&gt;

&lt;p&gt;&lt;br /&gt;
4&lt;br /&gt;
1. API&lt;br /&gt;
2. 
3. 
4. &lt;/p&gt;

&lt;p&gt;UID&lt;/p&gt;

&lt;h3 id=&#34;76-readobject&#34;&gt;76readObject&lt;/h3&gt;

&lt;p&gt;ReadObject&lt;/p&gt;

&lt;h3 id=&#34;77--readresolve&#34;&gt;77readResolve&lt;/h3&gt;

&lt;p&gt;TODO&lt;/p&gt;

&lt;h3 id=&#34;78-&#34;&gt;78&lt;/h3&gt;

&lt;p&gt;TODO&lt;/p&gt;

&lt;h3 id=&#34;end&#34;&gt;End&lt;/h3&gt;
</description>
      
    </item>
    
    <item>
      <title>Docker</title>
      <link>https://blog.kk17.net/post/docker-in-practice/</link>
      <pubDate>Sun, 08 Mar 2015 09:00:00 +0800</pubDate>
      
      <guid>https://blog.kk17.net/post/docker-in-practice/</guid>
      
        <description>&lt;p&gt;&lt;a href=&#34;https://www.docker.com/&#34;&gt;Docker&lt;/a&gt;DockerDocker&lt;/p&gt;

&lt;p&gt;DockerDockerLinuxLinuxWindowsMacDockerBoot2DockerDockerLinuxLinuxDocker&lt;/p&gt;

&lt;p&gt;Docker Hub Pull&lt;a href=&#34;http://www.daocloud.io&#34;&gt;DaoCloud&lt;/a&gt;Boot2Docker
&lt;!-- more --&gt;&lt;/p&gt;

&lt;p&gt;DockerDigitalOceanVPS&lt;a href=&#34;http://www.zhujiceping.com/3469.html&#34;&gt;&lt;/a&gt;, &lt;a href=&#34;http://www.digitalocean.com/?refcode=40d439332dc3&#34;&gt;&lt;/a&gt;10Droplet2525&lt;/p&gt;

&lt;p&gt;Docker&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;http://book.douban.com/subject/26285268/&#34;&gt;Docker ()&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://book.douban.com/subject/26284823/&#34;&gt;Docker  ()&lt;/a&gt; &lt;a href=&#34;http://dockerpool.com/static/books/docker_practice/index.html&#34;&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.infoq.com/cn/articles/docker-core-technology-preview&#34;&gt;Docker&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;DockerDockerfileDockerfileGitHub Repository&lt;a href=&#34;https://hub.docker.com/&#34;&gt;Docker Hub&lt;/a&gt;GitHub RepositoryDockerfileGithubDockerubuntu&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sed &#39;s/archive\.ubuntu\.com/mirrors\.zju\.edu\.cn/&#39; -i /etc/apt/sources.list
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;DockerfileDockerfile&lt;a href=&#34;https://github.com/docker-library/redis/blob/062335e0a8d20cab2041f25dfff2fbaf58544471/2.8/Dockerfile&#34;&gt;redis Dockerfile&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://www.fig.sh/&#34;&gt;Fig&lt;/a&gt;&lt;a href=&#34;https://github.com/kk17/CoolCantonese&#34;&gt;CoolCantonese&lt;/a&gt;3pythonredisnginx&lt;/p&gt;

&lt;p&gt;fig.xml:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;wechat:
  image: kk17/coolcantonese
  entrypoint: python
  command: wechat.py
  ports:
    - &amp;quot;80:8888&amp;quot;
  volumes:
    - .:/Cantonese
    - /Cantonese_audio
  links:
    - redis

redis:
  image: redis

nginx:
  image: nginx
  volumes_from:
    - wechat
  volumes:
    - configs/nginx.conf:/etc/nginx/nginx.conf:ro
  ports:
    - &amp;quot;9090:9090&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Docker&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>java</title>
      <link>https://blog.kk17.net/post/jvm-memory-model-and-gc/</link>
      <pubDate>Sun, 01 Feb 2015 09:00:00 +0800</pubDate>
      
      <guid>https://blog.kk17.net/post/jvm-memory-model-and-gc/</guid>
      
        <description>

&lt;h2 id=&#34;java-jvm-&#34;&gt;JavaJVM&lt;/h2&gt;

&lt;p&gt;Java&lt;/p&gt;

&lt;p&gt;JVM
&lt;img src=&#34;http://www.pointsoftware.ch/wp-content/uploads/2012/11/Cookbook_JVMArguments_2_MemoryModel.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;!-- more --&gt;

&lt;p&gt;&lt;img src=&#34;http://www.pointsoftware.ch/wp-content/uploads/2012/10/JUtH_20121024_RuntimeDataAreas_2_MemoryModel.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;Heap Space&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Method Areapermanent generationJVM&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Native Area&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;p&gt;&lt;img src=&#34;http://colobu.com/2014/12/16/java-jvm-memory-model-and-garbage-collection-monitoring-tuning/Java-Memory-Model.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;-permanent-generation&#34;&gt;Permanent Generation&lt;/h3&gt;

&lt;p&gt;Perm GenJVMJava
JVMJava SEfull GC&lt;/p&gt;

&lt;h3 id=&#34;&#34;&gt;&lt;/h3&gt;

&lt;p&gt;Java  JVM 
 Java  ( Young ) ( Old ) ( Young ) EdenFrom SurvivorTo Survivor
 JVM &lt;/p&gt;

&lt;h2 id=&#34;java&#34;&gt;Java&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;Stop the WorldStop the World&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;short-lived Minor GC&lt;/p&gt;

&lt;p&gt;Major GCMajor GCMajor GC Major GC&lt;/p&gt;

&lt;p&gt;&lt;/p&gt;

&lt;p&gt;
&lt;img src=&#34;https://plumbr.eu/wp-content/uploads/2015/02/minor-gc-major-gc-full-gc.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Stop the World
&lt;img src=&#34;http://apmblog.dynatrace.com/wp-content/600x263xGC-Compare-600x263.png.pagespeed.ic.3rAxdnMHEa.png&#34; alt=&#34;Stop the World&#34; /&gt;&lt;/p&gt;

&lt;p&gt;
&lt;img src=&#34;http://www.jdon.com/idea/images/jvm.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;java&#34;&gt;Java&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;jstat
jstatJVMJDKjstat&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Java VisualVMVisual GC
GUIGCjvisualvmJava VisualVMJDK&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://www.importnew.com/13556.html&#34;&gt;JVM - ImportNew&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;http://www.jdon.com/idea/jvm.html&#34;&gt;JVM - Jdon&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;http://colobu.com/2014/12/16/java-jvm-memory-model-and-garbage-collection-monitoring-tuning/&#34;&gt;Java | &lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;https://plumbr.eu/blog/garbage-collection/minor-gc-vs-major-gc-vs-full-gc&#34;&gt;Minor GC vs Major GC vs Full GC  Plumbr&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;http://apmblog.dynatrace.com/2011/03/10/major-gcs-separating-myth-from-reality/&#34;&gt;Major GCs - Separating Myth from Reality - Dynatrace APM Blog&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;http://www.pointsoftware.ch/de/under-the-hood-runtime-data-areas-javas-memory-model/&#34;&gt;Point Software AG&lt;/a&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>Sublime Text</title>
      <link>https://blog.kk17.net/post/sublime-text/</link>
      <pubDate>Mon, 26 Jan 2015 09:00:00 +0800</pubDate>
      
      <guid>https://blog.kk17.net/post/sublime-text/</guid>
      
        <description>

&lt;p&gt;Sublime Text&lt;/p&gt;

&lt;h1 id=&#34;&#34;&gt;&lt;/h1&gt;

&lt;h2 id=&#34;goto-anything&#34;&gt;Goto Anything&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt; Command+P &lt;/li&gt;
&lt;li&gt; Command+P  @ (Command+R)/ markdown &lt;/li&gt;
&lt;li&gt; Command+P  # &lt;/li&gt;
&lt;li&gt; Command+P  : (Ctrl+G)&lt;/li&gt;
&lt;li&gt; Command+P  @ / #  : &lt;/li&gt;
&lt;/ul&gt;

&lt;!-- more --&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Mac&lt;/th&gt;
&lt;th&gt;Windows&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Cmd+p&lt;/td&gt;
&lt;td&gt;Ctrl+p&lt;/td&gt;
&lt;td&gt;Goto Anything&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;Cmd+r&lt;/td&gt;
&lt;td&gt;Ctrl+r&lt;/td&gt;
&lt;td&gt;/&lt;/td&gt;
&lt;td&gt;Cmd+p+@&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;Ctrl+g&lt;/td&gt;
&lt;td&gt;Ctrl+g&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Cmd+p+:&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Mac&lt;/th&gt;
&lt;th&gt;Windows&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Ctrl+Shit+Up/Down&lt;/td&gt;
&lt;td&gt;Ctrl+Alt+Up/Down&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;Ctrl+Shit+Left/Right&lt;/td&gt;
&lt;td&gt;Ctrl+Shit+Left/Right&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;Ctrl+Left/Right&lt;/td&gt;
&lt;td&gt;Ctrl+Left/Right&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;Ctrl+j&lt;/td&gt;
&lt;td&gt;Ctrl+j&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Mac&lt;/th&gt;
&lt;th&gt;Windows&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Cmd+d&lt;/td&gt;
&lt;td&gt;Ctrl+d&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;Ctrl+Cmd+g&lt;/td&gt;
&lt;td&gt;Alt+F3&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Mac&lt;/th&gt;
&lt;th&gt;Windows&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Cmd+Shit+d&lt;/td&gt;
&lt;td&gt;Ctrl+p&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;Cmd+x&lt;/td&gt;
&lt;td&gt;Ctrl+x&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;Ctrl+Cmd+Up/Down&lt;/td&gt;
&lt;td&gt;Ctrl+Shit+Up/Down&lt;/td&gt;
&lt;td&gt;/&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Mac&lt;/th&gt;
&lt;th&gt;Windows&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Cmd+alt+n&lt;/td&gt;
&lt;td&gt;Ctrl+alt+n&lt;/td&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Mac&lt;/th&gt;
&lt;th&gt;Windows&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Cmd+f&lt;/td&gt;
&lt;td&gt;Ctrl+f&lt;/td&gt;
&lt;td&gt;Find&amp;hellip;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;F3&lt;/td&gt;
&lt;td&gt;Find Next&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Ctrl+i&lt;/td&gt;
&lt;td&gt;Incremental Find&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Ctrl+e&lt;/td&gt;
&lt;td&gt;Use Selection to Find&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Find In Files&amp;hellip;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Ctrl+h&lt;/td&gt;
&lt;td&gt;Replace&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;p&gt;Key Bindings - User:&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span&gt;&lt;/span&gt;[
    {&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;quot;keys&amp;quot;&lt;/span&gt;: [&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;ctrl+alt+f&amp;quot;&lt;/span&gt;], &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;quot;command&amp;quot;&lt;/span&gt;: &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;show_panel&amp;quot;&lt;/span&gt;, &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;quot;args&amp;quot;&lt;/span&gt;: {&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;quot;panel&amp;quot;&lt;/span&gt;: &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;find_in_files&amp;quot;&lt;/span&gt;} },
    {&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;quot;keys&amp;quot;&lt;/span&gt;: [&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;ctrl+shift+f&amp;quot;&lt;/span&gt;], &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;quot;command&amp;quot;&lt;/span&gt;: &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;reindent&amp;quot;&lt;/span&gt;},
    {&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;quot;keys&amp;quot;&lt;/span&gt;: [&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;ctrl+shift+r&amp;quot;&lt;/span&gt;], &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;quot;command&amp;quot;&lt;/span&gt;: &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;reveal_in_side_bar&amp;quot;&lt;/span&gt;}
]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;commandcommand&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span&gt;&lt;/span&gt;sublime&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;log_commands(&lt;span style=&#34;color: #008000&#34;&gt;True&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id=&#34;snippet&#34;&gt;Snippet&lt;/h1&gt;

&lt;p&gt;xxx.sublime-snippetUser/Packages&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;snippet&amp;gt;&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;content&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #BC7A00&#34;&gt;&amp;lt;![CDATA[&lt;/span&gt;
&lt;span style=&#34;color: #BC7A00&#34;&gt;---&lt;/span&gt;
&lt;span style=&#34;color: #BC7A00&#34;&gt;title: &amp;quot;${1:title}&amp;quot;&lt;/span&gt;
&lt;span style=&#34;color: #BC7A00&#34;&gt;description: &amp;quot;&amp;quot;&lt;/span&gt;
&lt;span style=&#34;color: #BC7A00&#34;&gt;category: ${2:category}&lt;/span&gt;
&lt;span style=&#34;color: #BC7A00&#34;&gt;tags: [${3:tags}]&lt;/span&gt;
&lt;span style=&#34;color: #BC7A00&#34;&gt;---&lt;/span&gt;
&lt;span style=&#34;color: #BC7A00&#34;&gt;]]&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/content&amp;gt;&lt;/span&gt;
    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;&amp;lt;!-- Optional: Set a tabTrigger to define how to trigger the snippet --&amp;gt;&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;tabTrigger&amp;gt;&lt;/span&gt;post&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/tabTrigger&amp;gt;&lt;/span&gt;
    &lt;span style=&#34;color: #408080; font-style: italic&#34;&gt;&amp;lt;!-- Optional: Set a scope to limit where the snippet will trigger --&amp;gt;&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;scope&amp;gt;&lt;/span&gt;text.html.markdown&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/scope&amp;gt;&lt;/span&gt;
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;description&amp;gt;&lt;/span&gt;markdown blog post setting&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/description&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;lt;/snippet&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id=&#34;build-system&#34;&gt;Build System&lt;/h1&gt;

&lt;p&gt;xxx.sublime-buildUser/Packages&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span&gt;&lt;/span&gt;{
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;quot;cmd&amp;quot;&lt;/span&gt;: [&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;jython.bat&amp;quot;&lt;/span&gt;, &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;-u&amp;quot;&lt;/span&gt;, &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;$file&amp;quot;&lt;/span&gt;],
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;quot;file_regex&amp;quot;&lt;/span&gt;: &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;^[ ]*File \&amp;quot;(...*?)\&amp;quot;, line ([0-9]*)&amp;quot;&lt;/span&gt;,
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;quot;selector&amp;quot;&lt;/span&gt;: &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;source.python&amp;quot;&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id=&#34;&#34;&gt;&lt;/h1&gt;

&lt;p&gt;Windows:
PATH&lt;/p&gt;

&lt;p&gt;Mac:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ln -s &amp;quot;/Applications/Sublime Text 3.app/Contents/SharedSupport/bin/subl&amp;quot; ~/bin/subl
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;&#34;&gt;&lt;/h1&gt;

&lt;p&gt;&lt;a href=&#34;https://packagecontrol.io/&#34;&gt;Package Control&lt;/a&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;import urllib.request,os,hashlib; h = &#39;2deb499853c4371624f5a07e27c334aa&#39; + &#39;bf8c4e67d14fb0525ba4f89698a6d7e1&#39;; pf = &#39;Package Control.sublime-package&#39;; ipp = sublime.installed_packages_path(); urllib.request.install_opener( urllib.request.build_opener( urllib.request.ProxyHandler()) ); by = urllib.request.urlopen( &#39;http://packagecontrol.io/&#39; + pf.replace(&#39; &#39;, &#39;%20&#39;)).read(); dh = hashlib.sha256(by).hexdigest(); print(&#39;Error validating download (got %s instead of %s), please try manual install&#39; % (dh, h)) if dh != h else open(os.path.join( ipp, pf), &#39;wb&#39; ).write(by)
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;&#34;&gt;&lt;/h2&gt;

&lt;h3 id=&#34;markdown-editing&#34;&gt;Markdown Editing&lt;/h3&gt;

&lt;p&gt;Markdown GFM Settings - User:&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span&gt;&lt;/span&gt;{
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;quot;extensions&amp;quot;&lt;/span&gt;: [
        &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;md&amp;quot;&lt;/span&gt;,
        &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;mdown&amp;quot;&lt;/span&gt;,
        &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;markdown&amp;quot;&lt;/span&gt;
    ]
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;markdown-preview&#34;&gt;Markdown Preview:&lt;/h3&gt;

&lt;p&gt;Settings - User:&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span&gt;&lt;/span&gt;{
    &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;quot;parser&amp;quot;&lt;/span&gt;: &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;github&amp;quot;&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Key Bindings - User:&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span&gt;&lt;/span&gt;{ &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;quot;keys&amp;quot;&lt;/span&gt;: [&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;alt+m&amp;quot;&lt;/span&gt;], &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;quot;command&amp;quot;&lt;/span&gt;: &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;markdown_preview&amp;quot;&lt;/span&gt;, &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;quot;args&amp;quot;&lt;/span&gt;: {&lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;quot;target&amp;quot;&lt;/span&gt;: &lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;browser&amp;quot;&lt;/span&gt;, &lt;span style=&#34;color: #008000; font-weight: bold&#34;&gt;&amp;quot;parser&amp;quot;&lt;/span&gt;:&lt;span style=&#34;color: #BA2121&#34;&gt;&amp;quot;default&amp;quot;&lt;/span&gt;} }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;lint-&#34;&gt;Lint &lt;/h3&gt;

&lt;p&gt;SublimeLinter &lt;/p&gt;

&lt;h3 id=&#34;&#34;&gt;&lt;/h3&gt;

&lt;p&gt;SideBarEnhancements,Terminal,GitGutter,Table Editor,Emmet,AllAutocomplete,IMESuport&lt;/p&gt;

&lt;h3 id=&#34;&#34;&gt;&lt;/h3&gt;

&lt;p&gt;
&lt;a href=&#34;http://net.tutsplus.com/tutorials/python-tutorials/how-to-create-a-sublime-text-2-plugin/&#34;&gt;How to Create a Sublime Text 2 Plugin&lt;/a&gt;
&lt;a href=&#34;http://www.sublimetext.com/docs/plugin-examples&#34;&gt;Sublime Text plugin-examples&lt;/a&gt;&lt;/p&gt;

&lt;h1 id=&#34;&#34;&gt;&lt;/h1&gt;

&lt;p&gt;
&lt;a href=&#34;http://readthedocs.org/docs/sublime-text-unofficial-documentation/en/latest/extensibility/macros.html&#34;&gt;Macros  Sublime Text Unofficial Documentation&lt;/a&gt;&lt;/p&gt;

&lt;h1 id=&#34;project&#34;&gt;Project&lt;/h1&gt;

&lt;p&gt;prj-name.sublime-project cmd + p, GOTO &lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
    &amp;quot;folders&amp;quot;:
    [
        {
            &amp;quot;path&amp;quot;: &amp;quot;path_to_project&amp;quot;,
            &amp;quot;folder_exclude_patterns&amp;quot;: [&amp;quot;img&amp;quot;,&amp;quot;x-library&amp;quot;]
        }

    ],
    &amp;quot;settings&amp;quot;:
    {
        &amp;quot;translate_tabs_to_spaces&amp;quot;: true,
        &amp;quot;tab_size&amp;quot;: 4
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;&#34;&gt;&lt;/h1&gt;

&lt;p&gt; &lt;code&gt;path_to_sublime/Packages/User/&lt;/code&gt;  repo &lt;/p&gt;

&lt;p&gt;link&lt;/p&gt;

&lt;h1 id=&#34;&#34;&gt;&lt;/h1&gt;

&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;http://zh.lucida.me/blog/sublime-text-complete-guide/&#34;&gt;Sublime Text &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.jobbole.com/82527/&#34;&gt;Gif 16  Sublime Text &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.sitepoint.com/10-essential-sublime-text-plugins-full-stack-developer/&#34;&gt;10 Essential Sublime Text Plugins for Full-Stack Developers&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://gist.github.com/iambibhas/4705378&#34;&gt;Sublime Text 2: Snippet scopes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.zhihu.com/topic/19668076&#34;&gt;Sublime Text&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.oschina.net/translate/setting-up-sublime-text-for-python-development&#34;&gt; Sublime Text  Python &lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
      
    </item>
    
  </channel>
</rss>
