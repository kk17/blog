<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>七周七语言之IO学习笔记 - Code Play</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="Kyle" />
  <meta name="description" content="Io简介 大多数的Io社区都致力于将Io作为带有微型虚拟机和丰富并发特性的可嵌入语言来推广。 Io的核心优势是拥有大量可定制的语法和函数，以及强" />

  <meta name="keywords" content="kk17, Kyle, blog" />






<meta name="generator" content="Hugo 0.55.4" />


<link rel="canonical" href="https://blog.kk17.net/post/seven-days-seven-languages-io/" />



<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.ec807d8b802a40889537c26e014f733206312ea440d42e1f0dabed80918de1ac.css" integrity="sha256-7IB9i4AqQIiVN8JuAU9zMgYxLqRA1C4fDavtgJGN4aw=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="七周七语言之IO学习笔记" />
<meta property="og:description" content="Io简介 大多数的Io社区都致力于将Io作为带有微型虚拟机和丰富并发特性的可嵌入语言来推广。 Io的核心优势是拥有大量可定制的语法和函数，以及强" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.kk17.net/post/seven-days-seven-languages-io/" />
<meta property="article:published_time" content="2015-05-08T09:00:00&#43;08:00"/>
<meta property="article:modified_time" content="2015-05-08T09:00:00&#43;08:00"/>

<meta itemprop="name" content="七周七语言之IO学习笔记">
<meta itemprop="description" content="Io简介 大多数的Io社区都致力于将Io作为带有微型虚拟机和丰富并发特性的可嵌入语言来推广。 Io的核心优势是拥有大量可定制的语法和函数，以及强">


<meta itemprop="datePublished" content="2015-05-08T09:00:00&#43;08:00" />
<meta itemprop="dateModified" content="2015-05-08T09:00:00&#43;08:00" />
<meta itemprop="wordCount" content="4385">



<meta itemprop="keywords" content="io-language," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="七周七语言之IO学习笔记"/>
<meta name="twitter:description" content="Io简介 大多数的Io社区都致力于将Io作为带有微型虚拟机和丰富并发特性的可嵌入语言来推广。 Io的核心优势是拥有大量可定制的语法和函数，以及强"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-140906699-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Code Play</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://blog.kk17.net/">Home</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://blog.kk17.net/post/">Archives</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://blog.kk17.net/tags/">Tags</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://blog.kk17.net/categories/">Categories</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://kk17.net" rel="noopener" target="_blank">
              About
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          
        
      </li>
    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      Code Play
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://blog.kk17.net/">Home</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://blog.kk17.net/post/">Archives</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://blog.kk17.net/tags/">Tags</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://blog.kk17.net/categories/">Categories</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://kk17.net" rel="noopener" target="_blank">
              About
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          

        

      </li>
    
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">七周七语言之IO学习笔记</h1>
      
      <div class="post-meta">
        <time datetime="2015-05-08" class="post-time">
          2015-05-08
        </time>
        <div class="post-category">
            <a href="https://blog.kk17.net/categories/reading-note/"> reading-note </a>
            
          </div>
        

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#io简介">Io简介</a></li>
<li><a href="#对象-原型和继承">对象、原型和继承</a></li>
<li><a href="#方法">方法</a>
<ul>
<li><a href="#单例">单例</a></li>
</ul></li>
<li><a href="#第一天自习">第一天自习</a></li>
<li><a href="#运算符">运算符</a></li>
<li><a href="#消息">消息</a></li>
<li><a href="#反射">反射</a></li>
<li><a href="#第二天自习">第二天自习</a></li>
<li><a href="#领域特定语言">领域特定语言</a></li>
<li><a href="#io的method-messing">Io的method_messing</a></li>
<li><a href="#并发">并发</a>
<ul>
<li><a href="#1-协程">1.协程</a></li>
<li><a href="#2-actor">2.Actor</a></li>
<li><a href="#3-future">3.future</a></li>
</ul></li>
<li><a href="#第三天自习">第三天自习</a></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      

<h2 id="io简介">Io简介</h2>

<p>大多数的Io社区都致力于将Io作为带有微型虚拟机和丰富并发特性的可嵌入语言来推广。<br />
Io的核心优势是拥有大量可定制的语法和函数，以及强有力的并发模型。<br />
在Io中，万事万物皆为消息，且每条消息都灰返回另一接受消息的对象。Io这门语言没有关键字，有的只是少量在行为上接近于关键字的字符。</p>

<h2 id="对象-原型和继承">对象、原型和继承</h2>

<p>Io是一门原型语言，所有的对象都有原型，对象还带有槽（slot，相当于类的域和方法？？）。<br />
槽的相关操作<br />
 1.  <code>:=</code>当槽不存在，Io会创建一个槽，然后赋值<br />
 2.  <code>=</code>给槽赋值，如果槽不存在，抛出异常<br />
 3.  <code>::=</code>新建槽
 4.  type 任何对象都有type这个槽，返回对象的原型<br />
 5.  slotNames返回对象的槽名列表<br />
 6.  getSlot(name)获取槽的内容，如果槽不存在会获取父对象的槽</p>

<p>Io的类型是一个非常好的机制。从惯用的角度说，以大写开开头的对象时类型，因此Io会对它设置type槽。而类型的复制品若以小写开头则会调用它父对象的type槽。<br />
<!-- more --></p>

<h2 id="方法">方法</h2>

<p>方法是槽的一种？<br />
方法也是对象，和其它类型的对象一样，你可以获取它的类型。</p>

<pre><code>Io&gt;method() type  
==&gt;Block  
</code></pre>

<p>Lobby是主命名空间（相当于浏览器中javascript的window？），包含所有已命名的对象。</p>

<pre><code>Io&gt; Lobby
  Protos           = Object_0x1dac868
  _                = Object_0x1dac8c8
  exit             = method(...)
  forward          = method(...)
  set_             = method(...)
</code></pre>

<ol>
<li>所有事物都是对象；</li>
<li>所有与对象的交互都是消息</li>
<li>你要做的不是实例化类，而是复制那些叫做原型的对象<br /></li>
<li>对象会记住它的原型<br /></li>
<li>对象有槽<br /></li>
<li>槽包含对象（包括方法对象）<br /></li>
<li>消息返回槽中的值，或调用槽中的方法<br /></li>
<li>如果对象无法响应某消息，它则会把消息发送给自己的原型<br /></li>
</ol>

<h3 id="单例">单例</h3>

<p>true、false和nil都是单例（singleton），对它们进行复制，返回的只是单例对象的值。构建单例只需重定义clone方法，让它返回单例对象自身即可。</p>

<h2 id="第一天自习">第一天自习</h2>

<ol>
<li><p>对1+1求值，然后对1+&ldquo;one&rdquo;求值。Io是强类型还是弱类型？用代码证实你的答案。</p>

<pre><code>Io&gt; 1+1
==&gt; 2
Io&gt; 1+&quot;one&quot;

Exception: argument 0 to method '+' must be a Number, not a 'Sequence'
---------
message '+' in 'Command Line' on line 1

Io&gt; &quot;1&quot;+&quot;one&quot;

Exception: Io Assertion 'operation not valid on non-number encodings'
---------
message '+' in 'Command Line' on line 1

Io&gt; &quot;1&quot; .. &quot;one&quot;
==&gt; 1one
Io&gt; 1 .. &quot;one&quot;
==&gt; 1one
</code></pre></li>

<li><p>0是true还是false？空字符串是true还是false？nil是true还是false？用代码证实你的答案。</p>

<pre><code>Io&gt; if( 0 , true println,false println)
true
==&gt; true
Io&gt; if( &quot;&quot; , true println,false println)
true
==&gt; true
Io&gt; if( nil , true println,false println)
false
==&gt; false
</code></pre></li>

<li><p>如何知道某个原型具有哪些槽？</p>

<pre><code>Io&gt; Sequence slotNames foreach(println)
log
linePrint
beforeSeq
pathComponent
urlDecoded
removeSeq
bitwiseAnd
removeOddIndexes
uppercase
findSeq
replaceSeq
cPrint
logicalOr
...
</code></pre></li>

<li><p><code>=、:=、::=</code>之间有什么区别？你会在什么时候使用它们？</p>

<pre><code>Io&gt; OperatorTable
==&gt; OperatorTable_0x951180:
Operators
  0   ? @ @@
  ...

Assign Operators
  ::= newSlot
  :=  setSlot
  =   updateSlot
</code></pre>

<p>实际测试没有发现::=与:=的区别。</p></li>

<li><p>从文件中运行Io程序。</p>

<pre><code>D:\IoCodes&gt;cat sum.io
sum := 0
for(i,1,100,
        sum = sum + i
)
sum println

D:\IoCodes&gt;io sum.io
5050
</code></pre></li>
</ol>

<h2 id="运算符">运算符</h2>

<pre><code>Io&gt; OperatorTable addOperator(&quot;xor&quot;,11)
==&gt; OperatorTable_0x1d61180:
Operators
  ...
  10  &amp;&amp; and
  11  or xor ||
  12  ..
  13  %= &amp;= *= += -= /= &lt;&lt;= &gt;&gt;= ^= |=
  14  return

Assign Operators
  ::= newSlot
  :=  setSlot
  =   updateSlot

To add a new operator: OperatorTable addOperator(&quot;+&quot;, 4) and implement the + message.
To add a new assign operator: OperatorTable addAssignOperator(&quot;=&quot;, &quot;updateSlot&quot;) and implement the updateSlot   message.

Io&gt; true xor := method(bool,if(bool,false,true))
==&gt; method(bool,
    if(bool, false, true)
)
Io&gt; false xor := method(bool,if(bool,true,false))
==&gt; method(bool,
    if(bool, true, false)
)
Io&gt; true xor false
==&gt; true
</code></pre>

<h2 id="消息">消息</h2>

<p>在Io中，几乎一切都是消息。一个消息由三部分组成：发送者（sender)、目标（target）、参数（arguments）。你可以用call方法访问任何消息的元信息。</p>

<pre><code>//msg.io
MsgReceiver := Object clone
MsgReceiver receive := method(
    &quot;message name is : &quot; print
    call message name println

    &quot;sender is :&quot; println
    call sender  println

    &quot;target is :&quot; println
    call target  println

    &quot;arguments is :&quot; println
    call message arguments  println

    &quot;arguments[0] is : &quot; print
    call message argAt(0)  println
    &quot;arguments[0] is : &quot; print
    call argAt(0)  type println
    &quot;arguments[0] is : &quot; print
    call evalArgAt(0)  type println
)

MsgSender := Object clone
MsgSender send := method(
    &quot;message name is : &quot; print
    call message name println

    &quot;sender is :&quot; println
    call sender  println

    &quot;target is :&quot; println
    call target  println
    receiver := MsgReceiver clone
    receiver receive(&quot;hollo world!&quot;)
)

sender := MsgSender clone
sender send

//result:
message name is : send
sender is :
 Object_0x44c890:
  Lobby            = Object_0x44c890
  MsgReceiver      = MsgReceiver_0x2171178
  MsgSender        = MsgSender_0x2171238
  Protos           = Object_0x44c830
  _                = nil
  exit             = method(...)
  forward          = method(...)
  sender           = MsgSender_0x21712c8
  set_             = method(...)

target is :
 MsgSender_0x21712c8:

message name is : receive
sender is :
 MsgSender_0x21712c8:

target is :
 MsgReceiver_0x217c368:

arguments is :
list(&quot;hollo world!&quot;)
arguments[0] is : &quot;hollo world!&quot;
arguments[0] is : Message
arguments[0] is : Sequence
[Finished in 0.2s]
</code></pre>

<p>可以看到，send方法的发送者是全局对象Lobby。
evalArgAt和argAt是两者间的区别：</p>

<blockquote>
<p>evalArgAt(argNumber)<br />
 Evaluates the specified argument of the Call’s message in the context of it’s sender.</p>

<p>argAt(argNumber)<br />
  Returns the message’s argNumber arg. Shorthand for same as call message argAt(argNumber).</p>
</blockquote>

<p>大多数语言都将参数作为栈上的值传递，但是Io不是这样。Io传递的是消息本身和上下文，在由接受者对消息求值。实际上你可以用消息实现控制结构。</p>

<h2 id="反射">反射</h2>

<p>在Io中，处理反射分为两个部分。在邮局那个例子中，是消息反射。对象反射是处理对象和对象的槽。</p>

<pre><code>Object ancestors := method(
    prototype := self proto
    if(prototype !=Object,
    writeln(&quot;Slots of &quot;,prototype type,&quot;\n---------------------&quot;)
    prototype slotNames foreach(slotName, writeln(slotName))
    writeln
    prototype ancestors))

Animal := Object clone
Animal speak := method(
    &quot;ambigulous animal noise&quot; println
)

Duck := Animal clone
Duck speak := method(
    &quot;quack&quot; println
)

Duck walk := method(
    &quot;waddle&quot; println
)

disco := Duck clone
disco ancestors

disco walk

disco speak

***************output:*******************
Slots of Duck
---------------------
walk
speak
type

Slots of Animal
---------------------
speak
type

waddle
quack
</code></pre>

<h2 id="第二天自习">第二天自习</h2>

<ol>
<li><p>计算斐波那契数列的递归和循环两种方法：</p>

<pre><code>fib := method(n,
    if(n ==1 or n == 2) then(
        return 1
    ) else (
        return (fib(n-1) + fib(n-2))
    )
)

fib2 := method(n,
    if(n == 1) then (
        return 1
    ) else (
        prv1 := 1
        prv2 := 0
        cur := 0
        for(i,2,n,
            cur = prv1 + prv2
            prv2 = prv1
            prv1 = cur
        )
        return cur
    )
)
</code></pre></li>

<li><p>在分母为0的情况下如何让运算符/返回0？</p>

<pre><code>Number setSlot(&quot;coreDivision&quot;, Number getSlot(&quot;/&quot;))

Number / = method(n,
    if(n==0) then(
        return 0
    )else(
        return (self coreDivision(n))
    )
)

(4/0) println

(8/4) println

(16/8) println

(16 / -8) println
</code></pre></li>

<li><p>写一个程序，把二维数组的所有数相加<br />
Io中没有Array这个原型，所以用List代替数组</p>

<pre><code>sum := method(arr,
    if(arr type != &quot;List&quot;) then(
        return 0
    )
    sum := 0
    arr foreach(e,
        if(e type != &quot;List&quot;) then(
            continue
        )
        if(e size &lt; 2) then(
            continue
        )
        sum = sum + e at(0)
        sum = sum + e at(1)
    )
    return sum
)

sum(list(list(3,4),list(5))) println
sum(list(7,8)) println

************output*************
7
0
</code></pre></li>

<li><p>对列表增加一个名为myAverage的槽，以计算所有数字的平均值。</p>

<pre><code>List myAverage := method(
    if(self isEmpty) then( return 0 )
    sum := 0
    self foreach(e,
        if(e type != &quot;Number&quot;) then(
            Exception raise(&quot;List member is not a number&quot;) 
        )
        sum = sum + e
    )
    avg := sum / self size
)

list() myAverage println
list(3,4,5,1.2) myAverage println
</code></pre></li>

<li><p>对二维矩阵写一个原型。该原型dim的方法可为一个包含y个列表的列表分配内存，其中每个列表有x个元素，set(x,y) 方法可以设置类别中的值，get(x,y)方法可返回列表中的值。</p>

<pre><code>TwoDArray := Object clone
TwoDArray dim := method(x,y,
    self data := list()
    for(i,0,x-1,
        innerList := list()
        for(j,0,y-1,
            innerList append(nil)
        )
        data append(innerList)
    )
)

TwoDArray set := method(x,y,e,
    outterList := self data
    if(x &gt; outterList size, return)
    innerList := outterList at(x)
    if(y &gt; innerList size, return)
    innerList atPut(y,e)
)

TwoDArray get := method(x,y,
    outterList := self data
    if(x &gt; outterList size, return nil)
    innerList := outterList at(x)
    if(y &gt; innerList size, return nil)
    innerList at(y)
)


arr2 := TwoDArray clone
arr2 dim(3,4)
arr2 set(1,2,3)
arr2 set(1,10,3)
arr2 get(1,2) println
arr2 get(1,10) println
</code></pre>

<p>dim(x,y)分配了包含x个列表的列表，每个子列表有y个元素，与题目有点不同，但觉得这样更好理解。  代码没有对数组下标越界抛出异常，抛出异常应该更好。</p></li>

<li><p>写一个转置方法，是原列表上的matrix get(x,y)与转置后的列表(new_matrix get(y,x))相等。</p>

<pre><code>TwoDArray transpose := method(
    outterList := self data
    y := outterList size
    innerList := outterList at(0)
    x := innerList size
    ret := TwoDArray clone
    ret dim(x, y)
    for(i,0,x-1,
        for(j,0,y-1,
            ret set(i, j, self get(j, i))
        )
    )
    return ret
)


arr2 := TwoDArray clone
arr2 dim(3,4)
arr2 set(1,2,3)
arr2 set(1,10,3)
arr2 get(1,2) println
arr2 get(1,10) println
&quot;-----------&quot; println
arr3 := arr2 transpose
arr3 get(2,1) println
arr3 get(10,1) println
</code></pre></li>

<li><p>将文件写入矩阵，并从文件读取矩阵</p>

<pre><code>TwoDArray writeMatrix := method(filePath,
    f := File with(filePath)
    f remove
    f openForUpdating
    outterList := self data
    x := outterList size
    y := outterList at(0) size
    f write((x .. &quot;,&quot; .. y .. &quot;\n&quot;))
    outterList foreach(e,
        line := &quot;&quot;
        e foreach(e2,
            line = line .. e2 .. &quot;,&quot;
        )
        f write(line exSlice(0,-1),&quot;\n&quot;)
    )
    f close
)


TwoDArray readMatrix := method(filePath,
    f := File with(filePath)
    f openForReading
    line := f readLine
    d := line split(&quot;,&quot;)
    x := d at(0) asNumber
    y := d at(1) asNumber
    ret := TwoDArray clone
    ret dim(x,y)
    writeln(&quot;x=&quot;,x,&quot;, y=&quot;,y)
    i := 0
    j := 0
    f readLines foreach(line,
        list := line split(&quot;,&quot;)
        j = 0
        list foreach(e,
            writeln(i,&quot;x&quot;,j,&quot;=&quot;,e)
            if(e != &quot;nil&quot;,ret set(i,j,e))
            j = j + 1
        )
        i = i +1
    )
    f close
    return ret
)


TwoDArray writeMatrix2 := method(filePath,
    f := File with(filePath)
    f remove
    f openForUpdating
    f write(self serialized())
    f close
)

TwoDArray readMatrix2 := method(filePath,
    ret := doFile(filePath)
    return ret
)


arr2 := TwoDArray clone
arr2 dim(3,4)
arr2 set(1,2,3)
arr2 set(1,10,3)
arr2 get(1,2) println
arr2 get(1,10) println
&quot;-----------&quot; println
arr3 := arr2 transpose
arr3 get(2,1) println
arr3 get(10,1) println

arr3 writeMatrix(&quot;./test.dt&quot;)

arr4 := TwoDArray readMatrix(&quot;./test.dt&quot;)

arr4 println
arr4 get(2,1) println
arr4 get(10,1) println

arr3 writeMatrix2(&quot;./test2.dt&quot;)

arr5 := TwoDArray readMatrix2(&quot;./test2.dt&quot;)

arr5 println
arr5 get(2,1) println
arr5 get(10,1) println
</code></pre></li>

<li><p>写一个程序，提供10次尝试机会，猜一个1~100之间的随机数。如果</p>

<pre><code>GuessNumGame := Object clone
GuessNumGame init := method(
    self secretNum := Random value(1,101) floor
    self guessTimes := 0
    self lowBoundry := 0
    self highBoundry := 100
    secretNum println
)

GuessNumGame guess := method(x,
    guessTimes println
    if(guessTimes &gt; 10) then(
        &quot;You had guess over 10 times! Game over!&quot; println
        return
    )
    if(x &lt; secretNum) then(
        if(x &gt; lowBoundry,lowBoundry = x)
        writeln(&quot;You guess lowwer. You can guess between &quot;,lowBoundry,&quot; to &quot;,highBoundry)
    ) elseif(x == self secretNum) then(
        writeln(&quot;Congratulations! You got the right number!&quot;)
    ) else(
        if(x &lt; highBoundry, highBoundry = x)
        writeln(&quot;You guess higher. You can guess between &quot;,lowBoundry,&quot; to &quot;,highBoundry)
    )
    guessTimes = guessTimes + 1
)

game := GuessNumGame clone
game guess(10)
game guess(50)
</code></pre></li>
</ol>

<h2 id="领域特定语言">领域特定语言</h2>

<p>几乎每一个研究过Io语言的人，都会对它在DSL方面的强大赞不绝口。下面实现一种有趣的电话号码语法的API。<br />
比如：</p>

<pre><code>{
    &quot;Bob smith&quot;:&quot;5195551212&quot;,
    &quot;Mary Walsh&quot;:&quot;4162223434&quot;
}
</code></pre>

<p>解决这一个问题的办法：</p>

<pre><code>OperatorTable addAssignOperator(&quot;:&quot;,&quot;atPutNumber&quot;)
curlyBrackets := method(
    r := Map clone
    call message arguments foreach(arg,
        r doMessage(arg)
    )
    r
)

Map atPutNumber := method(
    self atPut(
        call evalArgAt(0) asMutable removePrefix(&quot;\&quot;&quot;) removeSuffix(&quot;\&quot;&quot;),
        call evalArgAt(1)
    )
)

s := File with(&quot;phonebook.txt&quot;) openForReading contents
phoneNumbers := doString(s)  //doString把电话号码簿求值为Io代码
phoneNumbers keys println
phoneNumbers values println
</code></pre>

<h2 id="io的method-messing">Io的method_messing</h2>

<p>就像Ruby的method_missing那样，你也可以用Io的forward消息做到同样的事，但是这样做的风险会高一些。Io没有类，所以改变forward也将改变从Object获得的基本行为方式。<br />
XML是对数据进行结构化的绝妙方式，但是却有着令人作呕的语法。为了摆脱这语法，你可以写一个程序，用Io代码来表示XML数据。
假如你想把下面的数据：</p>

<pre><code>&lt;body&gt;
&lt;p&gt;
This is a simple paragraph.
&lt;/p&gt;
&lt;/body&gt;
</code></pre>

<p>表示成：</p>

<pre><code>body(
    p(&quot;This is a simple paragraph.&quot;)
)
</code></pre>

<p>我们把这种新语言称作LispML。我们将用Io的forward处理这门语言，就像处理不存在的方法一样（missing_method）。</p>

<pre><code>Builder := Object clone
Builder forward := method(
    writeln(&quot;&lt;&quot;,call message name,&quot;&gt;&quot;)
        call message arguments foreach(arg,
            content := self doMessage(arg)
            if(content type == &quot;Sequence&quot;, writeln(content))
        )
    writeln(&quot;&lt;/&quot;,call message name,&quot;&gt;&quot;)
)

Builder ul(
    li(&quot;IO&quot;),
    li(&quot;Lua&quot;),
    li(&quot;Javascript&quot;)
)
</code></pre>

<h2 id="并发">并发</h2>

<p>Io有非常出色的并发库，其主要组成部分包括协程、actor和future。</p>

<h3 id="1-协程">1.协程</h3>

<p>协程是并发的基础。它提供了进程自动挂起和恢复执行的机制。你可以把协程想象成有多个入口和出口的函数。每次yield都会自动挂起当前进程，并把控制转到另一个进程中。
通过在消息前加上@或@@，你可以异步触发消息，前者将返回future，后者会返回nil，并在其自身线程中触发消息。</p>

<pre><code>vizzini := Object clone
vizzini talk := method(
    &quot;Fezzik, are there rooks ahead?&quot; println
    yield
    &quot;No more rhymes now, I mean it.&quot; println
    yield
)

fezzik := Object clone
fezzik rhyme := method(
    yield
    &quot;If there are, we'll all be dead.&quot; println
    yield
    &quot;Anybody want a peanut?&quot; println
)

vizzini @@talk
fezzik @@rhyme

Coroutine currentCoroutine pause
</code></pre>

<p>协程是组成更高级抽象概念（如actor）的基本元素。你可以把actor想象成通用的并发原语，它可以发送消息、处理消息以及创建其它actor。actor接收到的消息是并发的。在Io中，actor把新到达的消息放到队列上，并用协程处理队列中的各个消息。</p>

<h3 id="2-actor">2.Actor</h3>

<p>和线程相比，actor有巨大的理论优势。一个actor可以改变其自身状态，并且通过严格控制的队列接触其它actor。而多个线程可以不受限制地改变状态。线程容易接受到被称为竞争条件的并发影响。在这种问题中，如果两个线程同时存取资源，可能导致不可预测的后果。<br />
Io的动人之处就在于此，发送异步消息给任何对象就是actor，就这么简单。举一个例子：</p>

<pre><code>slower := Object clone
faster := Object clone

slower start := method(
    wait(2)
    writeln(&quot;slowly&quot;)
)

faster start := method(
    wait(1)
    writeln(&quot;quickly&quot;)
)

slower start
faster start
&quot;======================&quot; println
slower @@start
faster @@start
Coroutine currentCoroutine pause
</code></pre>

<h3 id="3-future">3.future</h3>

<p>在Io中，future并不是代理实现。future会阻塞到可获得结果为止。future的值一开始是个future对象，但等到结果产生之后，所有future值的实例都会指向结果对象。</p>

<pre><code>futureResult := URL with(&quot;http://google.com/&quot;) @fetch
writeln(&quot;doing other thing ...&quot;)
wait(2)
writeln(&quot;fetched,&quot; futureResult size,&quot; bytes&quot;)
</code></pre>

<p>在windows下运行上面代码出现Exception: Object does not respond to &lsquo;URL&rsquo;异常，google了一下，未能解决，望高手指点。</p>

<h2 id="第三天自习">第三天自习</h2>

<ol>
<li><p>改进本节生成的XML程序，增加空格以显示缩进结构。</p>

<pre><code>Builder := Object clone
Builder indentSize := 4
Builder i := 0
Builder forward := method(
    (i * indentSize) repeat(write(&quot; &quot;))
    writeln(&quot;&lt;&quot;,call message name,&quot;&gt;&quot;)

    i = i + 1
    call message arguments foreach(arg,
        content := self doMessage(arg)
        if(content type == &quot;Sequence&quot;, 
            (i * indentSize) repeat(write(&quot; &quot;))
            writeln(content)
        )
    )
    i = i -1

    (i * indentSize) repeat(write(&quot; &quot;))
    writeln(&quot;&lt;/&quot;,call message name,&quot;&gt;&quot;)
)

Builder ul(
    li(p(&quot;IO&quot;)),
    li(&quot;Lua&quot;),
    li(&quot;Javascript&quot;)
)
</code></pre></li>

<li><p>创建一种使用括号的列表语法</p>

<pre><code>squareBrackets := method(       
  if(call message arguments asString containsSeq(&quot;squareBrackets&quot;) not,return call message arguments)       //如果不含子数组就直接返回参数列表,参数列表本来就是一个list
  list := List clone
  call message arguments foreach(arg,
   aArg := if(arg asString beginsWithSeq(&quot;squareBrackets&quot;),doMessage(arg),arg)
   list append(aArg)// 最后一行为返回值
  )
  list
)

[] println
[1,&quot;kk&quot;] println
[1,[&quot;kk&quot;,10.5]] println
</code></pre></li>

<li><p>改进本节生成xml程序，使其可以处理属性：如果第一个参数时映射（用大括号语法），则为xml添加属性。例如：<br />
<code>book({&quot;author&quot;:&quot;Tate&quot;}...)</code> 将打印出<code>&lt;book author=&quot;Tate&quot;&gt;</code></p>

<pre><code>OperatorTable addAssignOperator(&quot;:&quot;,&quot;addAttribute&quot;)

Builder := Object clone

Builder addAttribute := method(
    call message arguments println
    write(call evalArgAt(0))
    write(&quot;=\&quot;&quot;,call evalArgAt(1),&quot;\&quot;&quot;)
)

Builder curlyBrackets := method(
    call message arguments foreach(arg,
        self doMessage(arg)
    )
)



Builder indentSize := 4
Builder i := 0
Builder forward := method(
    (i * indentSize) repeat(write(&quot; &quot;))
    write(&quot;&lt;&quot;,call message name)

    i = i + 1

    args :=call message arguments 
    arg1 := args at(0)
    if( arg1 asString beginsWithSeq(&quot;curlyBrackets&quot;),
        //arg1 println
        self doMessage(arg1)
        args remove(arg1)
    )
    writeln(&quot;&gt;&quot;)
    args foreach(arg,
        content := self doMessage(arg)
        if(content type == &quot;Sequence&quot;, 
            (i * indentSize) repeat(write(&quot; &quot;))
            writeln(content)
        )
    )
    i = i -1

    (i * indentSize) repeat(write(&quot; &quot;))
    writeln(&quot;&lt;/&quot;,call message name,&quot;&gt;&quot;)
)


Builder ul(
    {&quot;class&quot; : &quot;foo&quot;,&quot;id&quot; : &quot;language&quot;},
    li(&quot;Io&quot;)
)
</code></pre></li>
</ol>

<p>上面代码会出现异常，不知道如何解决。</p>

<pre><code>    &lt;ul
      Exception: Sequence does not respond to ':'
      ---------
      Sequence :                           builder.io 50
      Builder curlyBrackets                builder.io 50
      Builder ul                           builder.io 49
      CLI doFile                           Z_CLI.io 140
      CLI run     
</code></pre>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">Kyle</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">2015-05-08</span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://blog.kk17.net/tags/io-language/">io-language</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/seven-days-seven-languages-prelog/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">七周七语言之Prolog学习笔记</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/effective-java-reading-note/">
            <span class="next-text nav-default">《Effective Java》中文版第2版阅读笔记</span>
            <span class="prev-text nav-mobile">Next</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  
  
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "kk17/blog"
            issue-term="pathname"
            crossorigin="anonymous"
            async>
      </script>
    </div>
  

  

  

  
  
    



        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="https://github.com/kk17" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>


<a href="https://blog.kk17.net/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2015 -
    2020
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        Kyle
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>






  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  













</body>
</html>
